"use strict";(()=>{var Ld=Object.create;var Yr=Object.defineProperty;var yd=Object.getOwnPropertyDescriptor;var Id=Object.getOwnPropertyNames;var Sd=Object.getPrototypeOf,Cd=Object.prototype.hasOwnProperty;var Ed=(r,i,l)=>i in r?Yr(r,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[i]=l;var fi=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(i,l)=>(typeof require<"u"?require:i)[l]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var dt=(r,i)=>()=>(r&&(i=r(r=0)),i);var Nt=(r,i)=>()=>(i||r((i={exports:{}}).exports,i),i.exports),Mo=(r,i)=>{for(var l in i)Yr(r,l,{get:i[l],enumerable:!0})},Ad=(r,i,l,g)=>{if(i&&typeof i=="object"||typeof i=="function")for(let L of Id(i))!Cd.call(r,L)&&L!==l&&Yr(r,L,{get:()=>i[L],enumerable:!(g=yd(i,L))||g.enumerable});return r};var We=(r,i,l)=>(l=r!=null?Ld(Sd(r)):{},Ad(i||!r||!r.__esModule?Yr(l,"default",{value:r,enumerable:!0}):l,r));var Bo=(r,i,l)=>Ed(r,typeof i!="symbol"?i+"":i,l);var Ci=Nt(Ve=>{"use strict";var za=Symbol.for("react.element"),Td=Symbol.for("react.portal"),bd=Symbol.for("react.fragment"),wd=Symbol.for("react.strict_mode"),_d=Symbol.for("react.profiler"),Rd=Symbol.for("react.provider"),Dd=Symbol.for("react.context"),kd=Symbol.for("react.forward_ref"),Pd=Symbol.for("react.suspense"),Fd=Symbol.for("react.memo"),Od=Symbol.for("react.lazy"),ci=Symbol.iterator;function Md(r){return r===null||typeof r!="object"?null:(r=ci&&r[ci]||r["@@iterator"],typeof r=="function"?r:null)}var mi={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},gi=Object.assign,xi={};function Pa(r,i,l){this.props=r,this.context=i,this.refs=xi,this.updater=l||mi}Pa.prototype.isReactComponent={};Pa.prototype.setState=function(r,i){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,i,"setState")};Pa.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function vi(){}vi.prototype=Pa.prototype;function Uo(r,i,l){this.props=r,this.context=i,this.refs=xi,this.updater=l||mi}var Go=Uo.prototype=new vi;Go.constructor=Uo;gi(Go,Pa.prototype);Go.isPureReactComponent=!0;var pi=Array.isArray,Li=Object.prototype.hasOwnProperty,Vo={current:null},yi={key:!0,ref:!0,__self:!0,__source:!0};function Ii(r,i,l){var g,L={},x=null,R=null;if(i!=null)for(g in i.ref!==void 0&&(R=i.ref),i.key!==void 0&&(x=""+i.key),i)Li.call(i,g)&&!yi.hasOwnProperty(g)&&(L[g]=i[g]);var c=arguments.length-2;if(c===1)L.children=l;else if(1<c){for(var p=Array(c),O=0;O<c;O++)p[O]=arguments[O+2];L.children=p}if(r&&r.defaultProps)for(g in c=r.defaultProps,c)L[g]===void 0&&(L[g]=c[g]);return{$$typeof:za,type:r,key:x,ref:R,props:L,_owner:Vo.current}}function Bd(r,i){return{$$typeof:za,type:r.type,key:i,ref:r.ref,props:r.props,_owner:r._owner}}function qo(r){return typeof r=="object"&&r!==null&&r.$$typeof===za}function Nd(r){var i={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(l){return i[l]})}var hi=/\/+/g;function No(r,i){return typeof r=="object"&&r!==null&&r.key!=null?Nd(""+r.key):i.toString(36)}function Zr(r,i,l,g,L){var x=typeof r;(x==="undefined"||x==="boolean")&&(r=null);var R=!1;if(r===null)R=!0;else switch(x){case"string":case"number":R=!0;break;case"object":switch(r.$$typeof){case za:case Td:R=!0}}if(R)return R=r,L=L(R),r=g===""?"."+No(R,0):g,pi(L)?(l="",r!=null&&(l=r.replace(hi,"$&/")+"/"),Zr(L,i,l,"",function(O){return O})):L!=null&&(qo(L)&&(L=Bd(L,l+(!L.key||R&&R.key===L.key?"":(""+L.key).replace(hi,"$&/")+"/")+r)),i.push(L)),1;if(R=0,g=g===""?".":g+":",pi(r))for(var c=0;c<r.length;c++){x=r[c];var p=g+No(x,c);R+=Zr(x,i,l,p,L)}else if(p=Md(r),typeof p=="function")for(r=p.call(r),c=0;!(x=r.next()).done;)x=x.value,p=g+No(x,c++),R+=Zr(x,i,l,p,L);else if(x==="object")throw i=String(r),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return R}function $r(r,i,l){if(r==null)return r;var g=[],L=0;return Zr(r,g,"","",function(x){return i.call(l,x,L++)}),g}function Ud(r){if(r._status===-1){var i=r._result;i=i(),i.then(function(l){(r._status===0||r._status===-1)&&(r._status=1,r._result=l)},function(l){(r._status===0||r._status===-1)&&(r._status=2,r._result=l)}),r._status===-1&&(r._status=0,r._result=i)}if(r._status===1)return r._result.default;throw r._result}var Ot={current:null},Jr={transition:null},Gd={ReactCurrentDispatcher:Ot,ReactCurrentBatchConfig:Jr,ReactCurrentOwner:Vo};function Si(){throw Error("act(...) is not supported in production builds of React.")}Ve.Children={map:$r,forEach:function(r,i,l){$r(r,function(){i.apply(this,arguments)},l)},count:function(r){var i=0;return $r(r,function(){i++}),i},toArray:function(r){return $r(r,function(i){return i})||[]},only:function(r){if(!qo(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Ve.Component=Pa;Ve.Fragment=bd;Ve.Profiler=_d;Ve.PureComponent=Uo;Ve.StrictMode=wd;Ve.Suspense=Pd;Ve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Gd;Ve.act=Si;Ve.cloneElement=function(r,i,l){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var g=gi({},r.props),L=r.key,x=r.ref,R=r._owner;if(i!=null){if(i.ref!==void 0&&(x=i.ref,R=Vo.current),i.key!==void 0&&(L=""+i.key),r.type&&r.type.defaultProps)var c=r.type.defaultProps;for(p in i)Li.call(i,p)&&!yi.hasOwnProperty(p)&&(g[p]=i[p]===void 0&&c!==void 0?c[p]:i[p])}var p=arguments.length-2;if(p===1)g.children=l;else if(1<p){c=Array(p);for(var O=0;O<p;O++)c[O]=arguments[O+2];g.children=c}return{$$typeof:za,type:r.type,key:L,ref:x,props:g,_owner:R}};Ve.createContext=function(r){return r={$$typeof:Dd,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:Rd,_context:r},r.Consumer=r};Ve.createElement=Ii;Ve.createFactory=function(r){var i=Ii.bind(null,r);return i.type=r,i};Ve.createRef=function(){return{current:null}};Ve.forwardRef=function(r){return{$$typeof:kd,render:r}};Ve.isValidElement=qo;Ve.lazy=function(r){return{$$typeof:Od,_payload:{_status:-1,_result:r},_init:Ud}};Ve.memo=function(r,i){return{$$typeof:Fd,type:r,compare:i===void 0?null:i}};Ve.startTransition=function(r){var i=Jr.transition;Jr.transition={};try{r()}finally{Jr.transition=i}};Ve.unstable_act=Si;Ve.useCallback=function(r,i){return Ot.current.useCallback(r,i)};Ve.useContext=function(r){return Ot.current.useContext(r)};Ve.useDebugValue=function(){};Ve.useDeferredValue=function(r){return Ot.current.useDeferredValue(r)};Ve.useEffect=function(r,i){return Ot.current.useEffect(r,i)};Ve.useId=function(){return Ot.current.useId()};Ve.useImperativeHandle=function(r,i,l){return Ot.current.useImperativeHandle(r,i,l)};Ve.useInsertionEffect=function(r,i){return Ot.current.useInsertionEffect(r,i)};Ve.useLayoutEffect=function(r,i){return Ot.current.useLayoutEffect(r,i)};Ve.useMemo=function(r,i){return Ot.current.useMemo(r,i)};Ve.useReducer=function(r,i,l){return Ot.current.useReducer(r,i,l)};Ve.useRef=function(r){return Ot.current.useRef(r)};Ve.useState=function(r){return Ot.current.useState(r)};Ve.useSyncExternalStore=function(r,i,l){return Ot.current.useSyncExternalStore(r,i,l)};Ve.useTransition=function(){return Ot.current.useTransition()};Ve.version="18.3.1"});var ze=Nt((Op,Ei)=>{"use strict";Ei.exports=Ci()});var Ai,Qr,Ho=dt(()=>{Ai=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Qr=(...r)=>r.filter((i,l,g)=>!!i&&i.trim()!==""&&g.indexOf(i)===l).join(" ").trim()});var Ti,bi=dt(()=>{Ti={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}});var Xa,wi,_i=dt(()=>{Xa=We(ze());bi();Ho();wi=(0,Xa.forwardRef)(({color:r="currentColor",size:i=24,strokeWidth:l=2,absoluteStrokeWidth:g,className:L="",children:x,iconNode:R,...c},p)=>(0,Xa.createElement)("svg",{ref:p,...Ti,width:i,height:i,stroke:r,strokeWidth:g?Number(l)*24/Number(i):l,className:Qr("lucide",L),...c},[...R.map(([O,A])=>(0,Xa.createElement)(O,A)),...Array.isArray(x)?x:[x]]))});var eo,et,Ut=dt(()=>{eo=We(ze());Ho();_i();et=(r,i)=>{let l=(0,eo.forwardRef)(({className:g,...L},x)=>(0,eo.createElement)(wi,{ref:x,iconNode:i,className:Qr(`lucide-${Ai(r)}`,g),...L}));return l.displayName=`${r}`,l}});var Ya,Ri=dt(()=>{Ut();Ya=et("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]])});var $a,Di=dt(()=>{Ut();$a=et("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])});var Za,ki=dt(()=>{Ut();Za=et("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])});var Ja,Pi=dt(()=>{Ut();Ja=et("DiamondPlus",[["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41L13.7 2.71a2.41 2.41 0 0 0-3.41 0z",key:"1ey20j"}],["path",{d:"M8 12h8",key:"1wcyev"}]])});var Sa,Fi=dt(()=>{Ut();Sa=et("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])});var Qa,Oi=dt(()=>{Ut();Qa=et("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])});var er,Mi=dt(()=>{Ut();er=et("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])});var tr,Bi=dt(()=>{Ut();tr=et("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])});var ar,Ni=dt(()=>{Ut();ar=et("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]])});var rr,Ui=dt(()=>{Ut();rr=et("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]])});var or,Gi=dt(()=>{Ut();or=et("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])});var sr,Vi=dt(()=>{Ut();sr=et("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])});var ir,qi=dt(()=>{Ut();ir=et("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])});var nr=dt(()=>{Ri();Di();ki();Pi();Fi();Oi();Mi();Bi();Ni();Ui();Gi();Vi();qi();});var Ki=Nt((lr,Ko)=>{typeof window<"u"&&function(i,l){typeof lr=="object"&&typeof Ko=="object"?Ko.exports=l():typeof define=="function"&&define.amd?define([],l):typeof lr=="object"?lr.Hls=l():i.Hls=l()}(lr,function(){return function(r){var i={};function l(g){if(i[g])return i[g].exports;var L=i[g]={i:g,l:!1,exports:{}};return r[g].call(L.exports,L,L.exports,l),L.l=!0,L.exports}return l.m=r,l.c=i,l.d=function(g,L,x){l.o(g,L)||Object.defineProperty(g,L,{enumerable:!0,get:x})},l.r=function(g){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},l.t=function(g,L){if(L&1&&(g=l(g)),L&8||L&4&&typeof g=="object"&&g&&g.__esModule)return g;var x=Object.create(null);if(l.r(x),Object.defineProperty(x,"default",{enumerable:!0,value:g}),L&2&&typeof g!="string")for(var R in g)l.d(x,R,function(c){return g[c]}.bind(null,R));return x},l.n=function(g){var L=g&&g.__esModule?function(){return g.default}:function(){return g};return l.d(L,"a",L),L},l.o=function(g,L){return Object.prototype.hasOwnProperty.call(g,L)},l.p="/dist/",l(l.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(r,i,l){"use strict";var g=Object.prototype.hasOwnProperty,L="~";function x(){}Object.create&&(x.prototype=Object.create(null),new x().__proto__||(L=!1));function R(A,E,M){this.fn=A,this.context=E,this.once=M||!1}function c(A,E,M,D,F){if(typeof M!="function")throw new TypeError("The listener must be a function");var q=new R(M,D||A,F),G=L?L+E:E;return A._events[G]?A._events[G].fn?A._events[G]=[A._events[G],q]:A._events[G].push(q):(A._events[G]=q,A._eventsCount++),A}function p(A,E){--A._eventsCount===0?A._events=new x:delete A._events[E]}function O(){this._events=new x,this._eventsCount=0}O.prototype.eventNames=function(){var E=[],M,D;if(this._eventsCount===0)return E;for(D in M=this._events)g.call(M,D)&&E.push(L?D.slice(1):D);return Object.getOwnPropertySymbols?E.concat(Object.getOwnPropertySymbols(M)):E},O.prototype.listeners=function(E){var M=L?L+E:E,D=this._events[M];if(!D)return[];if(D.fn)return[D.fn];for(var F=0,q=D.length,G=new Array(q);F<q;F++)G[F]=D[F].fn;return G},O.prototype.listenerCount=function(E){var M=L?L+E:E,D=this._events[M];return D?D.fn?1:D.length:0},O.prototype.emit=function(E,M,D,F,q,G){var B=L?L+E:E;if(!this._events[B])return!1;var U=this._events[B],K=arguments.length,z,$;if(U.fn){switch(U.once&&this.removeListener(E,U.fn,void 0,!0),K){case 1:return U.fn.call(U.context),!0;case 2:return U.fn.call(U.context,M),!0;case 3:return U.fn.call(U.context,M,D),!0;case 4:return U.fn.call(U.context,M,D,F),!0;case 5:return U.fn.call(U.context,M,D,F,q),!0;case 6:return U.fn.call(U.context,M,D,F,q,G),!0}for($=1,z=new Array(K-1);$<K;$++)z[$-1]=arguments[$];U.fn.apply(U.context,z)}else{var ae=U.length,ie;for($=0;$<ae;$++)switch(U[$].once&&this.removeListener(E,U[$].fn,void 0,!0),K){case 1:U[$].fn.call(U[$].context);break;case 2:U[$].fn.call(U[$].context,M);break;case 3:U[$].fn.call(U[$].context,M,D);break;case 4:U[$].fn.call(U[$].context,M,D,F);break;default:if(!z)for(ie=1,z=new Array(K-1);ie<K;ie++)z[ie-1]=arguments[ie];U[$].fn.apply(U[$].context,z)}}return!0},O.prototype.on=function(E,M,D){return c(this,E,M,D,!1)},O.prototype.once=function(E,M,D){return c(this,E,M,D,!0)},O.prototype.removeListener=function(E,M,D,F){var q=L?L+E:E;if(!this._events[q])return this;if(!M)return p(this,q),this;var G=this._events[q];if(G.fn)G.fn===M&&(!F||G.once)&&(!D||G.context===D)&&p(this,q);else{for(var B=0,U=[],K=G.length;B<K;B++)(G[B].fn!==M||F&&!G[B].once||D&&G[B].context!==D)&&U.push(G[B]);U.length?this._events[q]=U.length===1?U[0]:U:p(this,q)}return this},O.prototype.removeAllListeners=function(E){var M;return E?(M=L?L+E:E,this._events[M]&&p(this,M)):(this._events=new x,this._eventsCount=0),this},O.prototype.off=O.prototype.removeListener,O.prototype.addListener=O.prototype.on,O.prefixed=L,O.EventEmitter=O,r.exports=O},"./node_modules/url-toolkit/src/url-toolkit.js":function(r,i,l){(function(g){var L=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,x=/^([^\/?#]*)(.*)$/,R=/(?:\/|^)\.(?=\/)/g,c=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,p={buildAbsoluteURL:function(O,A,E){if(E=E||{},O=O.trim(),A=A.trim(),!A){if(!E.alwaysNormalize)return O;var M=p.parseURL(O);if(!M)throw new Error("Error trying to parse base URL.");return M.path=p.normalizePath(M.path),p.buildURLFromParts(M)}var D=p.parseURL(A);if(!D)throw new Error("Error trying to parse relative URL.");if(D.scheme)return E.alwaysNormalize?(D.path=p.normalizePath(D.path),p.buildURLFromParts(D)):A;var F=p.parseURL(O);if(!F)throw new Error("Error trying to parse base URL.");if(!F.netLoc&&F.path&&F.path[0]!=="/"){var q=x.exec(F.path);F.netLoc=q[1],F.path=q[2]}F.netLoc&&!F.path&&(F.path="/");var G={scheme:F.scheme,netLoc:D.netLoc,path:null,params:D.params,query:D.query,fragment:D.fragment};if(!D.netLoc&&(G.netLoc=F.netLoc,D.path[0]!=="/"))if(!D.path)G.path=F.path,D.params||(G.params=F.params,D.query||(G.query=F.query));else{var B=F.path,U=B.substring(0,B.lastIndexOf("/")+1)+D.path;G.path=p.normalizePath(U)}return G.path===null&&(G.path=E.alwaysNormalize?p.normalizePath(D.path):D.path),p.buildURLFromParts(G)},parseURL:function(O){var A=L.exec(O);return A?{scheme:A[1]||"",netLoc:A[2]||"",path:A[3]||"",params:A[4]||"",query:A[5]||"",fragment:A[6]||""}:null},normalizePath:function(O){for(O=O.split("").reverse().join("").replace(R,"");O.length!==(O=O.replace(c,"")).length;);return O.split("").reverse().join("")},buildURLFromParts:function(O){return O.scheme+O.netLoc+O.path+O.params+O.query+O.fragment}};r.exports=p})(this)},"./node_modules/webworkify-webpack/index.js":function(r,i,l){function g(E){var M={};function D(q){if(M[q])return M[q].exports;var G=M[q]={i:q,l:!1,exports:{}};return E[q].call(G.exports,G,G.exports,D),G.l=!0,G.exports}D.m=E,D.c=M,D.i=function(q){return q},D.d=function(q,G,B){D.o(q,G)||Object.defineProperty(q,G,{configurable:!1,enumerable:!0,get:B})},D.r=function(q){Object.defineProperty(q,"__esModule",{value:!0})},D.n=function(q){var G=q&&q.__esModule?function(){return q.default}:function(){return q};return D.d(G,"a",G),G},D.o=function(q,G){return Object.prototype.hasOwnProperty.call(q,G)},D.p="/",D.oe=function(q){throw console.error(q),q};var F=D(D.s=ENTRY_MODULE);return F.default||F}var L="[\\.|\\-|\\+|\\w|/|@]+",x="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+L+").*?\\)";function R(E){return(E+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function c(E){return!isNaN(1*E)}function p(E,M,D){var F={};F[D]=[];var q=M.toString(),G=q.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!G)return F;for(var B=G[1],U=new RegExp("(\\\\n|\\W)"+R(B)+x,"g"),K;K=U.exec(q);)K[3]!=="dll-reference"&&F[D].push(K[3]);for(U=new RegExp("\\("+R(B)+'\\("(dll-reference\\s('+L+'))"\\)\\)'+x,"g");K=U.exec(q);)E[K[2]]||(F[D].push(K[1]),E[K[2]]=l(K[1]).m),F[K[2]]=F[K[2]]||[],F[K[2]].push(K[4]);for(var z=Object.keys(F),$=0;$<z.length;$++)for(var ae=0;ae<F[z[$]].length;ae++)c(F[z[$]][ae])&&(F[z[$]][ae]=1*F[z[$]][ae]);return F}function O(E){var M=Object.keys(E);return M.reduce(function(D,F){return D||E[F].length>0},!1)}function A(E,M){for(var D={main:[M]},F={main:[]},q={main:{}};O(D);)for(var G=Object.keys(D),B=0;B<G.length;B++){var U=G[B],K=D[U],z=K.pop();if(q[U]=q[U]||{},!(q[U][z]||!E[U][z])){q[U][z]=!0,F[U]=F[U]||[],F[U].push(z);for(var $=p(E,E[U][z],U),ae=Object.keys($),ie=0;ie<ae.length;ie++)D[ae[ie]]=D[ae[ie]]||[],D[ae[ie]]=D[ae[ie]].concat($[ae[ie]])}}return F}r.exports=function(E,M){M=M||{};var D={main:l.m},F=M.all?{main:Object.keys(D.main)}:A(D,E),q="";Object.keys(F).filter(function(z){return z!=="main"}).forEach(function(z){for(var $=0;F[z][$];)$++;F[z].push($),D[z][$]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",q=q+"var "+z+" = ("+g.toString().replace("ENTRY_MODULE",JSON.stringify($))+")({"+F[z].map(function(ae){return""+JSON.stringify(ae)+": "+D[z][ae].toString()}).join(",")+`});
`}),q=q+"new (("+g.toString().replace("ENTRY_MODULE",JSON.stringify(E))+")({"+F.main.map(function(z){return""+JSON.stringify(z)+": "+D.main[z].toString()}).join(",")+"}))(self);";var G=new window.Blob([q],{type:"text/javascript"});if(M.bare)return G;var B=window.URL||window.webkitURL||window.mozURL||window.msURL,U=B.createObjectURL(G),K=new window.Worker(U);return K.objectURL=U,K}},"./src/crypt/decrypter.js":function(r,i,l){"use strict";l.r(i);var g=function(){function G(U,K){this.subtle=U,this.aesIV=K}var B=G.prototype;return B.decrypt=function(K,z){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},z,K)},G}(),L=function(){function G(U,K){this.subtle=U,this.key=K}var B=G.prototype;return B.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},G}(),x=L;function R(G){var B=G.byteLength,U=B&&new DataView(G).getUint8(B-1);return U?G.slice(0,B-U):G}var c=function(){function G(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var B=G.prototype;return B.uint8ArrayToUint32Array_=function(K){for(var z=new DataView(K),$=new Uint32Array(4),ae=0;ae<4;ae++)$[ae]=z.getUint32(ae*4);return $},B.initTable=function(){var K=this.sBox,z=this.invSBox,$=this.subMix,ae=$[0],ie=$[1],ne=$[2],le=$[3],ce=this.invSubMix,Oe=ce[0],de=ce[1],ue=ce[2],Te=ce[3],Ie=new Uint32Array(256),Me=0,ke=0,Be=0;for(Be=0;Be<256;Be++)Be<128?Ie[Be]=Be<<1:Ie[Be]=Be<<1^283;for(Be=0;Be<256;Be++){var Fe=ke^ke<<1^ke<<2^ke<<3^ke<<4;Fe=Fe>>>8^Fe&255^99,K[Me]=Fe,z[Fe]=Me;var qe=Ie[Me],Ce=Ie[qe],Je=Ie[Ce],je=Ie[Fe]*257^Fe*16843008;ae[Me]=je<<24|je>>>8,ie[Me]=je<<16|je>>>16,ne[Me]=je<<8|je>>>24,le[Me]=je,je=Je*16843009^Ce*65537^qe*257^Me*16843008,Oe[Fe]=je<<24|je>>>8,de[Fe]=je<<16|je>>>16,ue[Fe]=je<<8|je>>>24,Te[Fe]=je,Me?(Me=qe^Ie[Ie[Ie[Je^qe]]],ke^=Ie[Ie[ke]]):Me=ke=1}},B.expandKey=function(K){for(var z=this.uint8ArrayToUint32Array_(K),$=!0,ae=0;ae<z.length&&$;)$=z[ae]===this.key[ae],ae++;if(!$){this.key=z;var ie=this.keySize=z.length;if(ie!==4&&ie!==6&&ie!==8)throw new Error("Invalid aes key size="+ie);var ne=this.ksRows=(ie+6+1)*4,le,ce,Oe=this.keySchedule=new Uint32Array(ne),de=this.invKeySchedule=new Uint32Array(ne),ue=this.sBox,Te=this.rcon,Ie=this.invSubMix,Me=Ie[0],ke=Ie[1],Be=Ie[2],Fe=Ie[3],qe,Ce;for(le=0;le<ne;le++){if(le<ie){qe=Oe[le]=z[le];continue}Ce=qe,le%ie===0?(Ce=Ce<<8|Ce>>>24,Ce=ue[Ce>>>24]<<24|ue[Ce>>>16&255]<<16|ue[Ce>>>8&255]<<8|ue[Ce&255],Ce^=Te[le/ie|0]<<24):ie>6&&le%ie===4&&(Ce=ue[Ce>>>24]<<24|ue[Ce>>>16&255]<<16|ue[Ce>>>8&255]<<8|ue[Ce&255]),Oe[le]=qe=(Oe[le-ie]^Ce)>>>0}for(ce=0;ce<ne;ce++)le=ne-ce,ce&3?Ce=Oe[le]:Ce=Oe[le-4],ce<4||le<=4?de[ce]=Ce:de[ce]=Me[ue[Ce>>>24]]^ke[ue[Ce>>>16&255]]^Be[ue[Ce>>>8&255]]^Fe[ue[Ce&255]],de[ce]=de[ce]>>>0}},B.networkToHostOrderSwap=function(K){return K<<24|(K&65280)<<8|(K&16711680)>>8|K>>>24},B.decrypt=function(K,z,$,ae){for(var ie=this.keySize+6,ne=this.invKeySchedule,le=this.invSBox,ce=this.invSubMix,Oe=ce[0],de=ce[1],ue=ce[2],Te=ce[3],Ie=this.uint8ArrayToUint32Array_($),Me=Ie[0],ke=Ie[1],Be=Ie[2],Fe=Ie[3],qe=new Int32Array(K),Ce=new Int32Array(qe.length),Je,je,Pt,rt,De,ot,nt,xt,_e,Qe,ge,Se,ve,He,Re=this.networkToHostOrderSwap;z<qe.length;){for(_e=Re(qe[z]),Qe=Re(qe[z+1]),ge=Re(qe[z+2]),Se=Re(qe[z+3]),De=_e^ne[0],ot=Se^ne[1],nt=ge^ne[2],xt=Qe^ne[3],ve=4,He=1;He<ie;He++)Je=Oe[De>>>24]^de[ot>>16&255]^ue[nt>>8&255]^Te[xt&255]^ne[ve],je=Oe[ot>>>24]^de[nt>>16&255]^ue[xt>>8&255]^Te[De&255]^ne[ve+1],Pt=Oe[nt>>>24]^de[xt>>16&255]^ue[De>>8&255]^Te[ot&255]^ne[ve+2],rt=Oe[xt>>>24]^de[De>>16&255]^ue[ot>>8&255]^Te[nt&255]^ne[ve+3],De=Je,ot=je,nt=Pt,xt=rt,ve=ve+4;Je=le[De>>>24]<<24^le[ot>>16&255]<<16^le[nt>>8&255]<<8^le[xt&255]^ne[ve],je=le[ot>>>24]<<24^le[nt>>16&255]<<16^le[xt>>8&255]<<8^le[De&255]^ne[ve+1],Pt=le[nt>>>24]<<24^le[xt>>16&255]<<16^le[De>>8&255]<<8^le[ot&255]^ne[ve+2],rt=le[xt>>>24]<<24^le[De>>16&255]<<16^le[ot>>8&255]<<8^le[nt&255]^ne[ve+3],ve=ve+3,Ce[z]=Re(Je^Me),Ce[z+1]=Re(rt^ke),Ce[z+2]=Re(Pt^Be),Ce[z+3]=Re(je^Fe),Me=_e,ke=Qe,Be=ge,Fe=Se,z=z+4}return ae?R(Ce.buffer):Ce.buffer},B.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},G}(),p=c,O=l("./src/errors.ts"),A=l("./src/utils/logger.js"),E=l("./src/events.js"),M=l("./src/utils/get-self-scope.js"),D=Object(M.getSelfScope)(),F=function(){function G(U,K,z){var $=z===void 0?{}:z,ae=$.removePKCS7Padding,ie=ae===void 0?!0:ae;if(this.logEnabled=!0,this.observer=U,this.config=K,this.removePKCS7Padding=ie,ie)try{var ne=D.crypto;ne&&(this.subtle=ne.subtle||ne.webkitSubtle)}catch{}this.disableWebCrypto=!this.subtle}var B=G.prototype;return B.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},B.decrypt=function(K,z,$,ae){var ie=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(A.logger.log("JS AES decrypt"),this.logEnabled=!1);var ne=this.decryptor;ne||(this.decryptor=ne=new p),ne.expandKey(z),ae(ne.decrypt(K,0,$,this.removePKCS7Padding))}else{this.logEnabled&&(A.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var le=this.subtle;this.key!==z&&(this.key=z,this.fastAesKey=new x(le,z)),this.fastAesKey.expandKey().then(function(ce){var Oe=new g(le,$);Oe.decrypt(K,ce).catch(function(de){ie.onWebCryptoError(de,K,z,$,ae)}).then(function(de){ae(de)})}).catch(function(ce){ie.onWebCryptoError(ce,K,z,$,ae)})}},B.onWebCryptoError=function(K,z,$,ae,ie){this.config.enableSoftwareAES?(A.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(z,$,ae,ie)):(A.logger.error("decrypting error : "+K.message),this.observer.trigger(E.default.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:K.message}))},B.destroy=function(){var K=this.decryptor;K&&(K.destroy(),this.decryptor=void 0)},G}(),q=i.default=F},"./src/demux/demuxer-inline.js":function(r,i,l){"use strict";l.r(i);var g=l("./src/events.js"),L=l("./src/errors.ts"),x=l("./src/crypt/decrypter.js"),R=l("./src/polyfills/number.js"),c=l("./src/utils/logger.js"),p=l("./src/utils/get-self-scope.js");function O(v,w,S,f){var y,C,_,P,V,j=navigator.userAgent.toLowerCase(),Y=f,Z=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(y=((w[S+2]&192)>>>6)+1,C=(w[S+2]&60)>>>2,C>Z.length-1){v.trigger(g.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+C});return}return P=(w[S+2]&1)<<2,P|=(w[S+3]&192)>>>6,c.logger.log("manifest codec:"+f+",ADTS data:type:"+y+",sampleingIndex:"+C+"["+Z[C]+"Hz],channelConfig:"+P),/firefox/i.test(j)?C>=6?(y=5,V=new Array(4),_=C-3):(y=2,V=new Array(2),_=C):j.indexOf("android")!==-1?(y=2,V=new Array(2),_=C):(y=5,V=new Array(4),f&&(f.indexOf("mp4a.40.29")!==-1||f.indexOf("mp4a.40.5")!==-1)||!f&&C>=6?_=C-3:((f&&f.indexOf("mp4a.40.2")!==-1&&(C>=6&&P===1||/vivaldi/i.test(j))||!f&&P===1)&&(y=2,V=new Array(2)),_=C)),V[0]=y<<3,V[0]|=(C&14)>>1,V[1]|=(C&1)<<7,V[1]|=P<<3,y===5&&(V[1]|=(_&14)>>1,V[2]=(_&1)<<7,V[2]|=8,V[3]=0),{config:V,samplerate:Z[C],channelCount:P,codec:"mp4a.40."+y,manifestCodec:Y}}function A(v,w){return v[w]===255&&(v[w+1]&246)===240}function E(v,w){return v[w+1]&1?7:9}function M(v,w){return(v[w+3]&3)<<11|v[w+4]<<3|(v[w+5]&224)>>>5}function D(v,w){return!!(w+1<v.length&&A(v,w))}function F(v,w){if(D(v,w)){var S=E(v,w);if(w+S>=v.length)return!1;var f=M(v,w);if(f<=S)return!1;var y=w+f;if(y===v.length||y+1<v.length&&A(v,y))return!0}return!1}function q(v,w,S,f,y){if(!v.samplerate){var C=O(w,S,f,y);v.config=C.config,v.samplerate=C.samplerate,v.channelCount=C.channelCount,v.codec=C.codec,v.manifestCodec=C.manifestCodec,c.logger.log("parsed codec:"+v.codec+",rate:"+C.samplerate+",nb channel:"+C.channelCount)}}function G(v){return 1024*9e4/v}function B(v,w,S,f,y){var C,_,P,V=v.length;if(C=E(v,w),_=M(v,w),_-=C,_>0&&w+C+_<=V)return P=S+f*y,{headerLength:C,frameLength:_,stamp:P}}function U(v,w,S,f,y){var C=G(v.samplerate),_=B(w,S,f,y,C);if(_){var P=_.stamp,V=_.headerLength,j=_.frameLength,Y={unit:w.subarray(S+V,S+V+j),pts:P,dts:P};return v.samples.push(Y),{sample:Y,length:j+V}}}var K=l("./src/demux/id3.js"),z=function(){function v(S,f,y){this.observer=S,this.config=y,this.remuxer=f}var w=v.prototype;return w.resetInitSegment=function(f,y,C,_){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:y,duration:_,inputTimeScale:9e4}},w.resetTimeStamp=function(){},v.probe=function(f){if(!f)return!1;for(var y=K.default.getID3Data(f,0)||[],C=y.length,_=f.length;C<_;C++)if(F(f,C))return c.logger.log("ADTS sync word found !"),!0;return!1},w.append=function(f,y,C,_){for(var P=this._audioTrack,V=K.default.getID3Data(f,0)||[],j=K.default.getTimeStamp(V),Y=Object(R.isFiniteNumber)(j)?j*90:y*9e4,Z=0,Q=Y,J=f.length,re=V.length,se=[{pts:Q,dts:Q,data:V}];re<J-1;)if(D(f,re)&&re+5<J){q(P,this.observer,f,re,P.manifestCodec);var te=U(P,f,re,Y,Z);if(te)re+=te.length,Q=te.sample.pts,Z++;else{c.logger.log("Unable to parse AAC frame");break}}else K.default.isHeader(f,re)?(V=K.default.getID3Data(f,re),se.push({pts:Q,dts:Q,data:V}),re+=V.length):re++;this.remuxer.remux(P,{samples:[]},{samples:se,inputTimeScale:9e4},{samples:[]},y,C,_)},w.destroy=function(){},v}(),$=z,ae=l("./src/demux/mp4demuxer.js"),ie={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(w,S,f,y,C){if(!(f+24>S.length)){var _=this.parseHeader(S,f);if(_&&f+_.frameLength<=S.length){var P=_.samplesPerFrame*9e4/_.sampleRate,V=y+C*P,j={unit:S.subarray(f,f+_.frameLength),pts:V,dts:V};return w.config=[],w.channelCount=_.channelCount,w.samplerate=_.sampleRate,w.samples.push(j),{sample:j,length:_.frameLength}}}},parseHeader:function(w,S){var f=w[S+1]>>3&3,y=w[S+1]>>1&3,C=w[S+2]>>4&15,_=w[S+2]>>2&3,P=w[S+2]>>1&1;if(f!==1&&C!==0&&C!==15&&_!==3){var V=f===3?3-y:y===3?3:4,j=ie.BitratesMap[V*14+C-1]*1e3,Y=f===3?0:f===2?1:2,Z=ie.SamplingRateMap[Y*3+_],Q=w[S+3]>>6===3?1:2,J=ie.SamplesCoefficients[f][y],re=ie.BytesInSlot[y],se=J*8*re,te=parseInt(J*j/Z+P,10)*re;return{sampleRate:Z,channelCount:Q,frameLength:te,samplesPerFrame:se}}},isHeaderPattern:function(w,S){return w[S]===255&&(w[S+1]&224)===224&&(w[S+1]&6)!==0},isHeader:function(w,S){return!!(S+1<w.length&&this.isHeaderPattern(w,S))},probe:function(w,S){if(S+1<w.length&&this.isHeaderPattern(w,S)){var f=4,y=this.parseHeader(w,S),C=f;y&&y.frameLength&&(C=y.frameLength);var _=S+C;if(_===w.length||_+1<w.length&&this.isHeaderPattern(w,_))return!0}return!1}},ne=ie,le=function(){function v(S){this.data=S,this.bytesAvailable=S.byteLength,this.word=0,this.bitsAvailable=0}var w=v.prototype;return w.loadWord=function(){var f=this.data,y=this.bytesAvailable,C=f.byteLength-y,_=new Uint8Array(4),P=Math.min(4,y);if(P===0)throw new Error("no bytes available");_.set(f.subarray(C,C+P)),this.word=new DataView(_.buffer).getUint32(0),this.bitsAvailable=P*8,this.bytesAvailable-=P},w.skipBits=function(f){var y;this.bitsAvailable>f?(this.word<<=f,this.bitsAvailable-=f):(f-=this.bitsAvailable,y=f>>3,f-=y>>3,this.bytesAvailable-=y,this.loadWord(),this.word<<=f,this.bitsAvailable-=f)},w.readBits=function(f){var y=Math.min(this.bitsAvailable,f),C=this.word>>>32-y;return f>32&&c.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=y,this.bitsAvailable>0?this.word<<=y:this.bytesAvailable>0&&this.loadWord(),y=f-y,y>0&&this.bitsAvailable?C<<y|this.readBits(y):C},w.skipLZ=function(){var f;for(f=0;f<this.bitsAvailable;++f)if(this.word&2147483648>>>f)return this.word<<=f,this.bitsAvailable-=f,f;return this.loadWord(),f+this.skipLZ()},w.skipUEG=function(){this.skipBits(1+this.skipLZ())},w.skipEG=function(){this.skipBits(1+this.skipLZ())},w.readUEG=function(){var f=this.skipLZ();return this.readBits(f+1)-1},w.readEG=function(){var f=this.readUEG();return 1&f?1+f>>>1:-1*(f>>>1)},w.readBoolean=function(){return this.readBits(1)===1},w.readUByte=function(){return this.readBits(8)},w.readUShort=function(){return this.readBits(16)},w.readUInt=function(){return this.readBits(32)},w.skipScalingList=function(f){var y=8,C=8,_,P;for(_=0;_<f;_++)C!==0&&(P=this.readEG(),C=(y+P+256)%256),y=C===0?y:C},w.readSPS=function(){var f=0,y=0,C=0,_=0,P,V,j,Y,Z,Q,J,re,se,te=this.readUByte.bind(this),Le=this.readBits.bind(this),pe=this.readUEG.bind(this),be=this.readBoolean.bind(this),Ne=this.skipBits.bind(this),Pe=this.skipEG.bind(this),Xe=this.skipUEG.bind(this),Ye=this.skipScalingList.bind(this);if(te(),P=te(),V=Le(5),Ne(3),j=te(),Xe(),P===100||P===110||P===122||P===244||P===44||P===83||P===86||P===118||P===128){var st=pe();if(st===3&&Ne(1),Xe(),Xe(),Ne(1),be())for(re=st!==3?8:12,se=0;se<re;se++)be()&&(se<6?Ye(16):Ye(64))}Xe();var $e=pe();if($e===0)pe();else if($e===1)for(Ne(1),Pe(),Pe(),Y=pe(),se=0;se<Y;se++)Pe();Xe(),Ne(1),Z=pe(),Q=pe(),J=Le(1),J===0&&Ne(1),Ne(1),be()&&(f=pe(),y=pe(),C=pe(),_=pe());var we=[1,1];if(be()&&be()){var pt=te();switch(pt){case 1:we=[1,1];break;case 2:we=[12,11];break;case 3:we=[10,11];break;case 4:we=[16,11];break;case 5:we=[40,33];break;case 6:we=[24,11];break;case 7:we=[20,11];break;case 8:we=[32,11];break;case 9:we=[80,33];break;case 10:we=[18,11];break;case 11:we=[15,11];break;case 12:we=[64,33];break;case 13:we=[160,99];break;case 14:we=[4,3];break;case 15:we=[3,2];break;case 16:we=[2,1];break;case 255:{we=[te()<<8|te(),te()<<8|te()];break}}}return{width:Math.ceil((Z+1)*16-f*2-y*2),height:(2-J)*(Q+1)*16-(J?2:4)*(C+_),pixelRatio:we}},w.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},v}(),ce=le,Oe=function(){function v(S,f,y,C){this.decryptdata=y,this.discardEPB=C,this.decrypter=new x.default(S,f,{removePKCS7Padding:!1})}var w=v.prototype;return w.decryptBuffer=function(f,y){this.decrypter.decrypt(f,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,y)},w.decryptAacSample=function(f,y,C,_){var P=f[y].unit,V=P.subarray(16,P.length-P.length%16),j=V.buffer.slice(V.byteOffset,V.byteOffset+V.length),Y=this;this.decryptBuffer(j,function(Z){Z=new Uint8Array(Z),P.set(Z,16),_||Y.decryptAacSamples(f,y+1,C)})},w.decryptAacSamples=function(f,y,C){for(;;y++){if(y>=f.length){C();return}if(!(f[y].unit.length<32)){var _=this.decrypter.isSync();if(this.decryptAacSample(f,y,C,_),!_)return}}},w.getAvcEncryptedData=function(f){for(var y=Math.floor((f.length-48)/160)*16+16,C=new Int8Array(y),_=0,P=32;P<=f.length-16;P+=160,_+=16)C.set(f.subarray(P,P+16),_);return C},w.getAvcDecryptedUnit=function(f,y){y=new Uint8Array(y);for(var C=0,_=32;_<=f.length-16;_+=160,C+=16)f.set(y.subarray(C,C+16),_);return f},w.decryptAvcSample=function(f,y,C,_,P,V){var j=this.discardEPB(P.data),Y=this.getAvcEncryptedData(j),Z=this;this.decryptBuffer(Y.buffer,function(Q){P.data=Z.getAvcDecryptedUnit(j,Q),V||Z.decryptAvcSamples(f,y,C+1,_)})},w.decryptAvcSamples=function(f,y,C,_){for(;;y++,C=0){if(y>=f.length){_();return}for(var P=f[y].units;!(C>=P.length);C++){var V=P[C];if(!(V.data.length<=48||V.type!==1&&V.type!==5)){var j=this.decrypter.isSync();if(this.decryptAvcSample(f,y,C,_,V,j),!j)return}}}},v}(),de=Oe,ue={video:1,audio:2,id3:3,text:4},Te=function(){function v(S,f,y,C){this.observer=S,this.config=y,this.typeSupported=C,this.remuxer=f,this.sampleAes=null,this.pmtUnknownTypes={}}var w=v.prototype;return w.setDecryptData=function(f){f!=null&&f.key!=null&&f.method==="SAMPLE-AES"?this.sampleAes=new de(this.observer,this.config,f,this.discardEPB):this.sampleAes=null},v.probe=function(f){var y=v._syncOffset(f);return y<0?!1:(y&&c.logger.warn("MPEG2-TS detected but first sync word found @ offset "+y+", junk ahead ?"),!0)},v._syncOffset=function(f){for(var y=Math.min(1e3,f.length-564),C=0;C<y;){if(f[C]===71&&f[C+188]===71&&f[C+2*188]===71)return C;C++}return-1},v.createTrack=function(f,y){return{container:f==="video"||f==="audio"?"video/mp2t":void 0,type:f,id:ue[f],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:f==="video"?0:void 0,isAAC:f==="audio"?!0:void 0,duration:f==="audio"?y:void 0}},w.resetInitSegment=function(f,y,C,_){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=v.createTrack("video",_),this._audioTrack=v.createTrack("audio",_),this._id3Track=v.createTrack("id3",_),this._txtTrack=v.createTrack("text",_),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=y,this.videoCodec=C,this._duration=_},w.resetTimeStamp=function(){},w.append=function(f,y,C,_){var P,V=f.length,j,Y,Z,Q,J,re=!1;this.pmtUnknownTypes={},this.contiguous=C;var se=this.pmtParsed,te=this._avcTrack,Le=this._audioTrack,pe=this._id3Track,be=te.pid,Ne=Le.pid,Pe=pe.pid,Xe=this._pmtId,Ye=te.pesData,st=Le.pesData,$e=pe.pesData,we=this._parsePAT,pt=this._parsePMT.bind(this),Et=this._parsePES,lt=this._parseAVCPES.bind(this),At=this._parseAACPES.bind(this),ht=this._parseMPEGPES.bind(this),wt=this._parseID3PES.bind(this),Lt=v._syncOffset(f);for(V-=(V+Lt)%188,P=Lt;P<V;P+=188)if(f[P]===71){if(j=!!(f[P+1]&64),Y=((f[P+1]&31)<<8)+f[P+2],Z=(f[P+3]&48)>>4,Z>1){if(Q=P+5+f[P+4],Q===P+188)continue}else Q=P+4;switch(Y){case be:j&&(Ye&&(J=Et(Ye))&&lt(J,!1),Ye={data:[],size:0}),Ye&&(Ye.data.push(f.subarray(Q,P+188)),Ye.size+=P+188-Q);break;case Ne:j&&(st&&(J=Et(st))&&(Le.isAAC?At(J):ht(J)),st={data:[],size:0}),st&&(st.data.push(f.subarray(Q,P+188)),st.size+=P+188-Q);break;case Pe:j&&($e&&(J=Et($e))&&wt(J),$e={data:[],size:0}),$e&&($e.data.push(f.subarray(Q,P+188)),$e.size+=P+188-Q);break;case 0:j&&(Q+=f[Q]+1),Xe=this._pmtId=we(f,Q);break;case Xe:j&&(Q+=f[Q]+1);var it=pt(f,Q,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,this.sampleAes!=null);be=it.avc,be>0&&(te.pid=be),Ne=it.audio,Ne>0&&(Le.pid=Ne,Le.isAAC=it.isAAC),Pe=it.id3,Pe>0&&(pe.pid=Pe),re&&!se&&(c.logger.log("reparse from beginning"),re=!1,P=Lt-188),se=this.pmtParsed=!0;break;case 17:case 8191:break;default:re=!0;break}}else this.observer.trigger(g.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});Ye&&(J=Et(Ye))?(lt(J,!0),te.pesData=null):te.pesData=Ye,st&&(J=Et(st))?(Le.isAAC?At(J):ht(J),Le.pesData=null):(st&&st.size&&c.logger.log("last AAC PES packet truncated,might overlap between fragments"),Le.pesData=st),$e&&(J=Et($e))?(wt(J),pe.pesData=null):pe.pesData=$e,this.sampleAes==null?this.remuxer.remux(Le,te,pe,this._txtTrack,y,C,_):this.decryptAndRemux(Le,te,pe,this._txtTrack,y,C,_)},w.decryptAndRemux=function(f,y,C,_,P,V,j){if(f.samples&&f.isAAC){var Y=this;this.sampleAes.decryptAacSamples(f.samples,0,function(){Y.decryptAndRemuxAvc(f,y,C,_,P,V,j)})}else this.decryptAndRemuxAvc(f,y,C,_,P,V,j)},w.decryptAndRemuxAvc=function(f,y,C,_,P,V,j){if(y.samples){var Y=this;this.sampleAes.decryptAvcSamples(y.samples,0,0,function(){Y.remuxer.remux(f,y,C,_,P,V,j)})}else this.remuxer.remux(f,y,C,_,P,V,j)},w.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},w._parsePAT=function(f,y){return(f[y+10]&31)<<8|f[y+11]},w._trackUnknownPmt=function(f,y,C){var _=this.pmtUnknownTypes[f]||0;return _===0&&(this.pmtUnknownTypes[f]=0,y.call(c.logger,C)),this.pmtUnknownTypes[f]++,_},w._parsePMT=function(f,y,C,_){var P,V,j,Y,Z={audio:-1,avc:-1,id3:-1,isAAC:!0};for(P=(f[y+1]&15)<<8|f[y+2],V=y+3+P-4,j=(f[y+10]&15)<<8|f[y+11],y+=12+j;y<V;){switch(Y=(f[y+1]&31)<<8|f[y+2],f[y]){case 207:if(!_){this._trackUnknownPmt(f[y],c.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:Z.audio===-1&&(Z.audio=Y);break;case 21:Z.id3===-1&&(Z.id3=Y);break;case 219:if(!_){this._trackUnknownPmt(f[y],c.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:Z.avc===-1&&(Z.avc=Y);break;case 3:case 4:C?Z.audio===-1&&(Z.audio=Y,Z.isAAC=!1):this._trackUnknownPmt(f[y],c.logger.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(f[y],c.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(f[y],c.logger.log,"Unknown stream type:"+f[y]);break}y+=((f[y+3]&15)<<8|f[y+4])+5}return Z},w._parsePES=function(f){var y=0,C,_,P,V,j,Y,Z,Q,J,re=f.data;if(!f||f.size===0)return null;for(;re[0].length<19&&re.length>1;){var se=new Uint8Array(re[0].length+re[1].length);se.set(re[0]),se.set(re[1],re[0].length),re[0]=se,re.splice(1,1)}if(C=re[0],P=(C[0]<<16)+(C[1]<<8)+C[2],P===1){if(V=(C[4]<<8)+C[5],V&&V>f.size-6||(_=C[7],_&192&&(Z=(C[9]&14)*536870912+(C[10]&255)*4194304+(C[11]&254)*16384+(C[12]&255)*128+(C[13]&254)/2,_&64?(Q=(C[14]&14)*536870912+(C[15]&255)*4194304+(C[16]&254)*16384+(C[17]&255)*128+(C[18]&254)/2,Z-Q>60*9e4&&(c.logger.warn(Math.round((Z-Q)/9e4)+"s delta between PTS and DTS, align them"),Z=Q)):Q=Z),j=C[8],J=j+9,f.size<=J))return null;f.size-=J,Y=new Uint8Array(f.size);for(var te=0,Le=re.length;te<Le;te++){C=re[te];var pe=C.byteLength;if(J)if(J>pe){J-=pe;continue}else C=C.subarray(J),pe-=J,J=0;Y.set(C,y),y+=pe}return V&&(V-=j+3),{data:Y,pts:Z,dts:Q,len:V}}else return null},w.pushAccesUnit=function(f,y){if(f.units.length&&f.frame){var C=y.samples,_=C.length;if(isNaN(f.pts))if(_){var P=C[_-1];f.pts=P.pts,f.dts=P.dts}else{y.dropped++;return}!this.config.forceKeyFrameOnDiscontinuity||f.key===!0||y.sps&&(_||this.contiguous)?(f.id=_,C.push(f)):y.dropped++}f.debug.length&&c.logger.log(f.pts+"/"+f.dts+":"+f.debug)},w._parseAVCPES=function(f,y){var C=this,_=this._avcTrack,P=this._parseAVCNALu(f.data),V=!1,j,Y=this.avcSample,Z,Q=!1,J,re=this.pushAccesUnit.bind(this),se=function(Le,pe,be,Ne){return{key:Le,pts:pe,dts:be,units:[],debug:Ne}};f.data=null,Y&&P.length&&!_.audFound&&(re(Y,_),Y=this.avcSample=se(!1,f.pts,f.dts,"")),P.forEach(function(te){switch(te.type){case 1:Z=!0,Y||(Y=C.avcSample=se(!0,f.pts,f.dts,"")),V&&(Y.debug+="NDR "),Y.frame=!0;var Le=te.data;if(Q&&Le.length>4){var pe=new ce(Le).readSliceType();(pe===2||pe===4||pe===7||pe===9)&&(Y.key=!0)}break;case 5:Z=!0,Y||(Y=C.avcSample=se(!0,f.pts,f.dts,"")),V&&(Y.debug+="IDR "),Y.key=!0,Y.frame=!0;break;case 6:Z=!0,V&&Y&&(Y.debug+="SEI "),j=new ce(C.discardEPB(te.data)),j.readUByte();for(var be=0,Ne=0,Pe=!1,Xe=0;!Pe&&j.bytesAvailable>1;){be=0;do Xe=j.readUByte(),be+=Xe;while(Xe===255);Ne=0;do Xe=j.readUByte(),Ne+=Xe;while(Xe===255);if(be===4&&j.bytesAvailable!==0){Pe=!0;var Ye=j.readUByte();if(Ye===181){var st=j.readUShort();if(st===49){var $e=j.readUInt();if($e===1195456820){var we=j.readUByte();if(we===3){var pt=j.readUByte(),Et=j.readUByte(),lt=31&pt,At=[pt,Et];for(J=0;J<lt;J++)At.push(j.readUByte()),At.push(j.readUByte()),At.push(j.readUByte());C._insertSampleInOrder(C._txtTrack.samples,{type:3,pts:f.pts,bytes:At})}}}}}else if(be===5&&j.bytesAvailable!==0){if(Pe=!0,Ne>16){var ht=[];for(J=0;J<16;J++)ht.push(j.readUByte().toString(16)),(J===3||J===5||J===7||J===9)&&ht.push("-");var wt=Ne-16,Lt=new Uint8Array(wt);for(J=0;J<wt;J++)Lt[J]=j.readUByte();C._insertSampleInOrder(C._txtTrack.samples,{pts:f.pts,payloadType:be,uuid:ht.join(""),userDataBytes:Lt,userData:Object(K.utf8ArrayToStr)(Lt.buffer)})}}else if(Ne<j.bytesAvailable)for(J=0;J<Ne;J++)j.readUByte()}break;case 7:if(Z=!0,Q=!0,V&&Y&&(Y.debug+="SPS "),!_.sps){j=new ce(te.data);var it=j.readSPS();_.width=it.width,_.height=it.height,_.pixelRatio=it.pixelRatio,_.sps=[te.data],_.duration=C._duration;var Bt=te.data.subarray(1,4),na="avc1.";for(J=0;J<3;J++){var qt=Bt[J].toString(16);qt.length<2&&(qt="0"+qt),na+=qt}_.codec=na}break;case 8:Z=!0,V&&Y&&(Y.debug+="PPS "),_.pps||(_.pps=[te.data]);break;case 9:Z=!1,_.audFound=!0,Y&&re(Y,_),Y=C.avcSample=se(!1,f.pts,f.dts,V?"AUD ":"");break;case 12:Z=!1;break;default:Z=!1,Y&&(Y.debug+="unknown NAL "+te.type+" ");break}if(Y&&Z){var yt=Y.units;yt.push(te)}}),y&&Y&&(re(Y,_),this.avcSample=null)},w._insertSampleInOrder=function(f,y){var C=f.length;if(C>0){if(y.pts>=f[C-1].pts)f.push(y);else for(var _=C-1;_>=0;_--)if(y.pts<f[_].pts){f.splice(_,0,y);break}}else f.push(y)},w._getLastNalUnit=function(){var f=this.avcSample,y;if(!f||f.units.length===0){var C=this._avcTrack,_=C.samples;f=_[_.length-1]}if(f){var P=f.units;y=P[P.length-1]}return y},w._parseAVCNALu=function(f){var y=0,C=f.byteLength,_,P,V=this._avcTrack,j=V.naluState||0,Y=j,Z=[],Q,J,re=-1,se;for(j===-1&&(re=0,se=f[0]&31,j=0,y=1);y<C;){if(_=f[y++],!j){j=_?0:1;continue}if(j===1){j=_?0:2;continue}if(!_)j=3;else if(_===1){if(re>=0)Q={data:f.subarray(re,y-j-1),type:se},Z.push(Q);else{var te=this._getLastNalUnit();if(te&&(Y&&y<=4-Y&&te.state&&(te.data=te.data.subarray(0,te.data.byteLength-Y)),P=y-j-1,P>0)){var Le=new Uint8Array(te.data.byteLength+P);Le.set(te.data,0),Le.set(f.subarray(0,P),te.data.byteLength),te.data=Le}}y<C?(J=f[y]&31,re=y,se=J,j=0):j=-1}else j=0}if(re>=0&&j>=0&&(Q={data:f.subarray(re,C),type:se,state:j},Z.push(Q)),Z.length===0){var pe=this._getLastNalUnit();if(pe){var be=new Uint8Array(pe.data.byteLength+f.byteLength);be.set(pe.data,0),be.set(f,pe.data.byteLength),pe.data=be}}return V.naluState=j,Z},w.discardEPB=function(f){for(var y=f.byteLength,C=[],_=1,P,V;_<y-2;)f[_]===0&&f[_+1]===0&&f[_+2]===3?(C.push(_+2),_+=2):_++;if(C.length===0)return f;P=y-C.length,V=new Uint8Array(P);var j=0;for(_=0;_<P;j++,_++)j===C[0]&&(j++,C.shift()),V[_]=f[j];return V},w._parseAACPES=function(f){var y=this._audioTrack,C=f.data,_=f.pts,P=0,V=this.aacOverFlow,j=this.aacLastPTS,Y,Z,Q,J,re;if(V){var se=new Uint8Array(V.byteLength+C.byteLength);se.set(V,0),se.set(C,V.byteLength),C=se}for(Q=P,re=C.length;Q<re-1&&!D(C,Q);Q++);if(Q){var te,Le;if(Q<re-1?(te="AAC PES did not start with ADTS header,offset:"+Q,Le=!1):(te="no ADTS header found in AAC PES",Le=!0),c.logger.warn("parsing error:"+te),this.observer.trigger(g.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:Le,reason:te}),Le)return}if(q(y,this.observer,C,Q,this.audioCodec),Z=0,Y=G(y.samplerate),V&&j){var pe=j+Y;Math.abs(pe-_)>1&&(c.logger.log("AAC: align PTS for overlapping frames by "+Math.round((pe-_)/90)),_=pe)}for(;Q<re;)if(D(C,Q)){if(Q+5<re){var be=U(y,C,Q,_,Z);if(be){Q+=be.length,J=be.sample.pts,Z++;continue}}break}else Q++;Q<re?V=C.subarray(Q,re):V=null,this.aacOverFlow=V,this.aacLastPTS=J},w._parseMPEGPES=function(f){for(var y=f.data,C=y.length,_=0,P=0,V=f.pts;P<C;)if(ne.isHeader(y,P)){var j=ne.appendFrame(this._audioTrack,y,P,V,_);if(j)P+=j.length,_++;else break}else P++},w._parseID3PES=function(f){this._id3Track.samples.push(f)},v}(),Ie=Te,Me=function(){function v(S,f,y){this.observer=S,this.config=y,this.remuxer=f}var w=v.prototype;return w.resetInitSegment=function(f,y,C,_){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:y,duration:_,inputTimeScale:9e4}},w.resetTimeStamp=function(){},v.probe=function(f){var y,C,_=K.default.getID3Data(f,0);if(_&&K.default.getTimeStamp(_)!==void 0){for(y=_.length,C=Math.min(f.length-1,y+100);y<C;y++)if(ne.probe(f,y))return c.logger.log("MPEG Audio sync word found !"),!0}return!1},w.append=function(f,y,C,_){for(var P=K.default.getID3Data(f,0)||[],V=K.default.getTimeStamp(P),j=V!==void 0?90*V:y*9e4,Y=P.length,Z=f.length,Q=0,J=0,re=this._audioTrack,se=[{pts:j,dts:j,data:P}];Y<Z;)if(ne.isHeader(f,Y)){var te=ne.appendFrame(re,f,Y,j,Q);if(te)Y+=te.length,J=te.sample.pts,Q++;else break}else K.default.isHeader(f,Y)?(P=K.default.getID3Data(f,Y),se.push({pts:J,dts:J,data:P}),Y+=P.length):Y++;this.remuxer.remux(re,{samples:[]},{samples:se,inputTimeScale:9e4},{samples:[]},y,C,_)},w.destroy=function(){},v}(),ke=Me,Be=function(){function v(){}return v.getSilentFrame=function(S,f){switch(S){case"mp4a.40.2":if(f===1)return new Uint8Array([0,200,0,128,35,128]);if(f===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(f===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(f===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(f===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(f===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(f===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(f===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(f===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}return null},v}(),Fe=Be,qe=Math.pow(2,32)-1,Ce=function(){function v(){}return v.init=function(){v.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var S;for(S in v.types)v.types.hasOwnProperty(S)&&(v.types[S]=[S.charCodeAt(0),S.charCodeAt(1),S.charCodeAt(2),S.charCodeAt(3)]);var f=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),y=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);v.HDLR_TYPES={video:f,audio:y};var C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),_=new Uint8Array([0,0,0,0,0,0,0,0]);v.STTS=v.STSC=v.STCO=_,v.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),v.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),v.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),v.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var P=new Uint8Array([105,115,111,109]),V=new Uint8Array([97,118,99,49]),j=new Uint8Array([0,0,0,1]);v.FTYP=v.box(v.types.ftyp,P,j,P,V),v.DINF=v.box(v.types.dinf,v.box(v.types.dref,C))},v.box=function(S){for(var f=Array.prototype.slice.call(arguments,1),y=8,C=f.length,_=C,P;C--;)y+=f[C].byteLength;for(P=new Uint8Array(y),P[0]=y>>24&255,P[1]=y>>16&255,P[2]=y>>8&255,P[3]=y&255,P.set(S,4),C=0,y=8;C<_;C++)P.set(f[C],y),y+=f[C].byteLength;return P},v.hdlr=function(S){return v.box(v.types.hdlr,v.HDLR_TYPES[S])},v.mdat=function(S){return v.box(v.types.mdat,S)},v.mdhd=function(S,f){f*=S;var y=Math.floor(f/(qe+1)),C=Math.floor(f%(qe+1));return v.box(v.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,S>>24&255,S>>16&255,S>>8&255,S&255,y>>24,y>>16&255,y>>8&255,y&255,C>>24,C>>16&255,C>>8&255,C&255,85,196,0,0]))},v.mdia=function(S){return v.box(v.types.mdia,v.mdhd(S.timescale,S.duration),v.hdlr(S.type),v.minf(S))},v.mfhd=function(S){return v.box(v.types.mfhd,new Uint8Array([0,0,0,0,S>>24,S>>16&255,S>>8&255,S&255]))},v.minf=function(S){return S.type==="audio"?v.box(v.types.minf,v.box(v.types.smhd,v.SMHD),v.DINF,v.stbl(S)):v.box(v.types.minf,v.box(v.types.vmhd,v.VMHD),v.DINF,v.stbl(S))},v.moof=function(S,f,y){return v.box(v.types.moof,v.mfhd(S),v.traf(y,f))},v.moov=function(S){for(var f=S.length,y=[];f--;)y[f]=v.trak(S[f]);return v.box.apply(null,[v.types.moov,v.mvhd(S[0].timescale,S[0].duration)].concat(y).concat(v.mvex(S)))},v.mvex=function(S){for(var f=S.length,y=[];f--;)y[f]=v.trex(S[f]);return v.box.apply(null,[v.types.mvex].concat(y))},v.mvhd=function(S,f){f*=S;var y=Math.floor(f/(qe+1)),C=Math.floor(f%(qe+1)),_=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,S>>24&255,S>>16&255,S>>8&255,S&255,y>>24,y>>16&255,y>>8&255,y&255,C>>24,C>>16&255,C>>8&255,C&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return v.box(v.types.mvhd,_)},v.sdtp=function(S){var f=S.samples||[],y=new Uint8Array(4+f.length),C,_;for(_=0;_<f.length;_++)C=f[_].flags,y[_+4]=C.dependsOn<<4|C.isDependedOn<<2|C.hasRedundancy;return v.box(v.types.sdtp,y)},v.stbl=function(S){return v.box(v.types.stbl,v.stsd(S),v.box(v.types.stts,v.STTS),v.box(v.types.stsc,v.STSC),v.box(v.types.stsz,v.STSZ),v.box(v.types.stco,v.STCO))},v.avc1=function(S){var f=[],y=[],C,_,P;for(C=0;C<S.sps.length;C++)_=S.sps[C],P=_.byteLength,f.push(P>>>8&255),f.push(P&255),f=f.concat(Array.prototype.slice.call(_));for(C=0;C<S.pps.length;C++)_=S.pps[C],P=_.byteLength,y.push(P>>>8&255),y.push(P&255),y=y.concat(Array.prototype.slice.call(_));var V=v.box(v.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|S.sps.length].concat(f).concat([S.pps.length]).concat(y))),j=S.width,Y=S.height,Z=S.pixelRatio[0],Q=S.pixelRatio[1];return v.box(v.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,j>>8&255,j&255,Y>>8&255,Y&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),V,v.box(v.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),v.box(v.types.pasp,new Uint8Array([Z>>24,Z>>16&255,Z>>8&255,Z&255,Q>>24,Q>>16&255,Q>>8&255,Q&255])))},v.esds=function(S){var f=S.config.length;return new Uint8Array([0,0,0,0,3,23+f,0,1,0,4,15+f,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([f]).concat(S.config).concat([6,1,2]))},v.mp4a=function(S){var f=S.samplerate;return v.box(v.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,S.channelCount,0,16,0,0,0,0,f>>8&255,f&255,0,0]),v.box(v.types.esds,v.esds(S)))},v.mp3=function(S){var f=S.samplerate;return v.box(v.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,S.channelCount,0,16,0,0,0,0,f>>8&255,f&255,0,0]))},v.stsd=function(S){return S.type==="audio"?!S.isAAC&&S.codec==="mp3"?v.box(v.types.stsd,v.STSD,v.mp3(S)):v.box(v.types.stsd,v.STSD,v.mp4a(S)):v.box(v.types.stsd,v.STSD,v.avc1(S))},v.tkhd=function(S){var f=S.id,y=S.duration*S.timescale,C=S.width,_=S.height,P=Math.floor(y/(qe+1)),V=Math.floor(y%(qe+1));return v.box(v.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,f>>24&255,f>>16&255,f>>8&255,f&255,0,0,0,0,P>>24,P>>16&255,P>>8&255,P&255,V>>24,V>>16&255,V>>8&255,V&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,C>>8&255,C&255,0,0,_>>8&255,_&255,0,0]))},v.traf=function(S,f){var y=v.sdtp(S),C=S.id,_=Math.floor(f/(qe+1)),P=Math.floor(f%(qe+1));return v.box(v.types.traf,v.box(v.types.tfhd,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,C&255])),v.box(v.types.tfdt,new Uint8Array([1,0,0,0,_>>24,_>>16&255,_>>8&255,_&255,P>>24,P>>16&255,P>>8&255,P&255])),v.trun(S,y.length+16+20+8+16+8+8),y)},v.trak=function(S){return S.duration=S.duration||4294967295,v.box(v.types.trak,v.tkhd(S),v.mdia(S))},v.trex=function(S){var f=S.id;return v.box(v.types.trex,new Uint8Array([0,0,0,0,f>>24,f>>16&255,f>>8&255,f&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},v.trun=function(S,f){var y=S.samples||[],C=y.length,_=12+16*C,P=new Uint8Array(_),V,j,Y,Z,Q,J;for(f+=8+_,P.set([0,0,15,1,C>>>24&255,C>>>16&255,C>>>8&255,C&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255],0),V=0;V<C;V++)j=y[V],Y=j.duration,Z=j.size,Q=j.flags,J=j.cts,P.set([Y>>>24&255,Y>>>16&255,Y>>>8&255,Y&255,Z>>>24&255,Z>>>16&255,Z>>>8&255,Z&255,Q.isLeading<<2|Q.dependsOn,Q.isDependedOn<<6|Q.hasRedundancy<<4|Q.paddingValue<<1|Q.isNonSync,Q.degradPrio&61440,Q.degradPrio&15,J>>>24&255,J>>>16&255,J>>>8&255,J&255],12+16*V);return v.box(v.types.trun,P)},v.initSegment=function(S){v.types||v.init();var f=v.moov(S),y;return y=new Uint8Array(v.FTYP.byteLength+f.byteLength),y.set(v.FTYP),y.set(f,v.FTYP.byteLength),y},v}(),Je=Ce,je=9e4;function Pt(v,w,S,f){return S===void 0&&(S=1),f===void 0&&(f=!1),rt(v,w,1/S)}function rt(v,w,S,f){S===void 0&&(S=1),f===void 0&&(f=!1);var y=v*w*S;return f?Math.round(y):y}function De(v,w){return w===void 0&&(w=!1),rt(v,1e3,1/je,w)}function ot(v,w){return w===void 0&&(w=1),rt(v,je,1/w)}var nt=ot(10),xt=ot(.2),_e=null,Qe=function(){function v(S,f,y,C){if(this.observer=S,this.config=f,this.typeSupported=y,this.ISGenerated=!1,_e===null){var _=navigator.userAgent.match(/Chrome\/(\d+)/i);_e=_?parseInt(_[1]):0}}var w=v.prototype;return w.destroy=function(){},w.resetTimeStamp=function(f){this._initPTS=this._initDTS=f},w.resetInitSegment=function(){this.ISGenerated=!1},w.getVideoStartPts=function(f){var y=!1,C=f.reduce(function(_,P){var V=P.pts-_;return V<-4294967296?(y=!0,ge(_,P.pts)):V>0?_:P.pts},f[0].pts);return y&&c.logger.debug("PTS rollover detected"),C},w.remux=function(f,y,C,_,P,V,j){if(this.ISGenerated||this.generateIS(f,y,P),this.ISGenerated){var Y=f.samples.length,Z=y.samples.length,Q=P,J=P;if(Y&&Z){var re=this.getVideoStartPts(y.samples),se=ge(f.samples[0].pts,re)-re,te=se/y.inputTimeScale;Q+=Math.max(0,te),J+=Math.max(0,-te)}if(Y){f.timescale||(c.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(f,y,P));var Le=this.remuxAudio(f,Q,V,j);if(Z){var pe;Le&&(pe=Le.endPTS-Le.startPTS),y.timescale||(c.logger.warn("regenerate InitSegment as video detected"),this.generateIS(f,y,P)),this.remuxVideo(y,J,V,pe)}}else if(Z){var be=this.remuxVideo(y,J,V,0,j);be&&f.codec&&this.remuxEmptyAudio(f,Q,V,be)}}C.samples.length&&this.remuxID3(C,P),_.samples.length&&this.remuxText(_,P),this.observer.trigger(g.default.FRAG_PARSED)},w.generateIS=function(f,y,C){var _=this.observer,P=f.samples,V=y.samples,j=this.typeSupported,Y="audio/mp4",Z={},Q={tracks:Z},J=this._initPTS===void 0,re,se;if(J&&(re=se=1/0),f.config&&P.length&&(f.timescale=f.samplerate,c.logger.log("audio sampling rate : "+f.samplerate),f.isAAC||(j.mpeg?(Y="audio/mpeg",f.codec=""):j.mp3&&(f.codec="mp3")),Z.audio={container:Y,codec:f.codec,initSegment:!f.isAAC&&j.mpeg?new Uint8Array:Je.initSegment([f]),metadata:{channelCount:f.channelCount}},J&&(re=se=P[0].pts-Math.round(f.inputTimeScale*C))),y.sps&&y.pps&&V.length){var te=y.inputTimeScale;if(y.timescale=te,Z.video={container:"video/mp4",codec:y.codec,initSegment:Je.initSegment([y]),metadata:{width:y.width,height:y.height}},J){var Le=this.getVideoStartPts(V),pe=Math.round(te*C);se=Math.min(se,ge(V[0].dts,Le)-pe),re=Math.min(re,Le-pe),this.observer.trigger(g.default.INIT_PTS_FOUND,{initPTS:re})}}else J&&Z.audio&&this.observer.trigger(g.default.INIT_PTS_FOUND,{initPTS:re});Object.keys(Z).length?(_.trigger(g.default.FRAG_PARSING_INIT_SEGMENT,Q),this.ISGenerated=!0,J&&(this._initPTS=re,this._initDTS=se)):_.trigger(g.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},w.remuxVideo=function(f,y,C,_){var P=f.timescale,V=f.samples,j=[],Y=V.length,Z=this._initPTS,Q=8,J,re,se,te,Le,pe=Number.POSITIVE_INFINITY,be=Number.NEGATIVE_INFINITY,Ne=0,Pe=!1,Xe=this.nextAvcDts;if(Y!==0){if(!C){var Ye=y*P,st=V[0].pts-ge(V[0].dts,V[0].pts);Xe=Ye-st}for(var $e=0;$e<Y;$e++){var we=V[$e];we.pts=ge(we.pts-Z,Xe),we.dts=ge(we.dts-Z,Xe),we.dts>we.pts&&(Ne=Math.max(Math.min(Ne,we.pts-we.dts),-1*xt)),we.dts<V[$e>0?$e-1:$e].dts&&(Pe=!0)}Pe&&V.sort(function(wa,Ha){var wo=wa.dts-Ha.dts,Kr=wa.pts-Ha.pts;return wo||Kr||wa.id-Ha.id}),te=V[0].dts,Le=V[Y-1].dts;var pt=Math.round((Le-te)/(Y-1));if(Ne<0){if(Ne<pt*-2){c.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+De(-pt,!0)+" ms");for(var Et=Ne,lt=0;lt<Y;lt++)V[lt].dts=Et=Math.max(Et,V[lt].pts-pt),V[lt].pts=Math.max(Et,V[lt].pts)}else{c.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+De(Ne,!0)+" ms to overcome this issue");for(var At=0;At<Y;At++)V[At].dts=V[At].dts+Ne}te=V[0].dts,Le=V[Y-1].dts}if(C){var ht=te-Xe,wt=ht>pt,Lt=ht<-1;if(wt||Lt){wt?c.logger.warn("AVC: "+De(ht,!0)+" ms ("+ht+"dts) hole between fragments detected, filling it"):c.logger.warn("AVC: "+De(-ht,!0)+" ms ("+ht+"dts) overlapping between fragments detected"),te=Xe;var it=V[0].pts-ht;V[0].dts=te,V[0].pts=it,c.logger.log("Video: First PTS/DTS adjusted: "+De(it,!0)+"/"+De(te,!0)+", delta: "+De(ht,!0)+" ms")}}_e&&_e<75&&(te=Math.max(0,te));for(var Bt=0,na=0,qt=0;qt<Y;qt++){for(var yt=V[qt],jt=yt.units,Yt=jt.length,$t=0,xa=0;xa<Yt;xa++)$t+=jt[xa].data.length;na+=$t,Bt+=Yt,yt.length=$t,yt.dts=Math.max(yt.dts,te),yt.pts=Math.max(yt.pts,yt.dts,0),pe=Math.min(yt.pts,pe),be=Math.max(yt.pts,be)}Le=V[Y-1].dts;var X=na+4*Bt+8;try{re=new Uint8Array(X)}catch{this.observer.trigger(g.default.ERROR,{type:L.ErrorTypes.MUX_ERROR,details:L.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:X,reason:"fail allocating video mdat "+X});return}var la=new DataView(re.buffer);la.setUint32(0,X),re.set(Je.types.mdat,4);for(var Ft=0;Ft<Y;Ft++){for(var Ht=V[Ft],va=Ht.units,La=0,Zt=void 0,Va=0,Nr=va.length;Va<Nr;Va++){var Ur=va[Va],To=Ur.data,ba=Ur.data.byteLength;la.setUint32(Q,ba),Q+=4,re.set(To,Q),Q+=ba,La+=4+ba}if(Ft<Y-1)J=V[Ft+1].dts-Ht.dts;else{var Gr=this.config,ha=Ht.dts-V[Ft>0?Ft-1:Ft].dts;if(Gr.stretchShortVideoTrack){var Vr=Gr.maxBufferHole,ya=Math.floor(Vr*P),qa=(_?pe+_*P:this.nextAudioPts)-Ht.pts;qa>ya?(J=qa-ha,J<0&&(J=ha),c.logger.log("It is approximately "+De(qa,!1)+" ms to the next segment; using duration "+De(J,!1)+" ms for the last video frame.")):J=ha}else J=ha}Zt=Math.round(Ht.pts-Ht.dts),j.push({size:La,duration:J,cts:Zt,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:Ht.key?2:1,isNonSync:Ht.key?0:1}})}this.nextAvcDts=Le+J;var bo=f.dropped;if(f.nbNalu=0,f.dropped=0,j.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var qr=j[0].flags;qr.dependsOn=2,qr.isNonSync=0}f.samples=j,se=Je.moof(f.sequenceNumber++,te,f),f.samples=[];var Hr={data1:se,data2:re,startPTS:pe/P,endPTS:(be+J)/P,startDTS:te/P,endDTS:this.nextAvcDts/P,type:"video",hasAudio:!1,hasVideo:!0,nb:j.length,dropped:bo};return this.observer.trigger(g.default.FRAG_PARSING_DATA,Hr),Hr}},w.remuxAudio=function(f,y,C,_){var P=f.inputTimeScale,V=f.timescale,j=P/V,Y=f.isAAC?1024:1152,Z=Y*j,Q=this._initPTS,J=!f.isAAC&&this.typeSupported.mpeg,re,se,te,Le,pe,be,Ne=J?0:8,Pe=f.samples,Xe=[],Ye=this.nextAudioPts;if(C|=Pe.length&&Ye&&(_&&Math.abs(y-Ye/P)<.1||Math.abs(Pe[0].pts-Ye-Q)<20*Z),Pe.forEach(function(Zt){Zt.pts=Zt.dts=ge(Zt.pts-Q,y*P)}),Pe=Pe.filter(function(Zt){return Zt.pts>=0}),Pe.length!==0){if(C||(_?Ye=Math.max(0,y*P):Ye=Pe[0].pts),f.isAAC)for(var st=this.config.maxAudioFramesDrift,$e=0,we=Ye;$e<Pe.length;){var pt=Pe[$e],Et=pt.pts,lt=Et-we;if(lt<=-st*Z)C||$e>0?(c.logger.warn("Dropping 1 audio frame @ "+De(we,!0)/1e3+"s due to "+De(lt,!0)+" ms overlap."),Pe.splice($e,1)):(c.logger.warn("Audio frame @ "+De(Et,!0)/1e3+"s overlaps nextAudioPts by "+De(lt,!0)+" ms."),we=Et+Z,$e++);else if(lt>=st*Z&&lt<nt&&we){var At=Math.round(lt/Z);c.logger.warn("Injecting "+At+" audio frames @ "+De(we,!0)/1e3+"s due to "+De(lt,!0)+" ms gap.");for(var ht=0;ht<At;ht++){var wt=Math.max(we,0);se=Fe.getSilentFrame(f.manifestCodec||f.codec,f.channelCount),se||(c.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),se=pt.unit.subarray()),Pe.splice($e,0,{unit:se,pts:wt,dts:wt}),we+=Z,$e++}pt.pts=pt.dts=we,we+=Z,$e++}else Math.abs(lt)>.1*Z,pt.pts=pt.dts=we,we+=Z,$e++}for(var Lt=Pe.length,it=0;Lt--;)it+=Pe[Lt].unit.byteLength;for(var Bt=0,na=Pe.length;Bt<na;Bt++){var qt=Pe[Bt],yt=qt.unit,jt=qt.pts;if(be!==void 0&&re)re.duration=Math.round((jt-be)/j);else{var Yt=jt-Ye,$t=0;if(C&&f.isAAC&&Yt){if(Yt>0&&Yt<nt)$t=Math.round((jt-Ye)/Z),c.logger.log(De(Yt,!0)+" ms hole between AAC samples detected,filling it"),$t>0&&(se=Fe.getSilentFrame(f.manifestCodec||f.codec,f.channelCount),se||(se=yt.subarray()),it+=$t*se.length);else if(Yt<-12){c.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+De(Ye,!0)+" ms / "+De(jt,!0)+" ms / "+De(-Yt,!0)+" ms"),it-=yt.byteLength;continue}jt=Ye}if(pe=jt,it>0){it+=Ne;try{te=new Uint8Array(it)}catch{this.observer.trigger(g.default.ERROR,{type:L.ErrorTypes.MUX_ERROR,details:L.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:it,reason:"fail allocating audio mdat "+it});return}if(!J){var xa=new DataView(te.buffer);xa.setUint32(0,it),te.set(Je.types.mdat,4)}}else return;for(var X=0;X<$t;X++)se=Fe.getSilentFrame(f.manifestCodec||f.codec,f.channelCount),se||(c.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),se=yt.subarray()),te.set(se,Ne),Ne+=se.byteLength,re={size:se.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},Xe.push(re)}te.set(yt,Ne);var la=yt.byteLength;Ne+=la,re={size:la,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},Xe.push(re),be=jt}var Ft=0;if(Lt=Xe.length,Lt>=2&&(Ft=Xe[Lt-2].duration,re.duration=Ft),Lt){this.nextAudioPts=Ye=be+j*Ft,f.samples=Xe,J?Le=new Uint8Array:Le=Je.moof(f.sequenceNumber++,pe/j,f),f.samples=[];var Ht=pe/P,va=Ye/P,La={data1:Le,data2:te,startPTS:Ht,endPTS:va,startDTS:Ht,endDTS:va,type:"audio",hasAudio:!0,hasVideo:!1,nb:Lt};return this.observer.trigger(g.default.FRAG_PARSING_DATA,La),La}return null}},w.remuxEmptyAudio=function(f,y,C,_){var P=f.inputTimeScale,V=f.samplerate?f.samplerate:P,j=P/V,Y=this.nextAudioPts,Z=(Y!==void 0?Y:_.startDTS*P)+this._initDTS,Q=_.endDTS*P+this._initDTS,J=1024,re=j*J,se=Math.ceil((Q-Z)/re),te=Fe.getSilentFrame(f.manifestCodec||f.codec,f.channelCount);if(c.logger.warn("remux empty Audio"),!te){c.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");return}for(var Le=[],pe=0;pe<se;pe++){var be=Z+pe*re;Le.push({unit:te,pts:be,dts:be})}f.samples=Le,this.remuxAudio(f,y,C)},w.remuxID3=function(f,y){var C=f.samples.length;if(C){for(var _=f.inputTimeScale,P=this._initPTS,V=this._initDTS,j=0;j<C;j++){var Y=f.samples[j];Y.pts=ge(Y.pts-P,y*_)/_,Y.dts=ge(Y.dts-V,y*_)/_}this.observer.trigger(g.default.FRAG_PARSING_METADATA,{samples:f.samples}),f.samples=[]}},w.remuxText=function(f,y){var C=f.samples.length,_=f.inputTimeScale,P=this._initPTS;if(C){for(var V=0;V<C;V++){var j=f.samples[V];j.pts=ge(j.pts-P,y*_)/_}f.samples.sort(function(Y,Z){return Y.pts-Z.pts}),this.observer.trigger(g.default.FRAG_PARSING_USERDATA,{samples:f.samples})}f.samples=[]},v}();function ge(v,w){var S;if(w===void 0)return v;for(w<v?S=-8589934592:S=8589934592;Math.abs(v-w)>4294967296;)v+=S;return v}var Se=Qe,ve=function(){function v(S){this.observer=S}var w=v.prototype;return w.destroy=function(){},w.resetTimeStamp=function(){},w.resetInitSegment=function(){},w.remux=function(f,y,C,_,P,V,j,Y){var Z=this.observer,Q="";f&&(Q+="audio"),y&&(Q+="video"),Z.trigger(g.default.FRAG_PARSING_DATA,{data1:Y,startPTS:P,startDTS:P,type:Q,hasAudio:!!f,hasVideo:!!y,nb:1,dropped:0}),Z.trigger(g.default.FRAG_PARSED)},v}(),He=ve,Re=Object(p.getSelfScope)(),ct;try{ct=Re.performance.now.bind(Re.performance)}catch{c.logger.debug("Unable to use Performance API on this environment"),ct=Re.Date.now}var k=function(){function v(S,f,y,C){this.observer=S,this.typeSupported=f,this.config=y,this.vendor=C}var w=v.prototype;return w.destroy=function(){var f=this.demuxer;f&&f.destroy()},w.push=function(f,y,C,_,P,V,j,Y,Z,Q,J,re){var se=this;if(f.byteLength>0&&y!=null&&y.key!=null&&y.method==="AES-128"){var te=this.decrypter;te==null&&(te=this.decrypter=new x.default(this.observer,this.config));var Le=ct();te.decrypt(f,y.key.buffer,y.iv.buffer,function(pe){var be=ct();se.observer.trigger(g.default.FRAG_DECRYPTED,{stats:{tstart:Le,tdecrypt:be}}),se.pushDecrypted(new Uint8Array(pe),y,new Uint8Array(C),_,P,V,j,Y,Z,Q,J,re)})}else this.pushDecrypted(new Uint8Array(f),y,new Uint8Array(C),_,P,V,j,Y,Z,Q,J,re)},w.pushDecrypted=function(f,y,C,_,P,V,j,Y,Z,Q,J,re){var se=this.demuxer,te=this.remuxer;if(!se||j||Y){for(var Le=this.observer,pe=this.typeSupported,be=this.config,Ne=[{demux:Ie,remux:Se},{demux:ae.default,remux:He},{demux:$,remux:Se},{demux:ke,remux:Se}],Pe,Xe=0,Ye=Ne.length;Xe<Ye&&(Pe=Ne[Xe],!Pe.demux.probe(f));Xe++);if(!Pe){Le.trigger(g.default.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});return}(!te||!(te instanceof Pe.remux))&&(te=new Pe.remux(Le,be,pe,this.vendor)),(!se||!(se instanceof Pe.demux))&&(se=new Pe.demux(Le,te,be,pe),this.probe=Pe.demux.probe),this.demuxer=se,this.remuxer=te}(j||Y)&&(se.resetInitSegment(C,_,P,Q),te.resetInitSegment()),j&&(se.resetTimeStamp(re),te.resetTimeStamp(re)),typeof se.setDecryptData=="function"&&se.setDecryptData(y),se.append(f,V,Z,J)},v}(),H=i.default=k},"./src/demux/demuxer-worker.js":function(r,i,l){"use strict";l.r(i);var g=l("./src/demux/demuxer-inline.js"),L=l("./src/events.js"),x=l("./src/utils/logger.js"),R=l("./node_modules/eventemitter3/index.js"),c=l.n(R),p=function(A){var E=new R.EventEmitter;E.trigger=function(F){for(var q=arguments.length,G=new Array(q>1?q-1:0),B=1;B<q;B++)G[B-1]=arguments[B];E.emit.apply(E,[F,F].concat(G))},E.off=function(F){for(var q=arguments.length,G=new Array(q>1?q-1:0),B=1;B<q;B++)G[B-1]=arguments[B];E.removeListener.apply(E,[F].concat(G))};var M=function(F,q){A.postMessage({event:F,data:q})};A.addEventListener("message",function(D){var F=D.data;switch(F.cmd){case"init":var q=JSON.parse(F.config);A.demuxer=new g.default(E,F.typeSupported,q,F.vendor),Object(x.enableLogs)(q.debug),M("init",null);break;case"demux":A.demuxer.push(F.data,F.decryptdata,F.initSegment,F.audioCodec,F.videoCodec,F.timeOffset,F.discontinuity,F.trackSwitch,F.contiguous,F.duration,F.accurateTimeOffset,F.defaultInitPTS);break;default:break}}),E.on(L.default.FRAG_DECRYPTED,M),E.on(L.default.FRAG_PARSING_INIT_SEGMENT,M),E.on(L.default.FRAG_PARSED,M),E.on(L.default.ERROR,M),E.on(L.default.FRAG_PARSING_METADATA,M),E.on(L.default.FRAG_PARSING_USERDATA,M),E.on(L.default.INIT_PTS_FOUND,M),E.on(L.default.FRAG_PARSING_DATA,function(D,F){var q=[],G={event:D,data:F};F.data1&&(G.data1=F.data1.buffer,q.push(F.data1.buffer),delete F.data1),F.data2&&(G.data2=F.data2.buffer,q.push(F.data2.buffer),delete F.data2),A.postMessage(G,q)})};i.default=p},"./src/demux/id3.js":function(r,i,l){"use strict";l.r(i),l.d(i,"utf8ArrayToStr",function(){return c});var g=l("./src/utils/get-self-scope.js"),L=function(){function p(){}return p.isHeader=function(A,E){return E+10<=A.length&&A[E]===73&&A[E+1]===68&&A[E+2]===51&&A[E+3]<255&&A[E+4]<255&&A[E+6]<128&&A[E+7]<128&&A[E+8]<128&&A[E+9]<128},p.isFooter=function(A,E){return E+10<=A.length&&A[E]===51&&A[E+1]===68&&A[E+2]===73&&A[E+3]<255&&A[E+4]<255&&A[E+6]<128&&A[E+7]<128&&A[E+8]<128&&A[E+9]<128},p.getID3Data=function(A,E){for(var M=E,D=0;p.isHeader(A,E);){D+=10;var F=p._readSize(A,E+6);D+=F,p.isFooter(A,E+10)&&(D+=10),E+=D}if(D>0)return A.subarray(M,M+D)},p._readSize=function(A,E){var M=0;return M=(A[E]&127)<<21,M|=(A[E+1]&127)<<14,M|=(A[E+2]&127)<<7,M|=A[E+3]&127,M},p.getTimeStamp=function(A){for(var E=p.getID3Frames(A),M=0;M<E.length;M++){var D=E[M];if(p.isTimeStampFrame(D))return p._readTimeStamp(D)}},p.isTimeStampFrame=function(A){return A&&A.key==="PRIV"&&A.info==="com.apple.streaming.transportStreamTimestamp"},p._getFrameData=function(A){var E=String.fromCharCode(A[0],A[1],A[2],A[3]),M=p._readSize(A,4),D=10;return{type:E,size:M,data:A.subarray(D,D+M)}},p.getID3Frames=function(A){for(var E=0,M=[];p.isHeader(A,E);){var D=p._readSize(A,E+6);E+=10;for(var F=E+D;E+8<F;){var q=p._getFrameData(A.subarray(E)),G=p._decodeFrame(q);G&&M.push(G),E+=q.size+10}p.isFooter(A,E)&&(E+=10)}return M},p._decodeFrame=function(A){return A.type==="PRIV"?p._decodePrivFrame(A):A.type[0]==="W"?p._decodeURLFrame(A):p._decodeTextFrame(A)},p._readTimeStamp=function(A){if(A.data.byteLength===8){var E=new Uint8Array(A.data),M=E[3]&1,D=(E[4]<<23)+(E[5]<<15)+(E[6]<<7)+E[7];return D/=45,M&&(D+=4772185884e-2),Math.round(D)}},p._decodePrivFrame=function(A){if(!(A.size<2)){var E=p._utf8ArrayToStr(A.data,!0),M=new Uint8Array(A.data.subarray(E.length+1));return{key:A.type,info:E,data:M.buffer}}},p._decodeTextFrame=function(A){if(!(A.size<2))if(A.type==="TXXX"){var E=1,M=p._utf8ArrayToStr(A.data.subarray(E),!0);E+=M.length+1;var D=p._utf8ArrayToStr(A.data.subarray(E));return{key:A.type,info:M,data:D}}else{var F=p._utf8ArrayToStr(A.data.subarray(1));return{key:A.type,data:F}}},p._decodeURLFrame=function(A){if(A.type==="WXXX"){if(A.size<2)return;var E=1,M=p._utf8ArrayToStr(A.data.subarray(E),!0);E+=M.length+1;var D=p._utf8ArrayToStr(A.data.subarray(E));return{key:A.type,info:M,data:D}}else{var F=p._utf8ArrayToStr(A.data);return{key:A.type,data:F}}},p._utf8ArrayToStr=function(A,E){E===void 0&&(E=!1);var M=R();if(M){var D=M.decode(A);if(E){var F=D.indexOf("\0");return F!==-1?D.substring(0,F):D}return D.replace(/\0/g,"")}for(var q=A.length,G,B,U,K="",z=0;z<q;){if(G=A[z++],G===0&&E)return K;if(G===0||G===3)continue;switch(G>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:K+=String.fromCharCode(G);break;case 12:case 13:B=A[z++],K+=String.fromCharCode((G&31)<<6|B&63);break;case 14:B=A[z++],U=A[z++],K+=String.fromCharCode((G&15)<<12|(B&63)<<6|(U&63)<<0);break;default:}}return K},p}(),x;function R(){var p=Object(g.getSelfScope)();return!x&&typeof p.TextDecoder<"u"&&(x=new p.TextDecoder("utf-8")),x}var c=L._utf8ArrayToStr;i.default=L},"./src/demux/mp4demuxer.js":function(r,i,l){"use strict";l.r(i);var g=l("./src/utils/logger.js"),L=l("./src/events.js"),x=Math.pow(2,32)-1,R=function(){function c(O,A){this.observer=O,this.remuxer=A}var p=c.prototype;return p.resetTimeStamp=function(A){this.initPTS=A},p.resetInitSegment=function(A,E,M,D){if(A&&A.byteLength){var F=this.initData=c.parseInitSegment(A);E==null&&(E="mp4a.40.5"),M==null&&(M="avc1.42e01e");var q={};F.audio&&F.video?q.audiovideo={container:"video/mp4",codec:E+","+M,initSegment:D?A:null}:(F.audio&&(q.audio={container:"audio/mp4",codec:E,initSegment:D?A:null}),F.video&&(q.video={container:"video/mp4",codec:M,initSegment:D?A:null})),this.observer.trigger(L.default.FRAG_PARSING_INIT_SEGMENT,{tracks:q})}else E&&(this.audioCodec=E),M&&(this.videoCodec=M)},c.probe=function(A){return c.findBox({data:A,start:0,end:Math.min(A.length,16384)},["moof"]).length>0},c.bin2str=function(A){return String.fromCharCode.apply(null,A)},c.readUint16=function(A,E){A.data&&(E+=A.start,A=A.data);var M=A[E]<<8|A[E+1];return M<0?65536+M:M},c.readUint32=function(A,E){A.data&&(E+=A.start,A=A.data);var M=A[E]<<24|A[E+1]<<16|A[E+2]<<8|A[E+3];return M<0?4294967296+M:M},c.writeUint32=function(A,E,M){A.data&&(E+=A.start,A=A.data),A[E]=M>>24,A[E+1]=M>>16&255,A[E+2]=M>>8&255,A[E+3]=M&255},c.findBox=function(A,E){var M=[],D,F,q,G,B,U,K;if(A.data?(U=A.start,G=A.end,A=A.data):(U=0,G=A.byteLength),!E.length)return null;for(D=U;D<G;)F=c.readUint32(A,D),q=c.bin2str(A.subarray(D+4,D+8)),K=F>1?D+F:G,q===E[0]&&(E.length===1?M.push({data:A,start:D+8,end:K}):(B=c.findBox({data:A,start:D+8,end:K},E.slice(1)),B.length&&(M=M.concat(B)))),D=K;return M},c.parseSegmentIndex=function(A){var E=c.findBox(A,["moov"])[0],M=E?E.end:null,D=0,F=c.findBox(A,["sidx"]),q;if(!F||!F[0])return null;q=[],F=F[0];var G=F.data[0];D=G===0?8:16;var B=c.readUint32(F,D);D+=4;var U=0,K=0;G===0?D+=8:D+=16,D+=2;var z=F.end+K,$=c.readUint16(F,D);D+=2;for(var ae=0;ae<$;ae++){var ie=D,ne=c.readUint32(F,ie);ie+=4;var le=ne&2147483647,ce=(ne&2147483648)>>>31;if(ce===1){console.warn("SIDX has hierarchical references (not supported)");return}var Oe=c.readUint32(F,ie);ie+=4,q.push({referenceSize:le,subsegmentDuration:Oe,info:{duration:Oe/B,start:z,end:z+le-1}}),z+=le,ie+=4,D=ie}return{earliestPresentationTime:U,timescale:B,version:G,referencesCount:$,references:q,moovEndOffset:M}},c.parseInitSegment=function(A){var E=[],M=c.findBox(A,["moov","trak"]);return M.forEach(function(D){var F=c.findBox(D,["tkhd"])[0];if(F){var q=F.data[F.start],G=q===0?12:20,B=c.readUint32(F,G),U=c.findBox(D,["mdia","mdhd"])[0];if(U){q=U.data[U.start],G=q===0?12:20;var K=c.readUint32(U,G),z=c.findBox(D,["mdia","hdlr"])[0];if(z){var $=c.bin2str(z.data.subarray(z.start+8,z.start+12)),ae={soun:"audio",vide:"video"}[$];if(ae){var ie=c.findBox(D,["mdia","minf","stbl","stsd"]);if(ie.length){ie=ie[0];var ne=c.bin2str(ie.data.subarray(ie.start+12,ie.start+16));g.logger.log("MP4Demuxer:"+ae+":"+ne+" found")}E[B]={timescale:K,type:ae},E[ae]={timescale:K,id:B}}}}}}),E},c.getStartDTS=function(A,E){var M,D,F;return M=c.findBox(E,["moof","traf"]),D=[].concat.apply([],M.map(function(q){return c.findBox(q,["tfhd"]).map(function(G){var B,U,K;return B=c.readUint32(G,4),U=A[B].timescale||9e4,K=c.findBox(q,["tfdt"]).map(function(z){var $,ae;return $=z.data[z.start],ae=c.readUint32(z,4),$===1&&(ae*=Math.pow(2,32),ae+=c.readUint32(z,8)),ae})[0],K/U})})),F=Math.min.apply(null,D),isFinite(F)?F:0},c.offsetStartDTS=function(A,E,M){c.findBox(E,["moof","traf"]).map(function(D){return c.findBox(D,["tfhd"]).map(function(F){var q=c.readUint32(F,4),G=A[q].timescale||9e4;c.findBox(D,["tfdt"]).map(function(B){var U=B.data[B.start],K=c.readUint32(B,4);if(U===0)c.writeUint32(B,4,K-M*G);else{K*=Math.pow(2,32),K+=c.readUint32(B,8),K-=M*G,K=Math.max(K,0);var z=Math.floor(K/(x+1)),$=Math.floor(K%(x+1));c.writeUint32(B,4,z),c.writeUint32(B,8,$)}})})})},p.append=function(A,E,M,D){var F=this.initData;F||(this.resetInitSegment(A,this.audioCodec,this.videoCodec,!1),F=this.initData);var q,G=this.initPTS;if(G===void 0){var B=c.getStartDTS(F,A);this.initPTS=G=B-E,this.observer.trigger(L.default.INIT_PTS_FOUND,{initPTS:G})}c.offsetStartDTS(F,A,G),q=c.getStartDTS(F,A),this.remuxer.remux(F.audio,F.video,null,null,q,M,D,A)},p.destroy=function(){},c}();i.default=R},"./src/errors.ts":function(r,i,l){"use strict";l.r(i),l.d(i,"ErrorTypes",function(){return g}),l.d(i,"ErrorDetails",function(){return L});var g;(function(x){x.NETWORK_ERROR="networkError",x.MEDIA_ERROR="mediaError",x.KEY_SYSTEM_ERROR="keySystemError",x.MUX_ERROR="muxError",x.OTHER_ERROR="otherError"})(g||(g={}));var L;(function(x){x.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",x.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",x.KEY_SYSTEM_NO_SESSION="keySystemNoSession",x.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",x.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",x.MANIFEST_LOAD_ERROR="manifestLoadError",x.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",x.MANIFEST_PARSING_ERROR="manifestParsingError",x.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",x.LEVEL_EMPTY_ERROR="levelEmptyError",x.LEVEL_LOAD_ERROR="levelLoadError",x.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",x.LEVEL_SWITCH_ERROR="levelSwitchError",x.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",x.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",x.FRAG_LOAD_ERROR="fragLoadError",x.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",x.FRAG_DECRYPT_ERROR="fragDecryptError",x.FRAG_PARSING_ERROR="fragParsingError",x.REMUX_ALLOC_ERROR="remuxAllocError",x.KEY_LOAD_ERROR="keyLoadError",x.KEY_LOAD_TIMEOUT="keyLoadTimeOut",x.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",x.BUFFER_APPEND_ERROR="bufferAppendError",x.BUFFER_APPENDING_ERROR="bufferAppendingError",x.BUFFER_STALLED_ERROR="bufferStalledError",x.BUFFER_FULL_ERROR="bufferFullError",x.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",x.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",x.INTERNAL_EXCEPTION="internalException"})(L||(L={}))},"./src/events.js":function(r,i,l){"use strict";l.r(i);var g={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"};i.default=g},"./src/hls.ts":function(r,i,l){"use strict";l.r(i),l.d(i,"default",function(){return ui});var g={};l.r(g),l.d(g,"newCue",function(){return Ru});var L=l("./node_modules/url-toolkit/src/url-toolkit.js"),x=l("./src/errors.ts"),R=l("./src/polyfills/number.js"),c=l("./src/events.js"),p=l("./src/utils/logger.js"),O={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},A=function(){function d(o){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=o,this.onEvent=this.onEvent.bind(this);for(var a=arguments.length,e=new Array(a>1?a-1:0),t=1;t<a;t++)e[t-1]=arguments[t];this.handledEvents=e,this.useGenericHandler=!0,this.registerListeners()}var n=d.prototype;return n.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},n.onHandlerDestroying=function(){},n.onHandlerDestroyed=function(){},n.isEventHandler=function(){return typeof this.handledEvents=="object"&&this.handledEvents.length&&typeof this.onEvent=="function"},n.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){if(O[a])throw new Error("Forbidden event-name: "+a);this.hls.on(a,this.onEvent)},this)},n.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){this.hls.off(a,this.onEvent)},this)},n.onEvent=function(a,e){this.onEventGeneric(a,e)},n.onEventGeneric=function(a,e){var t=function(u,h){var m="on"+u.replace("hls","");if(typeof this[m]!="function")throw new Error("Event "+u+" has no generic handler in this "+this.constructor.name+" class (tried "+m+")");return this[m].bind(this,h)};try{t.call(this,a,e).call()}catch(s){p.logger.error("An internal error happened while handling event "+a+'. Error message: "'+s.message+'". Here is a stacktrace:',s),this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.OTHER_ERROR,details:x.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,err:s})}},d}(),E=A,M;(function(d){d.MANIFEST="manifest",d.LEVEL="level",d.AUDIO_TRACK="audioTrack",d.SUBTITLE_TRACK="subtitleTrack"})(M||(M={}));var D;(function(d){d.MAIN="main",d.AUDIO="audio",d.SUBTITLE="subtitle"})(D||(D={}));var F=l("./src/demux/mp4demuxer.js");function q(d,n){for(var o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function G(d,n,o){return n&&q(d.prototype,n),o&&q(d,o),d}var B=function(){function d(n,o){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=n,this.reluri=o}return G(d,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(L.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),d}();function U(d,n){for(var o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function K(d,n,o){return n&&U(d.prototype,n),o&&U(d,o),d}var z;(function(d){d.AUDIO="audio",d.VIDEO="video"})(z||(z={}));var $=function(){function d(){var o;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=(o={},o[z.AUDIO]=!1,o[z.VIDEO]=!1,o),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var n=d.prototype;return n.setByteRange=function(a,e){var t=a.split("@",2),s=[];t.length===1?s[0]=e?e.byteRangeEndOffset:0:s[0]=parseInt(t[1]),s[1]=parseInt(t[0])+s[0],this._byteRange=s},n.addElementaryStream=function(a){this._elementaryStreams[a]=!0},n.hasElementaryStream=function(a){return this._elementaryStreams[a]===!0},n.createInitializationVector=function(a){for(var e=new Uint8Array(16),t=12;t<16;t++)e[t]=a>>8*(15-t)&255;return e},n.setDecryptDataFromLevelKey=function(a,e){var t=a;return a?.method&&a.uri&&!a.iv&&(t=new B(a.baseuri,a.reluri),t.method=a.method,t.iv=this.createInitializationVector(e)),t},K(d,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(L.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(a){this._url=a}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var a=this.sn;typeof a!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&p.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),a=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,a)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(R.isFiniteNumber)(this.programDateTime))return null;var a=Object(R.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+a*1e3}},{key:"encrypted",get:function(){return!!(this.decryptdata&&this.decryptdata.uri!==null&&this.decryptdata.key===null)}}]),d}();function ae(d,n){for(var o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function ie(d,n,o){return n&&ae(d.prototype,n),o&&ae(d,o),d}var ne=function(){function d(n){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=n,this.version=null}return ie(d,[{key:"hasProgramDateTime",get:function(){return!!(this.fragments[0]&&Object(R.isFiniteNumber)(this.fragments[0].programDateTime))}}]),d}(),le=/^(\d+)x(\d+)$/,ce=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,Oe=function(){function d(o){typeof o=="string"&&(o=d.parseAttrList(o));for(var a in o)o.hasOwnProperty(a)&&(this[a]=o[a])}var n=d.prototype;return n.decimalInteger=function(a){var e=parseInt(this[a],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},n.hexadecimalInteger=function(a){if(this[a]){var e=(this[a]||"0x").slice(2);e=(e.length&1?"0":"")+e;for(var t=new Uint8Array(e.length/2),s=0;s<e.length/2;s++)t[s]=parseInt(e.slice(s*2,s*2+2),16);return t}else return null},n.hexadecimalIntegerAsNumber=function(a){var e=parseInt(this[a],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},n.decimalFloatingPoint=function(a){return parseFloat(this[a])},n.enumeratedString=function(a){return this[a]},n.decimalResolution=function(a){var e=le.exec(this[a]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},d.parseAttrList=function(a){var e,t={};for(ce.lastIndex=0;(e=ce.exec(a))!==null;){var s=e[2],u='"';s.indexOf(u)===0&&s.lastIndexOf(u)===s.length-1&&(s=s.slice(1,-1)),t[e[1]]=s}return t},d}(),de=Oe,ue={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function Te(d,n){var o=ue[n];return!!o&&o[d.slice(0,4)]===!0}function Ie(d,n){return MediaSource.isTypeSupported((n||"video")+'/mp4;codecs="'+d+'"')}var Me=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,ke=/#EXT-X-MEDIA:(.*)/g,Be=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Fe=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,qe=/\.(mp4|m4s|m4v|m4a)$/i,Ce=function(){function d(){}return d.findGroup=function(o,a){for(var e=0;e<o.length;e++){var t=o[e];if(t.id===a)return t}},d.convertAVC1ToAVCOTI=function(o){var a=o.split("."),e;return a.length>2?(e=a.shift()+".",e+=parseInt(a.shift()).toString(16),e+=("000"+parseInt(a.shift()).toString(16)).substr(-4)):e=o,e},d.resolve=function(o,a){return L.buildAbsoluteURL(a,o,{alwaysNormalize:!0})},d.parseMasterPlaylist=function(o,a){var e=[],t={},s=!1;Me.lastIndex=0;function u(N,W){["video","audio"].forEach(function(ee){var oe=N.filter(function(fe){return Te(fe,ee)});if(oe.length){var he=oe.filter(function(fe){return fe.lastIndexOf("avc1",0)===0||fe.lastIndexOf("mp4a",0)===0});W[ee+"Codec"]=he.length>0?he[0]:oe[0],N=N.filter(function(fe){return oe.indexOf(fe)===-1})}}),W.unknownCodecs=N}for(var h;(h=Me.exec(o))!=null;)if(h[1]){var m={},I=m.attrs=new de(h[1]);m.url=d.resolve(h[2],a);var T=I.decimalResolution("RESOLUTION");T&&(m.width=T.width,m.height=T.height),m.bitrate=I.decimalInteger("AVERAGE-BANDWIDTH")||I.decimalInteger("BANDWIDTH"),m.name=I.NAME,u([].concat((I.CODECS||"").split(/[ ,]+/)),m),m.videoCodec&&m.videoCodec.indexOf("avc1")!==-1&&(m.videoCodec=d.convertAVC1ToAVCOTI(m.videoCodec)),e.push(m)}else if(h[3]){var b=new de(h[3]);b["DATA-ID"]&&(s=!0,t[b["DATA-ID"]]=b)}return{levels:e,sessionData:s?t:null}},d.parseMasterPlaylistMedia=function(o,a,e,t){t===void 0&&(t=[]);var s,u=[],h=0;for(ke.lastIndex=0;(s=ke.exec(o))!==null;){var m=new de(s[1]);if(m.TYPE===e){var I={attrs:m,id:h++,groupId:m["GROUP-ID"],instreamId:m["INSTREAM-ID"],name:m.NAME||m.LANGUAGE,type:e,default:m.DEFAULT==="YES",autoselect:m.AUTOSELECT==="YES",forced:m.FORCED==="YES",lang:m.LANGUAGE};if(m.URI&&(I.url=d.resolve(m.URI,a)),t.length){var T=d.findGroup(t,I.groupId);I.audioCodec=T?T.codec:t[0].codec}u.push(I)}}return u},d.parseLevelPlaylist=function(o,a,e,t,s){var u=0,h=0,m=new ne(a),I=0,T=null,b=new $,N,W,ee,oe=null;for(Be.lastIndex=0;(N=Be.exec(o))!==null;){var he=N[1];if(he){b.duration=parseFloat(he);var fe=(" "+N[2]).slice(1);b.title=fe||null,b.tagList.push(fe?["INF",he,fe]:["INF",he])}else if(N[3]){if(Object(R.isFiniteNumber)(b.duration)){var ye=u++;b.type=t,b.start=h,ee&&(b.levelkey=ee),b.sn=ye,b.level=e,b.cc=I,b.urlId=s,b.baseurl=a,b.relurl=(" "+N[3]).slice(1),je(b,T),m.fragments.push(b),T=b,h+=b.duration,b=new $}}else if(N[4]){var Ae=(" "+N[4]).slice(1);T?b.setByteRange(Ae,T):b.setByteRange(Ae)}else if(N[5])b.rawProgramDateTime=(" "+N[5]).slice(1),b.tagList.push(["PROGRAM-DATE-TIME",b.rawProgramDateTime]),oe===null&&(oe=m.fragments.length);else{if(N=N[0].match(Fe),!N){p.logger.warn("No matches on slow regex match for level playlist!");continue}for(W=1;W<N.length&&!(typeof N[W]<"u");W++);var Ke=(" "+N[W+1]).slice(1),ut=(" "+N[W+2]).slice(1);switch(N[W]){case"#":b.tagList.push(ut?[Ke,ut]:[Ke]);break;case"PLAYLIST-TYPE":m.type=Ke.toUpperCase();break;case"MEDIA-SEQUENCE":u=m.startSN=parseInt(Ke);break;case"TARGETDURATION":m.targetduration=parseFloat(Ke);break;case"VERSION":m.version=parseInt(Ke);break;case"EXTM3U":break;case"ENDLIST":m.live=!1;break;case"DIS":I++,b.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":I=parseInt(Ke);break;case"KEY":{var Kt=Ke,_t=new de(Kt),da=_t.enumeratedString("METHOD"),xe=_t.URI,Ue=_t.hexadecimalInteger("IV"),vt=_t.KEYFORMAT||"identity";if(vt==="com.apple.streamingkeydelivery"){p.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}da&&(ee=new B(a,xe),xe&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(da)>=0&&(ee.method=da,ee.key=null,ee.iv=Ue));break}case"START":{var Da=new de(Ke),ka=Da.decimalFloatingPoint("TIME-OFFSET");Object(R.isFiniteNumber)(ka)&&(m.startTimeOffset=ka);break}case"MAP":{var Wa=new de(Ke);b.relurl=Wa.URI,Wa.BYTERANGE&&b.setByteRange(Wa.BYTERANGE),b.baseurl=a,b.level=e,b.type=t,b.sn="initSegment",m.initSegment=b,b=new $,b.rawProgramDateTime=m.initSegment.rawProgramDateTime;break}default:p.logger.warn("line parsed but not handled: "+N);break}}}return b=T,b&&!b.relurl&&(m.fragments.pop(),h-=b.duration),m.totalduration=h,m.averagetargetduration=h/m.fragments.length,m.endSN=u-1,m.startCC=m.fragments[0]?m.fragments[0].cc:0,m.endCC=I,!m.initSegment&&m.fragments.length&&m.fragments.every(function(Xr){return qe.test(Xr.relurl)})&&(p.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),b=new $,b.relurl=m.fragments[0].relurl,b.baseurl=a,b.level=e,b.type=t,b.sn="initSegment",m.initSegment=b,m.needSidxRanges=!0),oe&&Je(m.fragments,oe),m},d}();function Je(d,n){for(var o=d[n],a=n-1;a>=0;a--){var e=d[a];e.programDateTime=o.programDateTime-e.duration*1e3,o=e}}function je(d,n){d.rawProgramDateTime?d.programDateTime=Date.parse(d.rawProgramDateTime):n?.programDateTime&&(d.programDateTime=n.endProgramDateTime),Object(R.isFiniteNumber)(d.programDateTime)||(d.programDateTime=null,d.rawProgramDateTime=null)}function Pt(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var rt=window,De=rt.performance,ot=function(d){Pt(n,d);function n(a){var e;return e=d.call(this,a,c.default.MANIFEST_LOADING,c.default.LEVEL_LOADING,c.default.AUDIO_TRACK_LOADING,c.default.SUBTITLE_TRACK_LOADING)||this,e.loaders={},e}n.canHaveQualityLevels=function(e){return e!==M.AUDIO_TRACK&&e!==M.SUBTITLE_TRACK},n.mapContextToLevelType=function(e){var t=e.type;switch(t){case M.AUDIO_TRACK:return D.AUDIO;case M.SUBTITLE_TRACK:return D.SUBTITLE;default:return D.MAIN}},n.getResponseUrl=function(e,t){var s=e.url;return(s===void 0||s.indexOf("data:")===0)&&(s=t.url),s};var o=n.prototype;return o.createInternalLoader=function(e){var t=this.hls.config,s=t.pLoader,u=t.loader,h=s||u,m=new h(t);return e.loader=m,this.loaders[e.type]=m,m},o.getInternalLoader=function(e){return this.loaders[e.type]},o.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},o.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},o.destroy=function(){this.destroyInternalLoaders(),d.prototype.destroy.call(this)},o.onManifestLoading=function(e){this.load({url:e.url,type:M.MANIFEST,level:0,id:null,responseType:"text"})},o.onLevelLoading=function(e){this.load({url:e.url,type:M.LEVEL,level:e.level,id:e.id,responseType:"text"})},o.onAudioTrackLoading=function(e){this.load({url:e.url,type:M.AUDIO_TRACK,level:null,id:e.id,responseType:"text"})},o.onSubtitleTrackLoading=function(e){this.load({url:e.url,type:M.SUBTITLE_TRACK,level:null,id:e.id,responseType:"text"})},o.load=function(e){var t=this.hls.config;p.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var s=this.getInternalLoader(e);if(s){var u=s.context;if(u&&u.url===e.url)return p.logger.trace("playlist request ongoing"),!1;p.logger.warn("aborting previous loader for type: "+e.type),s.abort()}var h,m,I,T;switch(e.type){case M.MANIFEST:h=t.manifestLoadingMaxRetry,m=t.manifestLoadingTimeOut,I=t.manifestLoadingRetryDelay,T=t.manifestLoadingMaxRetryTimeout;break;case M.LEVEL:h=0,T=0,I=0,m=t.levelLoadingTimeOut;break;default:h=t.levelLoadingMaxRetry,m=t.levelLoadingTimeOut,I=t.levelLoadingRetryDelay,T=t.levelLoadingMaxRetryTimeout;break}s=this.createInternalLoader(e);var b={timeout:m,maxRetry:h,retryDelay:I,maxRetryDelay:T},N={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return p.logger.debug("Calling internal loader delegate for URL: "+e.url),s.load(e,b,N),!0},o.loadsuccess=function(e,t,s,u){if(u===void 0&&(u=null),s.isSidxRequest){this._handleSidxRequest(e,s),this._handlePlaylistLoaded(e,t,s,u);return}if(this.resetInternalLoader(s.type),typeof e.data!="string")throw new Error('expected responseType of "text" for PlaylistLoader');var h=e.data;if(t.tload=De.now(),h.indexOf("#EXTM3U")!==0){this._handleManifestParsingError(e,s,"no EXTM3U delimiter",u);return}h.indexOf("#EXTINF:")>0||h.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,s,u):this._handleMasterPlaylist(e,t,s,u)},o.loaderror=function(e,t,s){s===void 0&&(s=null),this._handleNetworkError(t,s,!1,e)},o.loadtimeout=function(e,t,s){s===void 0&&(s=null),this._handleNetworkError(t,s,!0)},o._handleMasterPlaylist=function(e,t,s,u){var h=this.hls,m=e.data,I=n.getResponseUrl(e,s),T=Ce.parseMasterPlaylist(m,I),b=T.levels,N=T.sessionData;if(!b.length){this._handleManifestParsingError(e,s,"no level found in manifest",u);return}var W=b.map(function(ye){return{id:ye.attrs.AUDIO,codec:ye.audioCodec}}),ee=Ce.parseMasterPlaylistMedia(m,I,"AUDIO",W),oe=Ce.parseMasterPlaylistMedia(m,I,"SUBTITLES"),he=Ce.parseMasterPlaylistMedia(m,I,"CLOSED-CAPTIONS");if(ee.length){var fe=!1;ee.forEach(function(ye){ye.url||(fe=!0)}),fe===!1&&b[0].audioCodec&&!b[0].attrs.AUDIO&&(p.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),ee.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))}h.trigger(c.default.MANIFEST_LOADED,{levels:b,audioTracks:ee,subtitles:oe,captions:he,url:I,stats:t,networkDetails:u,sessionData:N})},o._handleTrackOrLevelPlaylist=function(e,t,s,u){var h=this.hls,m=s.id,I=s.level,T=s.type,b=n.getResponseUrl(e,s),N=Object(R.isFiniteNumber)(m)?m:0,W=Object(R.isFiniteNumber)(I)?I:N,ee=n.mapContextToLevelType(s),oe=Ce.parseLevelPlaylist(e.data,b,W,ee,N);if(oe.tload=t.tload,!oe.fragments.length){h.trigger(c.default.ERROR,{type:x.ErrorTypes.NETWORK_ERROR,details:x.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:b,reason:"no fragments found in level",level:typeof s.level=="number"?s.level:void 0});return}if(T===M.MANIFEST){var he={url:b,details:oe};h.trigger(c.default.MANIFEST_LOADED,{levels:[he],audioTracks:[],url:b,stats:t,networkDetails:u,sessionData:null})}if(t.tparsed=De.now(),oe.needSidxRanges){var fe=oe.initSegment.url;this.load({url:fe,isSidxRequest:!0,type:T,level:I,levelDetails:oe,id:m,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"});return}s.levelDetails=oe,this._handlePlaylistLoaded(e,t,s,u)},o._handleSidxRequest=function(e,t){if(typeof e.data=="string")throw new Error("sidx request must be made with responseType of array buffer");var s=F.default.parseSegmentIndex(new Uint8Array(e.data));if(s){var u=s.references,h=t.levelDetails;u.forEach(function(m,I){var T=m.info;if(h){var b=h.fragments[I];b.byteRange.length===0&&b.setByteRange(String(1+T.end-T.start)+"@"+String(T.start))}}),h&&h.initSegment.setByteRange(String(s.moovEndOffset)+"@0")}},o._handleManifestParsingError=function(e,t,s,u){this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.NETWORK_ERROR,details:x.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:s,networkDetails:u})},o._handleNetworkError=function(e,t,s,u){s===void 0&&(s=!1),u===void 0&&(u=null),p.logger.info("A network error occured while loading a "+e.type+"-type playlist");var h,m,I=this.getInternalLoader(e);switch(e.type){case M.MANIFEST:h=s?x.ErrorDetails.MANIFEST_LOAD_TIMEOUT:x.ErrorDetails.MANIFEST_LOAD_ERROR,m=!0;break;case M.LEVEL:h=s?x.ErrorDetails.LEVEL_LOAD_TIMEOUT:x.ErrorDetails.LEVEL_LOAD_ERROR,m=!1;break;case M.AUDIO_TRACK:h=s?x.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:x.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,m=!1;break;default:m=!1}I&&(I.abort(),this.resetInternalLoader(e.type));var T={type:x.ErrorTypes.NETWORK_ERROR,details:h,fatal:m,url:e.url,loader:I,context:e,networkDetails:t};u&&(T.response=u),this.hls.trigger(c.default.ERROR,T)},o._handlePlaylistLoaded=function(e,t,s,u){var h=s.type,m=s.level,I=s.id,T=s.levelDetails;if(!T||!T.targetduration){this._handleManifestParsingError(e,s,"invalid target duration",u);return}var b=n.canHaveQualityLevels(s.type);if(b)this.hls.trigger(c.default.LEVEL_LOADED,{details:T,level:m||0,id:I||0,stats:t,networkDetails:u});else switch(h){case M.AUDIO_TRACK:this.hls.trigger(c.default.AUDIO_TRACK_LOADED,{details:T,id:I,stats:t,networkDetails:u});break;case M.SUBTITLE_TRACK:this.hls.trigger(c.default.SUBTITLE_TRACK_LOADED,{details:T,id:I,stats:t,networkDetails:u});break}},n}(E),nt=ot;function xt(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var _e=function(d){xt(n,d);function n(a){var e;return e=d.call(this,a,c.default.FRAG_LOADING)||this,e.loaders={},e}var o=n.prototype;return o.destroy=function(){var e=this.loaders;for(var t in e){var s=e[t];s&&s.destroy()}this.loaders={},d.prototype.destroy.call(this)},o.onFragLoading=function(e){var t=e.frag,s=t.type,u=this.loaders,h=this.hls.config,m=h.fLoader,I=h.loader;t.loaded=0;var T=u[s];T&&(p.logger.warn("abort previous fragment loader for type: "+s),T.abort()),T=u[s]=t.loader=h.fLoader?new m(h):new I(h);var b,N,W;b={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var ee=t.byteRangeStartOffset,oe=t.byteRangeEndOffset;Object(R.isFiniteNumber)(ee)&&Object(R.isFiniteNumber)(oe)&&(b.rangeStart=ee,b.rangeEnd=oe),N={timeout:h.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:h.fragLoadingMaxRetryTimeout},W={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},T.load(b,N,W)},o.loadsuccess=function(e,t,s,u){u===void 0&&(u=null);var h=e.data,m=s.frag;m.loader=void 0,this.loaders[m.type]=void 0,this.hls.trigger(c.default.FRAG_LOADED,{payload:h,frag:m,stats:t,networkDetails:u})},o.loaderror=function(e,t,s){s===void 0&&(s=null);var u=t.frag,h=u.loader;h&&h.abort(),this.loaders[u.type]=void 0,this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.NETWORK_ERROR,details:x.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:s})},o.loadtimeout=function(e,t,s){s===void 0&&(s=null);var u=t.frag,h=u.loader;h&&h.abort(),this.loaders[u.type]=void 0,this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.NETWORK_ERROR,details:x.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:s})},o.loadprogress=function(e,t,s,u){u===void 0&&(u=null);var h=t.frag;h.loaded=e.loaded,this.hls.trigger(c.default.FRAG_LOAD_PROGRESS,{frag:h,stats:e,networkDetails:u})},n}(E),Qe=_e;function ge(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var Se=function(d){ge(n,d);function n(a){var e;return e=d.call(this,a,c.default.KEY_LOADING)||this,e.loaders={},e.decryptkey=null,e.decrypturl=null,e}var o=n.prototype;return o.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},d.prototype.destroy.call(this)},o.onKeyLoading=function(e){var t=e.frag,s=t.type,u=this.loaders[s];if(!t.decryptdata){p.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var h=t.decryptdata.uri;if(h!==this.decrypturl||this.decryptkey===null){var m=this.hls.config;if(u&&(p.logger.warn("abort previous key loader for type:"+s),u.abort()),!h){p.logger.warn("key uri is falsy");return}t.loader=this.loaders[s]=new m.loader(m),this.decrypturl=h,this.decryptkey=null;var I={url:h,frag:t,responseType:"arraybuffer"},T={timeout:m.fragLoadingTimeOut,maxRetry:0,retryDelay:m.fragLoadingRetryDelay,maxRetryDelay:m.fragLoadingMaxRetryTimeout},b={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.loader.load(I,T,b)}else this.decryptkey&&(t.decryptdata.key=this.decryptkey,this.hls.trigger(c.default.KEY_LOADED,{frag:t}))},o.loadsuccess=function(e,t,s){var u=s.frag;if(!u.decryptdata){p.logger.error("after key load, decryptdata unset");return}this.decryptkey=u.decryptdata.key=new Uint8Array(e.data),u.loader=void 0,delete this.loaders[u.type],this.hls.trigger(c.default.KEY_LOADED,{frag:u})},o.loaderror=function(e,t){var s=t.frag,u=s.loader;u&&u.abort(),delete this.loaders[s.type],this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.NETWORK_ERROR,details:x.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:s,response:e})},o.loadtimeout=function(e,t){var s=t.frag,u=s.loader;u&&u.abort(),delete this.loaders[s.type],this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.NETWORK_ERROR,details:x.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:s})},n}(E),ve=Se;function He(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var Re={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},ct=function(d){He(n,d);function n(a){var e;return e=d.call(this,a,c.default.BUFFER_APPENDED,c.default.FRAG_BUFFERED,c.default.FRAG_LOADED)||this,e.bufferPadding=.2,e.fragments=Object.create(null),e.timeRanges=Object.create(null),e.config=a.config,e}var o=n.prototype;return o.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,E.prototype.destroy.call(this),d.prototype.destroy.call(this)},o.getBufferedFrag=function(e,t){var s=this.fragments,u=Object.keys(s).filter(function(m){var I=s[m];if(I.body.type!==t||!I.buffered)return!1;var T=I.body;return T.startPTS<=e&&e<=T.endPTS});if(u.length===0)return null;var h=u.pop();return s[h].body},o.detectEvictedFragments=function(e,t){var s=this;Object.keys(this.fragments).forEach(function(u){var h=s.fragments[u];if(!(!h||!h.buffered)){var m=h.range[e];if(m)for(var I=m.time,T=0;T<I.length;T++){var b=I[T];if(!s.isTimeBuffered(b.startPTS,b.endPTS,t)){s.removeFragment(h.body);break}}}})},o.detectPartialFragments=function(e){var t=this,s=this.getFragmentKey(e),u=this.fragments[s];u&&(u.buffered=!0,Object.keys(this.timeRanges).forEach(function(h){if(e.hasElementaryStream(h)){var m=t.timeRanges[h];u.range[h]=t.getBufferedTimes(e.startPTS,e.endPTS,m)}}))},o.getBufferedTimes=function(e,t,s){for(var u=[],h,m,I=!1,T=0;T<s.length;T++)if(h=s.start(T)-this.bufferPadding,m=s.end(T)+this.bufferPadding,e>=h&&t<=m){u.push({startPTS:Math.max(e,s.start(T)),endPTS:Math.min(t,s.end(T))});break}else if(e<m&&t>h)u.push({startPTS:Math.max(e,s.start(T)),endPTS:Math.min(t,s.end(T))}),I=!0;else if(t<=h)break;return{time:u,partial:I}},o.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},o.getPartialFragment=function(e){var t=this,s,u,h,m=null,I=0;return Object.keys(this.fragments).forEach(function(T){var b=t.fragments[T];t.isPartial(b)&&(u=b.body.startPTS-t.bufferPadding,h=b.body.endPTS+t.bufferPadding,e>=u&&e<=h&&(s=Math.min(e-u,h-e),I<=s&&(m=b.body,I=s)))}),m},o.getState=function(e){var t=this.getFragmentKey(e),s=this.fragments[t],u=Re.NOT_LOADED;return s!==void 0&&(s.buffered?this.isPartial(s)===!0?u=Re.PARTIAL:u=Re.OK:u=Re.APPENDING),u},o.isPartial=function(e){return e.buffered===!0&&(e.range.video!==void 0&&e.range.video.partial===!0||e.range.audio!==void 0&&e.range.audio.partial===!0)},o.isTimeBuffered=function(e,t,s){for(var u,h,m=0;m<s.length;m++){if(u=s.start(m)-this.bufferPadding,h=s.end(m)+this.bufferPadding,e>=u&&t<=h)return!0;if(t<=u)return!1}return!1},o.onFragLoaded=function(e){var t=e.frag;!Object(R.isFiniteNumber)(t.sn)||t.bitrateTest||(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},o.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(s){var u=t.timeRanges[s];t.detectEvictedFragments(s,u)})},o.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},o.hasFragment=function(e){var t=this.getFragmentKey(e);return this.fragments[t]!==void 0},o.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},o.removeAllFragments=function(){this.fragments=Object.create(null)},n}(E),k={search:function(n,o){for(var a=0,e=n.length-1,t=null,s=null;a<=e;){t=(a+e)/2|0,s=n[t];var u=o(s);if(u>0)a=t+1;else if(u<0)e=t-1;else return s}return null}},H=k,v=function(){function d(){}return d.isBuffered=function(o,a){try{if(o){for(var e=o.buffered,t=0;t<e.length;t++)if(a>=e.start(t)&&a<=e.end(t))return!0}}catch{}return!1},d.bufferInfo=function(o,a,e){try{if(o){var t=o.buffered,s=[],u;for(u=0;u<t.length;u++)s.push({start:t.start(u),end:t.end(u)});return this.bufferedInfo(s,a,e)}}catch{}return{len:0,start:a,end:a,nextStart:void 0}},d.bufferedInfo=function(o,a,e){o.sort(function(oe,he){var fe=oe.start-he.start;return fe||he.end-oe.end});var t=[];if(e)for(var s=0;s<o.length;s++){var u=t.length;if(u){var h=t[u-1].end;o[s].start-h<e?o[s].end>h&&(t[u-1].end=o[s].end):t.push(o[s])}else t.push(o[s])}else t=o;for(var m=0,I,T=a,b=a,N=0;N<t.length;N++){var W=t[N].start,ee=t[N].end;if(a+e>=W&&a<ee)T=W,b=ee,m=b-a;else if(a+e<W){I=W;break}}return{len:m,start:T,end:b,nextStart:I}},d}(),w=l("./node_modules/eventemitter3/index.js"),S=l("./node_modules/webworkify-webpack/index.js"),f=l("./src/demux/demuxer-inline.js");function y(){return window.MediaSource||window.WebKitMediaSource}var C=l("./src/utils/get-self-scope.js");function _(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var P=function(d){_(n,d);function n(){return d.apply(this,arguments)||this}var o=n.prototype;return o.trigger=function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),u=1;u<t;u++)s[u-1]=arguments[u];this.emit.apply(this,[e,e].concat(s))},n}(w.EventEmitter),V=Object(C.getSelfScope)(),j=y()||{isTypeSupported:function(){return!1}},Y=function(){function d(o,a){var e=this;this.hls=o,this.id=a;var t=this.observer=new P,s=o.config,u=function(b,N){N=N||{},N.frag=e.frag,N.id=e.id,o.trigger(b,N)};t.on(c.default.FRAG_DECRYPTED,u),t.on(c.default.FRAG_PARSING_INIT_SEGMENT,u),t.on(c.default.FRAG_PARSING_DATA,u),t.on(c.default.FRAG_PARSED,u),t.on(c.default.ERROR,u),t.on(c.default.FRAG_PARSING_METADATA,u),t.on(c.default.FRAG_PARSING_USERDATA,u),t.on(c.default.INIT_PTS_FOUND,u);var h={mp4:j.isTypeSupported("video/mp4"),mpeg:j.isTypeSupported("audio/mpeg"),mp3:j.isTypeSupported('audio/mp4; codecs="mp3"')},m=navigator.vendor;if(s.enableWorker&&typeof Worker<"u"){p.logger.log("demuxing in webworker");var I;try{I=this.w=S("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),I.addEventListener("message",this.onwmsg),I.onerror=function(T){o.trigger(c.default.ERROR,{type:x.ErrorTypes.OTHER_ERROR,details:x.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:T.message+" ("+T.filename+":"+T.lineno+")"}})},I.postMessage({cmd:"init",typeSupported:h,vendor:m,id:a,config:JSON.stringify(s)})}catch(T){p.logger.warn("Error in worker:",T),p.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),I&&V.URL.revokeObjectURL(I.objectURL),this.demuxer=new f.default(t,h,s,m),this.w=void 0}}else this.demuxer=new f.default(t,h,s,m)}var n=d.prototype;return n.destroy=function(){var a=this.w;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var t=this.observer;t&&(t.removeAllListeners(),this.observer=null)},n.push=function(a,e,t,s,u,h,m,I){var T=this.w,b=Object(R.isFiniteNumber)(u.startPTS)?u.startPTS:u.start,N=u.decryptdata,W=this.frag,ee=!(W&&u.cc===W.cc),oe=!(W&&u.level===W.level),he=W&&u.sn===W.sn+1,fe=!oe&&he;if(ee&&p.logger.log(this.id+":discontinuity detected"),oe&&p.logger.log(this.id+":switch detected"),this.frag=u,T)T.postMessage({cmd:"demux",data:a,decryptdata:N,initSegment:e,audioCodec:t,videoCodec:s,timeOffset:b,discontinuity:ee,trackSwitch:oe,contiguous:fe,duration:h,accurateTimeOffset:m,defaultInitPTS:I},a instanceof ArrayBuffer?[a]:[]);else{var ye=this.demuxer;ye&&ye.push(a,N,e,t,s,b,ee,oe,fe,h,m,I)}},n.onWorkerMessage=function(a){var e=a.data,t=this.hls;switch(e.event){case"init":V.URL.revokeObjectURL(this.w.objectURL);break;case c.default.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,t.trigger(e.event,e.data);break}},d}(),Z=Y;function Q(d,n,o){switch(n){case"audio":d.audioGroupIds||(d.audioGroupIds=[]),d.audioGroupIds.push(o);break;case"text":d.textGroupIds||(d.textGroupIds=[]),d.textGroupIds.push(o);break}}function J(d,n,o){var a=d[n],e=d[o],t=e.startPTS;if(Object(R.isFiniteNumber)(t))o>n?(a.duration=t-a.start,a.duration<0&&p.logger.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")):(e.duration=a.start-t,e.duration<0&&p.logger.warn("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!"));else if(o>n){var s=a.cc===e.cc;e.start=a.start+(s&&a.minEndPTS?a.minEndPTS-a.start:a.duration)}else e.start=Math.max(a.start-e.duration,0)}function re(d,n,o,a,e,t){var s=o,u=a;if(Object(R.isFiniteNumber)(n.startPTS)){var h=Math.abs(n.startPTS-o);Object(R.isFiniteNumber)(n.deltaPTS)?n.deltaPTS=Math.max(h,n.deltaPTS):n.deltaPTS=h,s=Math.max(o,n.startPTS),o=Math.min(o,n.startPTS),u=Math.min(a,n.endPTS),a=Math.max(a,n.endPTS),e=Math.min(e,n.startDTS),t=Math.max(t,n.endDTS)}var m=o-n.start;n.start=n.startPTS=o,n.maxStartPTS=s,n.endPTS=a,n.minEndPTS=u,n.startDTS=e,n.endDTS=t,n.duration=a-o;var I=n.sn;if(!d||I<d.startSN||I>d.endSN)return 0;var T,b,N;for(T=I-d.startSN,b=d.fragments,b[T]=n,N=T;N>0;N--)J(b,N,N-1);for(N=T;N<b.length-1;N++)J(b,N,N+1);return d.PTSKnown=!0,m}function se(d,n){n.initSegment&&d.initSegment&&(n.initSegment=d.initSegment);var o=0,a;if(Le(d,n,function(s,u){o=s.cc-u.cc,Object(R.isFiniteNumber)(s.startPTS)&&(u.start=u.startPTS=s.startPTS,u.endPTS=s.endPTS,u.duration=s.duration,u.backtracked=s.backtracked,u.dropped=s.dropped,a=u),n.PTSKnown=!0}),!!n.PTSKnown){if(o){p.logger.log("discontinuity sliding from playlist, take drift into account");for(var e=n.fragments,t=0;t<e.length;t++)e[t].cc+=o}a?re(n,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS):pe(d,n),n.PTSKnown=d.PTSKnown}}function te(d,n,o){o===void 0&&(o=0);var a=-1;Le(d,n,function(s,u,h){u.start=s.start,a=h});var e=n.fragments;if(a<0){e.forEach(function(s){s.start+=o});return}for(var t=a+1;t<e.length;t++)e[t].start=e[t-1].start+e[t-1].duration}function Le(d,n,o){if(!(!d||!n))for(var a=Math.max(d.startSN,n.startSN)-n.startSN,e=Math.min(d.endSN,n.endSN)-n.startSN,t=n.startSN-d.startSN,s=a;s<=e;s++){var u=d.fragments[t+s],h=n.fragments[s];if(!u||!h)break;o(u,h,s)}}function pe(d,n){var o=n.startSN-d.startSN,a=d.fragments,e=n.fragments;if(!(o<0||o>a.length))for(var t=0;t<e.length;t++)e[t].start+=a[o].start}function be(d,n,o){var a=1e3*(n.averagetargetduration?n.averagetargetduration:n.targetduration),e=a/2;return d&&n.endSN===d.endSN&&(a=e),o&&(a=Math.max(e,a-(window.performance.now()-o))),Math.round(a)}var Ne={toString:function(n){for(var o="",a=n.length,e=0;e<a;e++)o+="["+n.start(e).toFixed(3)+","+n.end(e).toFixed(3)+"]";return o}},Pe=Ne;function Xe(d,n){for(var o=null,a=0;a<d.length;a+=1){var e=d[a];if(e&&e.cc===n){o=e;break}}return o}function Ye(d,n){return H.search(d,function(o){return o.cc<n?1:o.cc>n?-1:0})}function st(d,n,o){var a=!1;return n&&n.details&&o&&(o.endCC>o.startCC||d&&d.cc<o.startCC)&&(a=!0),a}function $e(d,n){var o=d.fragments,a=n.fragments;if(!a.length||!o.length){p.logger.log("No fragments to align");return}var e=Xe(o,a[0].cc);if(!e||e&&!e.startPTS){p.logger.log("No frag in previous level to align on");return}return e}function we(d,n){n.fragments.forEach(function(o){if(o){var a=o.start+d;o.start=o.startPTS=a,o.endPTS=a+o.duration}}),n.PTSKnown=!0}function pt(d,n,o){Et(d,o,n),!o.PTSKnown&&n&&lt(o,n.details)}function Et(d,n,o){if(st(d,o,n)){var a=$e(o.details,n);a&&(p.logger.log("Adjusting PTS using last level due to CC increase within current level"),we(a.start,n))}}function lt(d,n){if(n&&n.fragments.length){if(!d.hasProgramDateTime||!n.hasProgramDateTime)return;var o=n.fragments[0].programDateTime,a=d.fragments[0].programDateTime,e=(a-o)/1e3+n.fragments[0].start;Object(R.isFiniteNumber)(e)&&(p.logger.log("adjusting PTS using programDateTime delta, sliding:"+e.toFixed(3)),we(e,d))}}function At(d,n,o){if(n===null||!Array.isArray(d)||!d.length||!Object(R.isFiniteNumber)(n))return null;var a=d[0].programDateTime;if(n<(a||0))return null;var e=d[d.length-1].endProgramDateTime;if(n>=(e||0))return null;o=o||0;for(var t=0;t<d.length;++t){var s=d[t];if(Lt(n,o,s))return s}return null}function ht(d,n,o,a){o===void 0&&(o=0),a===void 0&&(a=0);var e=null;if(d?e=n[d.sn-n[0].sn+1]:o===0&&n[0].start===0&&(e=n[0]),e&&wt(o,a,e)===0)return e;var t=H.search(n,wt.bind(null,o,a));return t||e}function wt(d,n,o){d===void 0&&(d=0),n===void 0&&(n=0);var a=Math.min(n,o.duration+(o.deltaPTS?o.deltaPTS:0));return o.start+o.duration-a<=d?1:o.start-a>d&&o.start?-1:0}function Lt(d,n,o){var a=Math.min(n,o.duration+(o.deltaPTS?o.deltaPTS:0))*1e3,e=o.endProgramDateTime||0;return e-a>d}var it=250,Bt=2,na=.1,qt=.05,yt=function(){function d(o,a,e,t){this.config=o,this.media=a,this.fragmentTracker=e,this.hls=t,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var n=d.prototype;return n.poll=function(a){var e=this.config,t=this.media,s=this.stalled,u=t.currentTime,h=t.seeking,m=this.seeking&&!h,I=!this.seeking&&h;if(this.seeking=h,u!==a){if(this.moved=!0,s!==null){if(this.stallReported){var T=self.performance.now()-s;p.logger.warn("playback not stuck anymore @"+u+", after "+Math.round(T)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((I||m)&&(this.stalled=null),!(t.paused||t.ended||t.playbackRate===0||!t.buffered.length)){var b=v.bufferInfo(t,u,0),N=b.len>0,W=b.nextStart||0;if(!(!N&&!W)){if(h){var ee=b.len>Bt,oe=!W||W-u>Bt&&!this.fragmentTracker.getPartialFragment(u);if(ee||oe)return;this.moved=!1}if(!this.moved&&this.stalled){var he=Math.max(W,b.start||0)-u;if(he>0&&he<=Bt){this._trySkipBufferHole(null);return}}var fe=self.performance.now();if(s===null){this.stalled=fe;return}var ye=fe-s;!h&&ye>=it&&this._reportStall(b.len);var Ae=v.bufferInfo(t,u,e.maxBufferHole);this._tryFixBufferStall(Ae,ye)}}},n._tryFixBufferStall=function(a,e){var t=this.config,s=this.fragmentTracker,u=this.media,h=u.currentTime,m=s.getPartialFragment(h);if(m){var I=this._trySkipBufferHole(m);if(I)return}a.len>t.maxBufferHole&&e>t.highBufferWatchdogPeriod*1e3&&(p.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},n._reportStall=function(a){var e=this.hls,t=this.media,s=this.stallReported;s||(this.stallReported=!0,p.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer (buffer="+a+")"),e.trigger(c.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:a}))},n._trySkipBufferHole=function(a){for(var e=this.config,t=this.hls,s=this.media,u=s.currentTime,h=0,m=0;m<s.buffered.length;m++){var I=s.buffered.start(m);if(u+e.maxBufferHole>=h&&u<I){var T=Math.max(I+qt,s.currentTime+na);return p.logger.warn("skipping hole, adjusting currentTime from "+u+" to "+T),this.moved=!0,this.stalled=null,s.currentTime=T,a&&t.trigger(c.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+u+" to "+T,frag:a}),T}h=s.buffered.end(m)}return 0},n._tryNudgeBuffer=function(){var a=this.config,e=this.hls,t=this.media,s=t.currentTime,u=(this.nudgeRetry||0)+1;if(this.nudgeRetry=u,u<a.nudgeMaxRetry){var h=s+u*a.nudgeOffset;p.logger.warn("Nudging 'currentTime' from "+s+" to "+h),t.currentTime=h,e.trigger(c.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else p.logger.error("Playhead still not moving while enough data buffered @"+s+" after "+a.nudgeMaxRetry+" nudges"),e.trigger(c.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},d}();function jt(d){if(d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d}function Yt(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var $t=function(d){Yt(n,d);function n(a){for(var e,t=arguments.length,s=new Array(t>1?t-1:0),u=1;u<t;u++)s[u-1]=arguments[u];return e=d.call.apply(d,[this,a].concat(s))||this,e._boundTick=void 0,e._tickTimer=null,e._tickInterval=null,e._tickCallCount=0,e._boundTick=e.tick.bind(jt(e)),e}var o=n.prototype;return o.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},o.hasInterval=function(){return!!this._tickInterval},o.hasNextTick=function(){return!!this._tickTimer},o.setInterval=function(e){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,e),!0)},o.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},o.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},o.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},o.doTick=function(){},n}(E);function xa(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var X={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},la=function(d){xa(n,d);function n(){return d.apply(this,arguments)||this}var o=n.prototype;return o.doTick=function(){},o.startLoad=function(){},o.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=X.STOPPED},o._streamEnded=function(e,t){var s=this.fragCurrent,u=this.fragmentTracker;if(!t.live&&s&&!s.backtracked&&s.sn===t.endSN&&!e.nextStart){var h=u.getState(s);return h===Re.PARTIAL||h===Re.OK}return!1},o.onMediaSeeking=function(){var e=this.config,t=this.media,s=this.mediaBuffer,u=this.state,h=t?t.currentTime:null,m=v.bufferInfo(s||t,h,this.config.maxBufferHole);if(p.logger.log("media seeking to "+(Object(R.isFiniteNumber)(h)?h.toFixed(3):h)),u===X.FRAG_LOADING){var I=this.fragCurrent;if(m.len===0&&I){var T=e.maxFragLookUpTolerance,b=I.start-T,N=I.start+I.duration+T;h<b||h>N?(I.loader&&(p.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),I.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=X.IDLE):p.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else u===X.ENDED&&(m.len===0&&(this.fragPrevious=null,this.fragCurrent=null),this.state=X.IDLE);t&&(this.lastCurrentTime=h),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=h),this.tick()},o.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},o.onHandlerDestroying=function(){this.stopLoad(),d.prototype.onHandlerDestroying.call(this)},o.onHandlerDestroyed=function(){this.state=X.STOPPED,this.fragmentTracker=null},o.computeLivePosition=function(e,t){var s=this.config.liveSyncDuration!==void 0?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-s)},n}($t);function Ft(d,n){for(var o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function Ht(d,n,o){return n&&Ft(d.prototype,n),o&&Ft(d,o),d}function va(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var La=100,Zt=function(d){va(n,d);function n(a,e){var t;return t=d.call(this,a,c.default.MEDIA_ATTACHED,c.default.MEDIA_DETACHING,c.default.MANIFEST_LOADING,c.default.MANIFEST_PARSED,c.default.LEVEL_LOADED,c.default.LEVELS_UPDATED,c.default.KEY_LOADED,c.default.FRAG_LOADED,c.default.FRAG_LOAD_EMERGENCY_ABORTED,c.default.FRAG_PARSING_INIT_SEGMENT,c.default.FRAG_PARSING_DATA,c.default.FRAG_PARSED,c.default.ERROR,c.default.AUDIO_TRACK_SWITCHING,c.default.AUDIO_TRACK_SWITCHED,c.default.BUFFER_CREATED,c.default.BUFFER_APPENDED,c.default.BUFFER_FLUSHED)||this,t.fragmentTracker=e,t.config=a.config,t.audioCodecSwap=!1,t._state=X.STOPPED,t.stallReported=!1,t.gapController=null,t.altAudio=!1,t.audioOnly=!1,t.bitrateTest=!1,t}var o=n.prototype;return o.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,s=this.hls;if(this.stopLoad(),this.setInterval(La),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var u=s.startLevel;u===-1&&(s.config.testBandwidth?(u=0,this.bitrateTest=!0):u=s.nextAutoLevel),this.level=s.nextLoadLevel=u,this.loadedmetadata=!1}t>0&&e===-1&&(p.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=X.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=X.STOPPED},o.stopLoad=function(){this.forceStartLoad=!1,d.prototype.stopLoad.call(this)},o.doTick=function(){switch(this.state){case X.BUFFER_FLUSHING:this.fragLoadError=0;break;case X.IDLE:this._doTickIdle();break;case X.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=X.IDLE);break;case X.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),s=this.retryDate;(!s||t>=s||this.media&&this.media.seeking)&&(p.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=X.IDLE);break;case X.ERROR:case X.STOPPED:case X.FRAG_LOADING:case X.PARSING:case X.PARSED:case X.ENDED:break;default:break}this._checkBuffer(),this._checkFragmentChanged()},o._doTickIdle=function(){var e=this.hls,t=e.config,s=this.media;if(!(this.levelLastLoaded===void 0||!s&&(this.startFragRequested||!t.startFragPrefetch))){if(this.altAudio&&this.audioOnly){this.demuxer.frag=null;return}var u;this.loadedmetadata?u=s.currentTime:u=this.nextLoadPosition;var h=e.nextLoadLevel,m=this.levels[h];if(m){var I=m.bitrate,T;I?T=Math.max(8*t.maxBufferSize/I,t.maxBufferLength):T=t.maxBufferLength,T=Math.min(T,t.maxMaxBufferLength);var b=u<t.maxBufferHole?Math.max(Bt,t.maxBufferHole):t.maxBufferHole,N=v.bufferInfo(this.mediaBuffer?this.mediaBuffer:s,u,b),W=N.len;if(!(W>=T)){p.logger.trace("buffer length of "+W.toFixed(3)+" is below max of "+T.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=h;var ee=m.details;if(!ee||ee.live&&this.levelLastLoaded!==h){this.state=X.WAITING_LEVEL;return}if(this._streamEnded(N,ee)){var oe={};this.altAudio&&(oe.type="video"),this.hls.trigger(c.default.BUFFER_EOS,oe),this.state=X.ENDED;return}this._fetchPayloadOrEos(u,N,ee)}}}},o._fetchPayloadOrEos=function(e,t,s){var u=this.fragPrevious,h=this.level,m=s.fragments,I=m.length;if(I!==0){var T=m[0].start,b=m[I-1].start+m[I-1].duration,N=t.end,W;if(s.initSegment&&!s.initSegment.data)W=s.initSegment;else if(s.live){var ee=this.config.initialLiveManifestSize;if(I<ee){p.logger.warn("Can not start playback of a level, reason: not enough fragments "+I+" < "+ee);return}if(W=this._ensureFragmentAtLivePoint(s,N,T,b,u,m),W===null)return}else N<T&&(W=m[0]);W||(W=this._findFragment(T,u,I,m,N,b,s)),W&&(W.encrypted?this._loadKey(W,s):this._loadFragment(W,s,e,N))}},o._ensureFragmentAtLivePoint=function(e,t,s,u,h,m){var I=this.hls.config,T=this.media,b,N=1/0;if(I.liveMaxLatencyDuration!==void 0?N=I.liveMaxLatencyDuration:Object(R.isFiniteNumber)(I.liveMaxLatencyDurationCount)&&(N=I.liveMaxLatencyDurationCount*e.targetduration),t<Math.max(s-I.maxFragLookUpTolerance,u-N)){var W=this.liveSyncPosition=this.computeLivePosition(s,e);t=W,T&&!T.paused&&T.readyState&&T.duration>W&&W>T.currentTime&&(p.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+W.toFixed(3)),T.currentTime=W),this.nextLoadPosition=W}if(e.PTSKnown&&t>u&&T&&T.readyState)return null;if(this.startFragRequested&&!e.PTSKnown&&h)if(e.hasProgramDateTime)p.logger.log("live playlist, switching playlist, load frag with same PDT: "+h.programDateTime),b=At(m,h.endProgramDateTime,I.maxFragLookUpTolerance);else{var ee=h.sn+1;if(ee>=e.startSN&&ee<=e.endSN){var oe=m[ee-e.startSN];h.cc===oe.cc&&(b=oe,p.logger.log("live playlist, switching playlist, load frag with next SN: "+b.sn))}b||(b=H.search(m,function(he){return h.cc-he.cc}),b&&p.logger.log("live playlist, switching playlist, load frag with same CC: "+b.sn))}return b},o._findFragment=function(e,t,s,u,h,m,I){var T=this.hls.config,b;if(h<m){var N=h>m-T.maxFragLookUpTolerance?0:T.maxFragLookUpTolerance;b=ht(t,u,h,N)}else b=u[s-1];if(b){var W=b.sn-I.startSN,ee=t&&b.level===t.level,oe=u[W-1],he=u[W+1];if(t&&b.sn===t.sn)if(ee&&!b.backtracked)if(b.sn<I.endSN){var fe=t.deltaPTS;fe&&fe>T.maxBufferHole&&t.dropped&&W?(b=oe,p.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(b=he,this.fragmentTracker.getState(b)!==Re.OK&&p.logger.log("Re-loading fragment with SN: "+b.sn))}else b=null;else b.backtracked&&(he&&he.backtracked?(p.logger.warn("Already backtracked from fragment "+he.sn+", will not backtrack to fragment "+b.sn+". Loading fragment "+he.sn),b=he):(p.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),b.dropped=0,oe?(b=oe,b.backtracked=!0):W&&(b=null)))}return b},o._loadKey=function(e,t){p.logger.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level),this.state=X.KEY_LOADING,this.hls.trigger(c.default.KEY_LOADING,{frag:e})},o._loadFragment=function(e,t,s,u){var h=this.fragmentTracker.getState(e);this.fragCurrent=e,e.sn!=="initSegment"&&(this.startFragRequested=!0),Object(R.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||h===Re.NOT_LOADED||h===Re.PARTIAL?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,p.logger.log("Loading "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(s.toFixed(3))+", bufferEnd: "+parseFloat(u.toFixed(3))),this.hls.trigger(c.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new Z(this.hls,"main")),this.state=X.FRAG_LOADING):h===Re.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},o.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,D.MAIN)},o.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},o._checkFragmentChanged=function(){var e,t,s=this.media;if(s&&s.readyState&&s.seeking===!1&&(t=s.currentTime,t>this.lastCurrentTime&&(this.lastCurrentTime=t),v.isBuffered(s,t)?e=this.getBufferedFrag(t):v.isBuffered(s,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var u=e;if(u!==this.fragPlaying){this.hls.trigger(c.default.FRAG_CHANGED,{frag:u});var h=u.level;(!this.fragPlaying||this.fragPlaying.level!==h)&&this.hls.trigger(c.default.LEVEL_SWITCHED,{level:h}),this.fragPlaying=u}}},o.immediateLevelSwitch=function(){if(p.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t;e?(t=e.paused,t||e.pause()):t=!0,this.previouslyPaused=t}var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},o.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,e.currentTime>0&&v.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},o.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,s=this.getBufferedFrag(e.currentTime);if(s&&s.startPTS>1&&this.flushMainBuffer(0,s.startPTS-1),e.paused)t=0;else{var u=this.hls.nextLoadLevel,h=this.levels[u],m=this.fragLastKbps;m&&this.fragCurrent?t=this.fragCurrent.duration*h.bitrate/(1e3*m)+1:t=0}var I=this.getBufferedFrag(e.currentTime+t);if(I){var T=this.followingBufferedFrag(I);if(T){var b=this.fragCurrent;b&&b.loader&&b.loader.abort(),this.fragCurrent=null;var N=Math.max(I.endPTS,T.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,T.duration));this.flushMainBuffer(N,Number.POSITIVE_INFINITY)}}}},o.flushMainBuffer=function(e,t){this.state=X.BUFFER_FLUSHING;var s={startOffset:e,endOffset:t};this.altAudio&&(s.type="video"),this.hls.trigger(c.default.BUFFER_FLUSHING,s)},o.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var s=this.config;this.levels&&s.autoStartLoad&&this.hls.startLoad(s.startPosition),this.gapController=new yt(s,t,this.fragmentTracker,this.hls)},o.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(p.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(s){s.details&&s.details.fragments.forEach(function(u){u.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},o.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;Object(R.isFiniteNumber)(t)&&p.logger.log("media seeked to "+t.toFixed(3)),this.tick()},o.onManifestLoading=function(){p.logger.log("trigger BUFFER_RESET"),this.hls.trigger(c.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},o.onManifestParsed=function(e){var t=!1,s=!1,u;e.levels.forEach(function(m){u=m.audioCodec,u&&(u.indexOf("mp4a.40.2")!==-1&&(t=!0),u.indexOf("mp4a.40.5")!==-1&&(s=!0))}),this.audioCodecSwitch=t&&s,this.audioCodecSwitch&&p.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=e.altAudio,this.levels=e.levels,this.startFragRequested=!1;var h=this.config;(h.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(h.startPosition)},o.onLevelLoaded=function(e){var t=e.details,s=e.level,u=this.levels[this.levelLastLoaded],h=this.levels[s],m=t.totalduration,I=0;if(p.logger.log("level "+s+" loaded ["+t.startSN+","+t.endSN+"],duration:"+m),t.live||h.details&&h.details.live){var T=h.details;T&&t.fragments.length>0?(se(T,t),I=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(I,T),t.PTSKnown&&Object(R.isFiniteNumber)(I)?p.logger.log("live playlist sliding:"+I.toFixed(3)):(p.logger.log("live playlist - outdated PTS, unknown sliding"),pt(this.fragPrevious,u,t))):(p.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,pt(this.fragPrevious,u,t))}else t.PTSKnown=!1;if(h.details=t,this.levelLastLoaded=s,this.hls.trigger(c.default.LEVEL_UPDATED,{details:t,level:s}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var b=t.startTimeOffset;Object(R.isFiniteNumber)(b)?(b<0&&(p.logger.log("negative start time offset "+b+", count from end of last fragment"),b=I+m+b),p.logger.log("start time offset found in playlist, adjust startPosition to "+b),this.startPosition=b):t.live?(this.startPosition=this.computeLivePosition(I,t),p.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===X.WAITING_LEVEL&&(this.state=X.IDLE),this.tick()},o.onKeyLoaded=function(){this.state===X.KEY_LOADING&&(this.state=X.IDLE,this.tick())},o.onFragLoaded=function(e){var t=this.fragCurrent,s=this.hls,u=this.levels,h=this.media,m=e.frag;if(this.state===X.FRAG_LOADING&&t&&m.type==="main"&&m.level===t.level&&m.sn===t.sn){var I=e.stats,T=u[t.level],b=T.details;if(this.bitrateTest=!1,this.stats=I,p.logger.log("Loaded "+t.sn+" of ["+b.startSN+" ,"+b.endSN+"],level "+t.level),m.bitrateTest&&s.nextLoadLevel)this.state=X.IDLE,this.startFragRequested=!1,I.tparsed=I.tbuffered=window.performance.now(),s.trigger(c.default.FRAG_BUFFERED,{stats:I,frag:t,id:"main"}),this.tick();else if(m.sn==="initSegment")this.state=X.IDLE,I.tparsed=I.tbuffered=window.performance.now(),b.initSegment.data=e.payload,s.trigger(c.default.FRAG_BUFFERED,{stats:I,frag:t,id:"main"}),this.tick();else{p.logger.log("Parsing "+t.sn+" of ["+b.startSN+" ,"+b.endSN+"],level "+t.level+", cc "+t.cc),this.state=X.PARSING,this.pendingBuffering=!0,this.appended=!1,m.bitrateTest&&(m.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:m}));var N=!(h&&h.seeking)&&(b.PTSKnown||!b.live),W=b.initSegment?b.initSegment.data:[],ee=this._getAudioCodec(T),oe=this.demuxer=this.demuxer||new Z(this.hls,"main");oe.push(e.payload,W,ee,T.videoCodec,t,b.totalduration,N)}}this.fragLoadError=0},o.onFragParsingInitSegment=function(e){var t=this.fragCurrent,s=e.frag;if(t&&e.id==="main"&&s.sn===t.sn&&s.level===t.level&&this.state===X.PARSING){var u=e.tracks,h,m;if(this.audioOnly=u.audio&&!u.video,this.altAudio&&!this.audioOnly&&delete u.audio,m=u.audio,m){var I=this.levels[this.level].audioCodec,T=navigator.userAgent.toLowerCase();I&&this.audioCodecSwap&&(p.logger.log("swapping playlist audio codec"),I.indexOf("mp4a.40.5")!==-1?I="mp4a.40.2":I="mp4a.40.5"),this.audioCodecSwitch&&m.metadata.channelCount!==1&&T.indexOf("firefox")===-1&&(I="mp4a.40.5"),T.indexOf("android")!==-1&&m.container!=="audio/mpeg"&&(I="mp4a.40.2",p.logger.log("Android: force audio codec to "+I)),m.levelCodec=I,m.id=e.id}m=u.video,m&&(m.levelCodec=this.levels[this.level].videoCodec,m.id=e.id),this.hls.trigger(c.default.BUFFER_CODECS,u);for(h in u){m=u[h],p.logger.log("main track:"+h+",container:"+m.container+",codecs[level/parsed]=["+m.levelCodec+"/"+m.codec+"]");var b=m.initSegment;b&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(c.default.BUFFER_APPENDING,{type:h,data:b,parent:"main",content:"initSegment"}))}this.tick()}},o.onFragParsingData=function(e){var t=this,s=this.fragCurrent,u=e.frag;if(s&&e.id==="main"&&u.sn===s.sn&&u.level===s.level&&!(e.type==="audio"&&this.altAudio)&&this.state===X.PARSING){var h=this.levels[this.level],m=s;if(Object(R.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+s.duration,e.endDTS=e.startDTS+s.duration),e.hasAudio===!0&&m.addElementaryStream(z.AUDIO),e.hasVideo===!0&&m.addElementaryStream(z.VIDEO),p.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),e.type==="video")if(m.dropped=e.dropped,m.dropped)if(m.backtracked)p.logger.warn("Already backtracked on this fragment, appending with the gap",m.sn);else{var I=h.details;if(I&&m.sn===I.startSN)p.logger.warn("missing video frame(s) on first frag, appending with gap",m.sn);else{p.logger.warn("missing video frame(s), backtracking fragment",m.sn),this.fragmentTracker.removeFragment(m),m.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=X.IDLE,this.fragPrevious=m,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.tick();return}}else m.backtracked=!1;var T=re(h.details,m,e.startPTS,e.endPTS,e.startDTS,e.endDTS),b=this.hls;b.trigger(c.default.LEVEL_PTS_UPDATED,{details:h.details,level:this.level,drift:T,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(N){N&&N.length&&t.state===X.PARSING&&(t.appended=!0,t.pendingBuffering=!0,b.trigger(c.default.BUFFER_APPENDING,{type:e.type,data:N,parent:"main",content:"data"}))}),this.tick()}},o.onFragParsed=function(e){var t=this.fragCurrent,s=e.frag;t&&e.id==="main"&&s.sn===t.sn&&s.level===t.level&&this.state===X.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=X.PARSED,this._checkAppendedParsed())},o.onAudioTrackSwitching=function(e){var t=this.altAudio,s=!!e.url,u=e.id;if(!s){if(this.mediaBuffer!==this.media){p.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var h=this.fragCurrent;h.loader&&(p.logger.log("switching to main audio track, cancel main fragment load"),h.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=X.IDLE}var m=this.hls;t&&m.trigger(c.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),m.trigger(c.default.AUDIO_TRACK_SWITCHED,{id:u})}},o.onAudioTrackSwitched=function(e){var t=e.id,s=!!this.hls.audioTracks[t].url;if(s){var u=this.videoBuffer;u&&this.mediaBuffer!==u&&(p.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=u)}this.altAudio=s,this.tick()},o.onBufferCreated=function(e){var t=e.tracks,s,u,h=!1;for(var m in t){var I=t[m];I.id==="main"?(u=m,s=I,m==="video"&&(this.videoBuffer=t[m].buffer)):h=!0}h&&s?(p.logger.log("alternate track found, use "+u+".buffered to schedule main fragment loading"),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media},o.onBufferAppended=function(e){if(e.parent==="main"){var t=this.state;(t===X.PARSING||t===X.PARSED)&&(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},o._checkAppendedParsed=function(){if(this.state===X.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;p.logger.log("main buffered : "+Pe.toString(t.buffered)),this.fragPrevious=e;var s=this.stats;s.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*s.total/(s.tbuffered-s.tfirst)),this.hls.trigger(c.default.FRAG_BUFFERED,{stats:s,frag:e,id:"main"}),this.state=X.IDLE}(this.loadedmetadata||this.startPosition<=0)&&this.tick()}},o.onError=function(e){var t=e.frag||this.fragCurrent;if(!(t&&t.type!=="main")){var s=!!this.media&&v.isBuffered(this.media,this.media.currentTime)&&v.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:case x.ErrorDetails.KEY_LOAD_ERROR:case x.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var u=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);p.logger.warn("mediaController: frag loading failed, retry in "+u+" ms"),this.retryDate=window.performance.now()+u,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=X.FRAG_LOADING_WAITING_RETRY}else p.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=X.ERROR;break;case x.ErrorDetails.LEVEL_LOAD_ERROR:case x.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==X.ERROR&&(e.fatal?(this.state=X.ERROR,p.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):!e.levelRetry&&this.state===X.WAITING_LEVEL&&(this.state=X.IDLE));break;case x.ErrorDetails.BUFFER_FULL_ERROR:e.parent==="main"&&(this.state===X.PARSING||this.state===X.PARSED)&&(s?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=X.IDLE):(p.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)));break;default:break}}},o._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e?(t.maxMaxBufferLength/=2,p.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0):!1},o._checkBuffer=function(){var e=this.media;if(!(!e||e.readyState===0)){var t=this.mediaBuffer?this.mediaBuffer:e,s=t.buffered;!this.loadedmetadata&&s.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,s)}},o.onFragLoadEmergencyAborted=function(){this.state=X.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},o.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;if(e){var t=this.audioOnly?z.AUDIO:z.VIDEO;this.fragmentTracker.detectEvictedFragments(t,e.buffered)}this.state=X.IDLE,this.fragPrevious=null},o.onLevelsUpdated=function(e){this.levels=e.levels},o.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},o._seekToStartPos=function(){var e=this.media,t=e.currentTime,s=this.startPosition;if(t!==s&&s>=0){if(e.seeking){p.logger.log("could not seek to "+s+", already seeking at "+t);return}var u=e.buffered.length?e.buffered.start(0):0,h=u-s;h>0&&h<this.config.maxBufferHole&&(p.logger.log("adjusting start position by "+h+" to match buffer start"),s+=h,this.startPosition=s),p.logger.log("seek to target start position "+s+" from current time "+t+". ready state "+e.readyState),e.currentTime=s}},o._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(p.logger.log("swapping playlist audio codec"),t&&(t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5")),t},Ht(n,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,p.logger.log("main stream-controller: "+t+"->"+e),this.hls.trigger(c.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),n}(la),Va=Zt;function Nr(d,n){for(var o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function Ur(d,n,o){return n&&Nr(d.prototype,n),o&&Nr(d,o),d}function To(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var ba,Gr=function(d){To(n,d);function n(a){var e;return e=d.call(this,a,c.default.MANIFEST_LOADED,c.default.LEVEL_LOADED,c.default.AUDIO_TRACK_SWITCHED,c.default.FRAG_LOADED,c.default.ERROR)||this,e.canload=!1,e.currentLevelIndex=null,e.manualLevelIndex=-1,e.timer=null,ba=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),e}var o=n.prototype;return o.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},o.clearTimer=function(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)},o.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(t){t.loadError=0;var s=t.details;s&&s.live&&(t.details=void 0)}),this.timer!==null&&this.loadLevel()},o.stopLoad=function(){this.canload=!1},o.onManifestLoaded=function(e){var t=[],s=[],u,h={},m=null,I=!1,T=!1;if(e.levels.forEach(function(W){var ee=W.attrs;W.loadError=0,W.fragmentError=!1,I=I||!!W.videoCodec,T=T||!!W.audioCodec,ba&&W.audioCodec&&W.audioCodec.indexOf("mp4a.40.34")!==-1&&(W.audioCodec=void 0),m=h[W.bitrate],m?m.url.push(W.url):(W.url=[W.url],W.urlId=0,h[W.bitrate]=W,t.push(W)),ee&&(ee.AUDIO&&Q(m||W,"audio",ee.AUDIO),ee.SUBTITLES&&Q(m||W,"text",ee.SUBTITLES))}),I&&T&&(t=t.filter(function(W){var ee=W.videoCodec;return!!ee})),t=t.filter(function(W){var ee=W.audioCodec,oe=W.videoCodec;return(!ee||Ie(ee,"audio"))&&(!oe||Ie(oe,"video"))}),e.audioTracks&&(s=e.audioTracks.filter(function(W){return!W.audioCodec||Ie(W.audioCodec,"audio")}),s.forEach(function(W,ee){W.id=ee})),t.length>0){u=t[0].bitrate,t.sort(function(W,ee){return W.bitrate-ee.bitrate}),this._levels=t;for(var b=0;b<t.length;b++)if(t[b].bitrate===u){this._firstLevel=b,p.logger.log("manifest loaded,"+t.length+" level(s) found, first bitrate:"+u);break}var N=T&&!I;this.hls.trigger(c.default.MANIFEST_PARSED,{levels:t,audioTracks:s,firstLevel:this._firstLevel,stats:e.stats,audio:T,video:I,altAudio:!N&&s.some(function(W){return!!W.url})})}else this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},o.setLevelInternal=function(e){var t=this._levels,s=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){p.logger.log("switching to level "+e),this.currentLevelIndex=e;var u=t[e];u.level=e,s.trigger(c.default.LEVEL_SWITCHING,u)}var h=t[e],m=h.details;if(!m||m.live){var I=h.urlId;s.trigger(c.default.LEVEL_LOADING,{url:h.url[I],level:e,id:I})}}else s.trigger(c.default.ERROR,{type:x.ErrorTypes.OTHER_ERROR,details:x.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},o.onError=function(e){if(e.fatal){e.type===x.ErrorTypes.NETWORK_ERROR&&this.clearTimer();return}var t=!1,s=!1,u;switch(e.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:case x.ErrorDetails.KEY_LOAD_ERROR:case x.ErrorDetails.KEY_LOAD_TIMEOUT:u=e.frag.level,s=!0;break;case x.ErrorDetails.LEVEL_LOAD_ERROR:case x.ErrorDetails.LEVEL_LOAD_TIMEOUT:u=e.context.level,t=!0;break;case x.ErrorDetails.REMUX_ALLOC_ERROR:u=e.level,t=!0;break}u!==void 0&&this.recoverLevel(e,u,t,s)},o.recoverLevel=function(e,t,s,u){var h=this,m=this.hls.config,I=e.details,T=this._levels[t],b,N,W;if(T.loadError++,T.fragmentError=u,s)if(this.levelRetryCount+1<=m.levelLoadingMaxRetry)N=Math.min(Math.pow(2,this.levelRetryCount)*m.levelLoadingRetryDelay,m.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return h.loadLevel()},N),e.levelRetry=!0,this.levelRetryCount++,p.logger.warn("level controller, "+I+", retry in "+N+" ms, current retry count is "+this.levelRetryCount);else{p.logger.error("level controller, cannot recover from "+I+" error"),this.currentLevelIndex=null,this.clearTimer(),e.fatal=!0;return}(s||u)&&(b=T.url.length,b>1&&T.loadError<b?(T.urlId=(T.urlId+1)%b,T.details=void 0,p.logger.warn("level controller, "+I+" for level "+t+": switching to redundant URL-id "+T.urlId)):this.manualLevelIndex===-1?(W=t===0?this._levels.length-1:t-1,p.logger.warn("level controller, "+I+": switch to "+W),this.hls.nextAutoLevel=this.currentLevelIndex=W):u&&(p.logger.warn("level controller, "+I+": reload a fragment"),this.currentLevelIndex=null))},o.onFragLoaded=function(e){var t=e.frag;if(t!==void 0&&t.type==="main"){var s=this._levels[t.level];s!==void 0&&(s.fragmentError=!1,s.loadError=0,this.levelRetryCount=0)}},o.onLevelLoaded=function(e){var t=this,s=e.level,u=e.details;if(s===this.currentLevelIndex){var h=this._levels[s];if(h.fragmentError||(h.loadError=0,this.levelRetryCount=0),u.live){var m=be(h.details,u,e.stats.trequest);p.logger.log("live playlist, reload in "+Math.round(m)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},m)}else this.clearTimer()}},o.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,s=this.hls.levels[this.currentLevelIndex];if(s&&s.audioGroupIds){for(var u=-1,h=0;h<s.audioGroupIds.length;h++)if(s.audioGroupIds[h]===t){u=h;break}u!==s.urlId&&(s.urlId=u,this.startLoad())}},o.loadLevel=function(){if(p.logger.debug("call to loadLevel"),this.currentLevelIndex!==null&&this.canload){var e=this._levels[this.currentLevelIndex];if(typeof e=="object"&&e.url.length>0){var t=this.currentLevelIndex,s=e.urlId,u=e.url[s];p.logger.log("Attempt loading level index "+t+" with URL-id "+s),this.hls.trigger(c.default.LEVEL_LOADING,{url:u,level:t,id:s})}}},o.removeLevel=function(e,t){var s=this.levels.filter(function(u,h){return h!==e?!0:u.url.length>1&&t!==void 0?(u.url=u.url.filter(function(m,I){return I!==t}),u.urlId=0,!0):!1}).map(function(u,h){var m=u.details;return m&&m.fragments&&m.fragments.forEach(function(I){I.level=h}),u});this._levels=s,this.hls.trigger(c.default.LEVELS_UPDATED,{levels:s})},Ur(n,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),(this.currentLevelIndex!==e||!t[e].details)&&this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var e=this.hls.config.startLevel;return e!==void 0?e:this._firstLevel}else return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}}]),n}(E),ha=l("./src/demux/id3.js");function Vr(d,n){var o;try{o=new Event("addtrack")}catch{o=document.createEvent("Event"),o.initEvent("addtrack",!1,!1)}o.track=d,n.dispatchEvent(o)}function ya(d){if(d?.cues)for(;d.cues.length>0;)d.removeCue(d.cues[0])}function qa(d,n){if(n<d[0].endTime)return d[0];if(n>d[d.length-1].endTime)return d[d.length-1];for(var o=0,a=d.length-1;o<=a;){var e=Math.floor((a+o)/2);if(n<d[e].endTime)a=e-1;else if(n>d[e].endTime)o=e+1;else return d[e]}return d[o].endTime-n<n-d[a].endTime?d[o]:d[a]}function bo(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var qr=.25,Hr=function(d){bo(n,d);function n(a){var e;return e=d.call(this,a,c.default.MEDIA_ATTACHED,c.default.MEDIA_DETACHING,c.default.FRAG_PARSING_METADATA,c.default.LIVE_BACK_BUFFER_REACHED)||this,e.id3Track=void 0,e.media=void 0,e}var o=n.prototype;return o.destroy=function(){E.prototype.destroy.call(this)},o.onMediaAttached=function(e){this.media=e.media,this.media},o.onMediaDetaching=function(){ya(this.id3Track),this.id3Track=void 0,this.media=void 0},o.getID3Track=function(e){for(var t=0;t<e.length;t++){var s=e[t];if(s.kind==="metadata"&&s.label==="id3")return Vr(s,this.media),s}return this.media.addTextTrack("metadata","id3")},o.onFragParsingMetadata=function(e){var t=e.frag,s=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var u=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,h=0;h<s.length;h++){var m=ha.default.getID3Frames(s[h].data);if(m){var I=Math.max(s[h].pts,0),T=h<s.length-1?s[h+1].pts:t.endPTS;T||(T=t.start+t.duration);var b=T-I;b<=0&&(T=I+qr);for(var N=0;N<m.length;N++){var W=m[N];if(!ha.default.isTimeStampFrame(W)){var ee=new u(I,T,"");ee.value=W,this.id3Track.addCue(ee)}}}}},o.onLiveBackBufferReached=function(e){var t=e.bufferEnd,s=this.id3Track;if(!(!s||!s.cues||!s.cues.length)){var u=qa(s.cues,t);if(u)for(;s.cues[0]!==u;)s.removeCue(s.cues[0])}},n}(E),wa=Hr;function Ha(){var d=y();if(!d)return!1;var n=self.SourceBuffer||self.WebKitSourceBuffer,o=d&&typeof d.isTypeSupported=="function"&&d.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),a=!n||n.prototype&&typeof n.prototype.appendBuffer=="function"&&typeof n.prototype.remove=="function";return!!o&&!!a}var wo=function(){function d(o){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=o?Math.exp(Math.log(.5)/o):0,this.estimate_=0,this.totalWeight_=0}var n=d.prototype;return n.sample=function(a,e){var t=Math.pow(this.alpha_,a);this.estimate_=e*(1-t)+t*this.estimate_,this.totalWeight_+=a},n.getTotalWeight=function(){return this.totalWeight_},n.getEstimate=function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/a}else return this.estimate_},d}(),Kr=wo,Xl=function(){function d(o,a,e,t){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=o,this.defaultEstimate_=t,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Kr(a),this.fast_=new Kr(e)}var n=d.prototype;return n.sample=function(a,e){a=Math.max(a,this.minDelayMs_);var t=8*e,s=a/1e3,u=t/s;this.fast_.sample(s,u),this.slow_.sample(s,u)},n.canEstimate=function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_},n.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},n.destroy=function(){},d}(),Yl=Xl;function Fs(d,n){for(var o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function $l(d,n,o){return n&&Fs(d.prototype,n),o&&Fs(d,o),d}function Zl(d){if(d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d}function Jl(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var Ql=window,eu=Ql.performance,tu=function(d){Jl(n,d);function n(a){var e;return e=d.call(this,a,c.default.FRAG_LOADING,c.default.FRAG_LOADED,c.default.FRAG_BUFFERED,c.default.ERROR)||this,e.lastLoadedFragLevel=0,e._nextAutoLevel=-1,e.hls=a,e.timer=null,e._bwEstimator=null,e.onCheck=e._abandonRulesCheck.bind(Zl(e)),e}var o=n.prototype;return o.destroy=function(){this.clearTimer(),E.prototype.destroy.call(this)},o.onFragLoading=function(e){var t=e.frag;if(t.type==="main"&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var s=this.hls,u=s.config,h=t.level,m=s.levels[h].details.live,I,T;m?(I=u.abrEwmaFastLive,T=u.abrEwmaSlowLive):(I=u.abrEwmaFastVoD,T=u.abrEwmaSlowVoD),this._bwEstimator=new Yl(s,T,I,u.abrEwmaDefaultEstimate)}},o._abandonRulesCheck=function(){var e=this.hls,t=e.media,s=this.fragCurrent;if(s){var u=s.loader;if(!u||u.stats&&u.stats.aborted){p.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}var h=u.stats;if(t&&h&&(!t.paused&&t.playbackRate!==0||!t.readyState)&&s.autoLevel&&s.level){var m=eu.now()-h.trequest,I=Math.abs(t.playbackRate);if(m>500*s.duration/I){var T=e.levels,b=Math.max(1,h.bw?h.bw/8:h.loaded*1e3/m),N=T[s.level];if(!N)return;var W=N.realBitrate?Math.max(N.realBitrate,N.bitrate):N.bitrate,ee=h.total?h.total:Math.max(h.loaded,Math.round(s.duration*W/8)),oe=t.currentTime,he=(ee-h.loaded)/b,fe=(v.bufferInfo(t,oe,e.config.maxBufferHole).end-oe)/I;if(fe<2*s.duration/I&&he>fe){var ye=e.minAutoLevel,Ae,Ke;for(Ke=s.level-1;Ke>ye;Ke--){var ut=T[Ke].realBitrate?Math.max(T[Ke].realBitrate,T[Ke].bitrate):T[Ke].bitrate,Kt=s.duration*ut/(8*.8*b);if(Kt<fe)break}Ae<he&&(p.logger.warn("loading too slow, abort fragment loading and switch to level "+Ke+":fragLoadedDelay["+Ke+"]<fragLoadedDelay["+(s.level-1)+"];bufferStarvationDelay:"+Ae.toFixed(1)+"<"+he.toFixed(1)+":"+fe.toFixed(1)),e.nextLoadLevel=Ke,this._bwEstimator.sample(m,h.loaded),u.abort(),this.clearTimer(),e.trigger(c.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,stats:h}))}}}}},o.onFragLoaded=function(e){var t=e.frag;if(t.type==="main"&&Object(R.isFiniteNumber)(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var s=this.hls.levels[t.level],u=(s.loaded?s.loaded.bytes:0)+e.stats.loaded,h=(s.loaded?s.loaded.duration:0)+e.frag.duration;s.loaded={bytes:u,duration:h},s.realBitrate=Math.round(8*u/h)}if(e.frag.bitrateTest){var m=e.stats;m.tparsed=m.tbuffered=m.tload,this.onFragBuffered(e)}}},o.onFragBuffered=function(e){var t=e.stats,s=e.frag;if(t.aborted!==!0&&s.type==="main"&&Object(R.isFiniteNumber)(s.sn)&&(!s.bitrateTest||t.tload===t.tbuffered)){var u=t.tparsed-t.trequest;p.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(u,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=u/1e3:this.bitrateTestDelay=0}},o.onError=function(e){switch(e.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},o.clearTimer=function(){clearInterval(this.timer),this.timer=null},o._findBestLevel=function(e,t,s,u,h,m,I,T,b){for(var N=h;N>=u;N--){var W=b[N];if(W){var ee=W.details,oe=ee?ee.totalduration/ee.fragments.length:t,he=ee?ee.live:!1,fe=void 0;N<=e?fe=I*s:fe=T*s;var ye=b[N].realBitrate?Math.max(b[N].realBitrate,b[N].bitrate):b[N].bitrate,Ae=ye*oe/fe;if(p.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+N+"/"+Math.round(fe)+"/"+ye+"/"+oe+"/"+m+"/"+Ae),fe>ye&&(!Ae||he&&!this.bitrateTestDelay||Ae<m))return N}}return-1},$l(n,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(e!==-1&&(!t||!t.canEstimate()))return e;var s=this._nextABRAutoLevel;return e!==-1&&(s=Math.min(e,s)),s},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,s=e.levels,u=e.config,h=e.minAutoLevel,m=e.media,I=this.lastLoadedFragLevel,T=this.fragCurrent?this.fragCurrent.duration:0,b=m?m.currentTime:0,N=m&&m.playbackRate!==0?Math.abs(m.playbackRate):1,W=this._bwEstimator?this._bwEstimator.getEstimate():u.abrEwmaDefaultEstimate,ee=(v.bufferInfo(m,b,u.maxBufferHole).end-b)/N,oe=this._findBestLevel(I,T,W,h,t,ee,u.abrBandWidthFactor,u.abrBandWidthUpFactor,s);if(oe>=0)return oe;p.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var he=T?Math.min(T,u.maxStarvationDelay):u.maxStarvationDelay,fe=u.abrBandWidthFactor,ye=u.abrBandWidthUpFactor;if(ee===0){var Ae=this.bitrateTestDelay;if(Ae){var Ke=T?Math.min(T,u.maxLoadingDelay):u.maxLoadingDelay;he=Ke-Ae,p.logger.trace("bitrate test took "+Math.round(1e3*Ae)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*he)+" ms"),fe=ye=1}}return oe=this._findBestLevel(I,T,W,h,t,ee+he,fe,ye,s),Math.max(oe,0)}}]),n}(E),au=tu;function ru(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var Os=y(),ou=function(d){ru(n,d);function n(a){var e;return e=d.call(this,a,c.default.MEDIA_ATTACHING,c.default.MEDIA_DETACHING,c.default.MANIFEST_PARSED,c.default.BUFFER_RESET,c.default.BUFFER_APPENDING,c.default.BUFFER_CODECS,c.default.BUFFER_EOS,c.default.BUFFER_FLUSHING,c.default.LEVEL_PTS_UPDATED,c.default.LEVEL_UPDATED)||this,e._msDuration=null,e._levelDuration=null,e._levelTargetDuration=10,e._live=null,e._objectUrl=null,e._needsFlush=!1,e._needsEos=!1,e.config=void 0,e.audioTimestampOffset=void 0,e.bufferCodecEventsExpected=0,e._bufferCodecEventsTotal=0,e.media=null,e.mediaSource=null,e.segments=[],e.parent=void 0,e.appending=!1,e.appended=0,e.appendError=0,e.flushBufferCounter=0,e.tracks={},e.pendingTracks={},e.sourceBuffer={},e.flushRange=[],e._onMediaSourceOpen=function(){p.logger.log("media source opened"),e.hls.trigger(c.default.MEDIA_ATTACHED,{media:e.media});var t=e.mediaSource;t&&t.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},e._onMediaSourceClose=function(){p.logger.log("media source closed")},e._onMediaSourceEnded=function(){p.logger.log("media source ended")},e._onSBUpdateEnd=function(){if(e.audioTimestampOffset&&e.sourceBuffer.audio){var t=e.sourceBuffer.audio;p.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+e.audioTimestampOffset),t.timestampOffset=e.audioTimestampOffset,delete e.audioTimestampOffset}e._needsFlush&&e.doFlush(),e._needsEos&&e.checkEos(),e.appending=!1;var s=e.parent,u=e.segments.reduce(function(b,N){return N.parent===s?b+1:b},0),h={},m=e.sourceBuffer;for(var I in m){var T=m[I];if(!T)throw Error("handling source buffer update end error: source buffer for "+I+" uninitilized and unable to update buffered TimeRanges.");h[I]=T.buffered}e.hls.trigger(c.default.BUFFER_APPENDED,{parent:s,pending:u,timeRanges:h}),e._needsFlush||e.doAppending(),e.updateMediaElementDuration(),u===0&&e.flushLiveBackBuffer()},e._onSBUpdateError=function(t){p.logger.error("sourceBuffer error:",t),e.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},e.config=a.config,e}var o=n.prototype;return o.destroy=function(){E.prototype.destroy.call(this)},o.onLevelPtsUpdated=function(e){var t=e.type,s=this.tracks.audio;if(t==="audio"&&s&&s.container==="audio/mpeg"){var u=this.sourceBuffer.audio;if(!u)throw Error("Level PTS Updated and source buffer for audio uninitalized");var h=Math.abs(u.timestampOffset-e.start);if(h>.1){var m=u.updating;try{u.abort()}catch(I){p.logger.warn("can not abort audio buffer: "+I)}m?this.audioTimestampOffset=e.start:(p.logger.warn("change mpeg audio timestamp offset from "+u.timestampOffset+" to "+e.start),u.timestampOffset=e.start)}}},o.onManifestParsed=function(e){var t=2;(e.audio&&!e.video||!e.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,p.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},o.onMediaAttaching=function(e){var t=this.media=e.media;if(t&&Os){var s=this.mediaSource=new Os;s.addEventListener("sourceopen",this._onMediaSourceOpen),s.addEventListener("sourceended",this._onMediaSourceEnded),s.addEventListener("sourceclose",this._onMediaSourceClose),t.src=window.URL.createObjectURL(s),this._objectUrl=t.src}},o.onMediaDetaching=function(){p.logger.log("media source detaching");var e=this.mediaSource;if(e){if(e.readyState==="open")try{e.endOfStream()}catch(t){p.logger.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):p.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(c.default.MEDIA_DETACHED)},o.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,s=Object.keys(t).length;(s&&!e||s===2)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},o.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var s=e[t];try{s&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(s),s.removeEventListener("updateend",this._onSBUpdateEnd),s.removeEventListener("error",this._onSBUpdateError))}catch{}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},o.onBufferCodecs=function(e){var t=this;Object.keys(this.sourceBuffer).length||(Object.keys(e).forEach(function(s){t.pendingTracks[s]=e[s]}),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},o.createSourceBuffers=function(e){var t=this.sourceBuffer,s=this.mediaSource;if(!s)throw Error("createSourceBuffers called when mediaSource was null");for(var u in e)if(!t[u]){var h=e[u];if(!h)throw Error("source buffer exists for track "+u+", however track does not");var m=h.levelCodec||h.codec,I=h.container+";codecs="+m;p.logger.log("creating sourceBuffer("+I+")");try{var T=t[u]=s.addSourceBuffer(I);T.addEventListener("updateend",this._onSBUpdateEnd),T.addEventListener("error",this._onSBUpdateError),this.tracks[u]={buffer:T,codec:m,id:h.id,container:h.container,levelCodec:h.levelCodec}}catch(b){p.logger.error("error while trying to add sourceBuffer:"+b.message),this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:b,mimeType:I})}}this.hls.trigger(c.default.BUFFER_CREATED,{tracks:this.tracks})},o.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},o.onBufferEos=function(e){for(var t in this.sourceBuffer)if(!e.type||e.type===t){var s=this.sourceBuffer[t];s&&!s.ended&&(s.ended=!0,p.logger.log(t+" sourceBuffer now EOS"))}this.checkEos()},o.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||t.readyState!=="open"){this._needsEos=!1;return}for(var s in e){var u=e[s];if(u){if(!u.ended)return;if(u.updating){this._needsEos=!0;return}}}p.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch{p.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},o.onBufferFlushing=function(e){e.type?this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}):(this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"video"}),this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},o.flushLiveBackBuffer=function(){if(this._live){var e=this.config.liveBackBufferLength;if(!(!isFinite(e)||e<0)){if(!this.media){p.logger.error("flushLiveBackBuffer called without attaching media");return}for(var t=this.media.currentTime,s=this.sourceBuffer,u=Object.keys(s),h=t-Math.max(e,this._levelTargetDuration),m=u.length-1;m>=0;m--){var I=u[m],T=s[I];if(T){var b=T.buffered;b.length>0&&h>b.start(0)&&this.removeBufferRange(I,T,0,h)&&this.hls.trigger(c.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:h})}}}}},o.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},o.updateMediaElementDuration=function(){var e=this.config,t;if(!(this._levelDuration===null||!this.media||!this.mediaSource||!this.sourceBuffer||this.media.readyState===0||this.mediaSource.readyState!=="open")){for(var s in this.sourceBuffer){var u=this.sourceBuffer[s];if(u&&u.updating===!0)return}t=this.media.duration,this._msDuration===null&&(this._msDuration=this.mediaSource.duration),this._live===!0&&e.liveDurationInfinity===!0?(p.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||!Object(R.isFiniteNumber)(t))&&(p.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},o.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(this.flushBuffer(e.start,e.end,e.type))this.flushRange.shift(),this.flushBufferCounter=0;else{this._needsFlush=!0;return}}if(this.flushRange.length===0){this._needsFlush=!1;var t=0,s=this.sourceBuffer;try{for(var u in s){var h=s[u];h&&(t+=h.buffered.length)}}catch{p.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(c.default.BUFFER_FLUSHED)}},o.doAppending=function(){var e=this.config,t=this.hls,s=this.segments,u=this.sourceBuffer;if(Object.keys(u).length){if(!this.media||this.media.error){this.segments=[],p.logger.error("trying to append although a media error occured, flush segment and abort");return}if(!this.appending){var h=s.shift();if(h)try{var m=u[h.type];if(!m){this._onSBUpdateEnd();return}if(m.updating){s.unshift(h);return}m.ended=!1,this.parent=h.parent,m.appendBuffer(h.data),this.appendError=0,this.appended++,this.appending=!0}catch(T){p.logger.error("error while trying to append buffer:"+T.message),s.unshift(h);var I={type:x.ErrorTypes.MEDIA_ERROR,parent:h.parent,details:"",fatal:!1};T.code===22?(this.segments=[],I.details=x.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,I.details=x.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.appendErrorMaxRetry&&(p.logger.log("fail "+e.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],I.fatal=!0)),t.trigger(c.default.ERROR,I)}}}},o.flushBuffer=function(e,t,s){var u=this.sourceBuffer;if(!Object.keys(u).length)return!0;var h="null";if(this.media&&(h=this.media.currentTime.toFixed(3)),p.logger.log("flushBuffer,pos/start/end: "+h+"/"+e+"/"+t),this.flushBufferCounter>=this.appended)return p.logger.warn("abort flushing too many retries"),!0;var m=u[s];if(m){if(m.ended=!1,m.updating)return p.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(s,m,e,t))return this.flushBufferCounter++,!1}return p.logger.log("buffer flushed"),!0},o.removeBufferRange=function(e,t,s,u){try{for(var h=0;h<t.buffered.length;h++){var m=t.buffered.start(h),I=t.buffered.end(h),T=Math.max(m,s),b=Math.min(I,u);if(Math.min(b,I)-T>.5){var N="null";return this.media&&(N=this.media.currentTime.toString()),p.logger.log("sb remove "+e+" ["+T+","+b+"], of ["+m+","+I+"], pos:"+N),t.remove(T,b),!0}}}catch(W){p.logger.warn("removeBufferRange failed",W)}return!1},n}(E),su=ou;function Ms(d,n){for(var o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function iu(d,n,o){return n&&Ms(d.prototype,n),o&&Ms(d,o),d}function nu(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var lu=function(d){nu(n,d);function n(a){var e;return e=d.call(this,a,c.default.FPS_DROP_LEVEL_CAPPING,c.default.MEDIA_ATTACHING,c.default.MANIFEST_PARSED,c.default.LEVELS_UPDATED,c.default.BUFFER_CODECS,c.default.MEDIA_DETACHING)||this,e.autoLevelCapping=Number.POSITIVE_INFINITY,e.firstLevel=null,e.levels=[],e.media=null,e.restrictedLevels=[],e.timer=null,e.clientRect=null,e}var o=n.prototype;return o.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},o.onFpsDropLevelCapping=function(e){n.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},o.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},o.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onBufferCodecs=function(e){var t=this.hls;t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onLevelsUpdated=function(e){this.levels=e.levels},o.onMediaDetaching=function(){this.stopCapping()},o.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},o.getMaxLevel=function(e){var t=this;if(!this.levels)return-1;var s=this.levels.filter(function(u,h){return n.isLevelAllowed(h,t.restrictedLevels)&&h<=e});return this.clientRect=null,n.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)},o.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},o.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},o.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t},n.isLevelAllowed=function(e,t){return t===void 0&&(t=[]),t.indexOf(e)===-1},n.getMaxLevelByMediaSize=function(e,t,s){if(!e||e&&!e.length)return-1;for(var u=function(b,N){return N?b.width!==N.width||b.height!==N.height:!0},h=e.length-1,m=0;m<e.length;m+=1){var I=e[m];if((I.width>=t||I.height>=s)&&u(I,e[m+1])){h=m;break}}return h},iu(n,[{key:"mediaWidth",get:function(){return this.getDimensions().width*n.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*n.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch{}return e}}]),n}(E),uu=lu;function du(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var fu=window,cu=fu.performance,pu=function(d){du(n,d);function n(a){return d.call(this,a,c.default.MEDIA_ATTACHING)||this}var o=n.prototype;return o.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},o.onMediaAttaching=function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var s=this.video=e.media instanceof window.HTMLVideoElement?e.media:null;typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}},o.checkFPS=function(e,t,s){var u=cu.now();if(t){if(this.lastTime){var h=u-this.lastTime,m=s-this.lastDroppedFrames,I=t-this.lastDecodedFrames,T=1e3*m/h,b=this.hls;if(b.trigger(c.default.FPS_DROP,{currentDropped:m,currentDecoded:I,totalDroppedFrames:s}),T>0&&m>b.config.fpsDroppedMonitoringThreshold*I){var N=b.currentLevel;p.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+N),N>0&&(b.autoLevelCapping===-1||b.autoLevelCapping>=N)&&(N=N-1,b.trigger(c.default.FPS_DROP_LEVEL_CAPPING,{level:N,droppedLevel:b.currentLevel}),b.autoLevelCapping=N,b.streamController.nextLevelSwitch())}}this.lastTime=u,this.lastDroppedFrames=s,this.lastDecodedFrames=t}},o.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},n}(E),hu=pu,mu=function(){function d(o){o&&o.xhrSetup&&(this.xhrSetup=o.xhrSetup)}var n=d.prototype;return n.destroy=function(){this.abort(),this.loader=null},n.abort=function(){var a=this.loader;a&&a.readyState!==4&&(this.stats.aborted=!0,a.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},n.load=function(a,e,t){this.context=a,this.config=e,this.callbacks=t,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},n.loadInternal=function(){var a,e=this.context;a=this.loader=new window.XMLHttpRequest;var t=this.stats;t.tfirst=0,t.loaded=0;var s=this.xhrSetup;try{if(s)try{s(a,e.url)}catch{a.open("GET",e.url,!0),s(a,e.url)}a.readyState||a.open("GET",e.url,!0)}catch(u){this.callbacks.onError({code:a.status,text:u.message},e,a);return}e.rangeEnd&&a.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()},n.readystatechange=function(a){var e=a.currentTarget,t=e.readyState,s=this.stats,u=this.context,h=this.config;if(!s.aborted&&t>=2)if(window.clearTimeout(this.requestTimeout),s.tfirst===0&&(s.tfirst=Math.max(window.performance.now(),s.trequest)),t===4){var m=e.status;if(m>=200&&m<300){s.tload=Math.max(s.tfirst,window.performance.now());var I,T;u.responseType==="arraybuffer"?(I=e.response,T=I.byteLength):(I=e.responseText,T=I.length),s.loaded=s.total=T;var b={url:e.responseURL,data:I};this.callbacks.onSuccess(b,s,u,e)}else s.retry>=h.maxRetry||m>=400&&m<499?(p.logger.error(m+" while loading "+u.url),this.callbacks.onError({code:m,text:e.statusText},u,e)):(p.logger.warn(m+" while loading "+u.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,h.maxRetryDelay),s.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),h.timeout)},n.loadtimeout=function(){p.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},n.loadprogress=function(a){var e=a.currentTarget,t=this.stats;t.loaded=a.loaded,a.lengthComputable&&(t.total=a.total);var s=this.callbacks.onProgress;s&&s(t,this.context,null,e)},d}(),gu=mu;function Bs(d,n){for(var o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function xu(d,n,o){return n&&Bs(d.prototype,n),o&&Bs(d,o),d}function vu(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var Lu=function(d){vu(n,d);function n(a){var e;return e=d.call(this,a,c.default.MANIFEST_LOADING,c.default.MANIFEST_PARSED,c.default.AUDIO_TRACK_LOADED,c.default.AUDIO_TRACK_SWITCHED,c.default.LEVEL_LOADED,c.default.ERROR)||this,e._trackId=-1,e._selectDefaultTrack=!0,e.tracks=[],e.trackIdBlacklist=Object.create(null),e.audioGroupId=null,e}var o=n.prototype;return o.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},o.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(c.default.AUDIO_TRACKS_UPDATED,{audioTracks:t}),this._selectAudioGroup(this.hls.nextLoadLevel)},o.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length){p.logger.warn("Invalid audio track id:",e.id);return}if(p.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=e.details.targetduration*1e3;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()},o.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},o.onLevelLoaded=function(e){this._selectAudioGroup(e.level)},o.onError=function(e){e.type===x.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===x.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(p.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},o._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details){p.logger.debug("Same id as current audio-track passed, and track details available -> no-op");return}if(e<0||e>=this.tracks.length){p.logger.warn("Invalid id passed to audio-track controller");return}var t=this.tracks[e];p.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var s=t.url,u=t.type,h=t.id;this.hls.trigger(c.default.AUDIO_TRACK_SWITCHING,{id:h,type:u,url:s}),this._loadTrackDetailsIfNeeded(t)},o.doTick=function(){this._updateTrack(this._trackId)},o._selectAudioGroup=function(e){var t=this.hls.levels[e];if(!(!t||!t.audioGroupIds)){var s=t.audioGroupIds[t.urlId];this.audioGroupId!==s&&(this.audioGroupId=s,this._selectInitialAudioTrack())}},o._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(t.length){var s=this.tracks[this._trackId],u=null;if(s&&(u=s.name),this._selectDefaultTrack){var h=t.filter(function(T){return T.default});h.length?t=h:p.logger.warn("No default audio tracks defined")}var m=!1,I=function(){t.forEach(function(b){m||(!e.audioGroupId||b.groupId===e.audioGroupId)&&(!u||u===b.name)&&(e._setAudioTrack(b.id),m=!0)})};I(),m||(u=null,I()),m||(p.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},o._needsTrackLoading=function(e){var t=e.details,s=e.url;return!t||t.live?!!s:!1},o._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,s=e.id;p.logger.log("loading audio-track playlist for id: "+s),this.hls.trigger(c.default.AUDIO_TRACK_LOADING,{url:t,id:s})}},o._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,p.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},o._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],s=t.name,u=t.language,h=t.groupId;p.logger.warn("Loading failed on audio track id: "+e+", group-id: "+h+', name/language: "'+s+'" / "'+u+'"');for(var m=e,I=0;I<this.tracks.length;I++)if(!this.trackIdBlacklist[I]){var T=this.tracks[I];if(T.name===s){m=I;break}}if(m===e){p.logger.warn('No fallback audio-track found for name/language: "'+s+'" / "'+u+'"');return}p.logger.log("Attempting audio-track fallback id:",m,"group-id:",this.tracks[m].groupId),this._setAudioTrack(m)},xu(n,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}]),n}($t),yu=Lu;function Ns(d,n){for(var o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function Iu(d,n,o){return n&&Ns(d.prototype,n),o&&Ns(d,o),d}function Su(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var Cu=window,Ka=Cu.performance,Us=100,Eu=function(d){Su(n,d);function n(a,e){var t;return t=d.call(this,a,c.default.MEDIA_ATTACHED,c.default.MEDIA_DETACHING,c.default.AUDIO_TRACKS_UPDATED,c.default.AUDIO_TRACK_SWITCHING,c.default.AUDIO_TRACK_LOADED,c.default.KEY_LOADED,c.default.FRAG_LOADED,c.default.FRAG_PARSING_INIT_SEGMENT,c.default.FRAG_PARSING_DATA,c.default.FRAG_PARSED,c.default.ERROR,c.default.BUFFER_RESET,c.default.BUFFER_CREATED,c.default.BUFFER_APPENDED,c.default.BUFFER_FLUSHED,c.default.INIT_PTS_FOUND)||this,t.fragmentTracker=e,t.config=a.config,t.audioCodecSwap=!1,t._state=X.STOPPED,t.initPTS=[],t.waitingFragment=null,t.videoTrackCC=null,t.waitingVideoCC=null,t}var o=n.prototype;return o.onInitPtsFound=function(e){var t=e.id,s=e.frag.cc,u=e.initPTS;t==="main"&&(this.initPTS[s]=u,this.videoTrackCC=s,p.logger.log("InitPTS for cc: "+s+" found from main: "+u),this.state===X.WAITING_INIT_PTS&&this.tick())},o.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(Us),this.fragLoadError=0,t>0&&e===-1?(p.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=X.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=X.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=X.STOPPED},o.doTick=function(){var e,t,s,u=this.hls,h=u.config;switch(this.state){case X.ERROR:case X.PAUSED:case X.BUFFER_FLUSHING:break;case X.STARTING:this.state=X.WAITING_TRACK,this.loadedmetadata=!1;break;case X.IDLE:var m=this.tracks;if(!m||!this.media&&(this.startFragRequested||!h.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(e=this.nextLoadPosition,e===void 0)break;var I=this.mediaBuffer?this.mediaBuffer:this.media,T=this.videoBuffer?this.videoBuffer:this.media,b=e<h.maxBufferHole?Math.max(Bt,h.maxBufferHole):h.maxBufferHole,N=v.bufferInfo(I,e,b),W=v.bufferInfo(T,e,b),ee=N.len,oe=N.end,he=this.fragPrevious,fe=Math.min(h.maxBufferLength,h.maxMaxBufferLength),ye=Math.max(fe,W.len),Ae=this.audioSwitch,Ke=this.trackId;if((ee<ye||Ae)&&Ke<m.length){if(s=m[Ke].details,typeof s>"u"){this.state=X.WAITING_TRACK;break}if(!Ae&&this._streamEnded(N,s)){this.hls.trigger(c.default.BUFFER_EOS,{type:"audio"}),this.state=X.ENDED;return}var ut=s.fragments,Kt=ut.length,_t=ut[0].start,da=ut[Kt-1].start+ut[Kt-1].duration,xe;if(Ae){if(s.live&&!s.PTSKnown)p.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),oe=0;else if(oe=e,s.PTSKnown&&e<_t)if(N.end>_t||N.nextStart)p.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=_t+.05;else return}if(s.initSegment&&!s.initSegment.data)xe=s.initSegment;else if(oe<=_t){if(xe=ut[0],this.videoTrackCC!==null&&xe.cc!==this.videoTrackCC&&(xe=Ye(ut,this.videoTrackCC)),s.live&&xe.loadIdx&&xe.loadIdx===this.fragLoadIdx){var Ue=N.nextStart?N.nextStart:_t;p.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(Ue+.05)),this.media.currentTime=Ue+.05;return}}else{var vt,Da=h.maxFragLookUpTolerance,ka=he?ut[he.sn-ut[0].sn+1]:void 0;oe<da?(oe>da-Da&&(Da=0),ka&&!wt(oe,Da,ka)?vt=ka:vt=H.search(ut,function(vd){return wt(oe,Da,vd)})):vt=ut[Kt-1],vt&&(xe=vt,_t=vt.start,he&&xe.level===he.level&&xe.sn===he.sn&&(xe.sn<s.endSN?(xe=ut[xe.sn+1-s.startSN],this.fragmentTracker.getState(xe)!==Re.OK&&p.logger.log("SN just loaded, load next one: "+xe.sn)):xe=null))}xe&&(xe.encrypted?(p.logger.log("Loading key for "+xe.sn+" of ["+s.startSN+" ,"+s.endSN+"],track "+Ke),this.state=X.KEY_LOADING,u.trigger(c.default.KEY_LOADING,{frag:xe})):(this.fragCurrent=xe,(Ae||this.fragmentTracker.getState(xe)===Re.NOT_LOADED)&&(p.logger.log("Loading "+xe.sn+", cc: "+xe.cc+" of ["+s.startSN+" ,"+s.endSN+"],track "+Ke+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+e+", bufferEnd: "+oe.toFixed(3)),xe.sn!=="initSegment"&&(this.startFragRequested=!0),Object(R.isFiniteNumber)(xe.sn)&&(this.nextLoadPosition=xe.start+xe.duration),u.trigger(c.default.FRAG_LOADING,{frag:xe}),this.state=X.FRAG_LOADING)))}break;case X.WAITING_TRACK:t=this.tracks[this.trackId],t&&t.details&&(this.state=X.IDLE);break;case X.FRAG_LOADING_WAITING_RETRY:var Wa=Ka.now(),Xr=this.retryDate;I=this.media;var gd=I&&I.seeking;(!Xr||Wa>=Xr||gd)&&(p.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=X.IDLE);break;case X.WAITING_INIT_PTS:var ja=this.waitingFragment;if(ja){var Oo=ja.frag.cc;if(this.initPTS[Oo]!==void 0)this.waitingFragment=null,this.state=X.FRAG_LOADING,this.onFragLoaded(ja);else if(this.videoTrackCC!==this.waitingVideoCC)p.logger.log("Waiting fragment cc ("+Oo+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var di=v.bufferInfo(this.mediaBuffer,this.media.currentTime,h.maxBufferHole),xd=wt(di.end,h.maxFragLookUpTolerance,ja.frag);xd<0&&(p.logger.log("Waiting fragment cc ("+Oo+") @ "+ja.frag.start+" cancelled because another fragment at "+di.end+" is needed"),this.clearWaitingFragment())}}else this.state=X.IDLE;break;case X.STOPPED:case X.FRAG_LOADING:case X.PARSING:case X.PARSED:case X.ENDED:break;default:break}},o.clearWaitingFragment=function(){var e=this.waitingFragment;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=X.IDLE)},o.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var s=this.config;this.tracks&&s.autoStartLoad&&this.startLoad(s.startPosition)},o.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(p.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},o.onAudioTracksUpdated=function(e){p.logger.log("audio tracks updated"),this.tracks=e.audioTracks},o.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=X.PAUSED,t?this.setInterval(Us):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=X.IDLE),this.tick()},o.onAudioTrackLoaded=function(e){var t=e.details,s=e.id,u=this.tracks[s],h=u.details,m=t.totalduration,I=0;if(p.logger.log("track "+s+" loaded ["+t.startSN+","+t.endSN+"],duration:"+m),t.live||h&&h.live?h&&t.fragments.length>0?(se(h,t),I=t.fragments[0].start,t.PTSKnown?p.logger.log("live audio playlist sliding:"+I.toFixed(3)):p.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,p.logger.log("live audio playlist - first load, unknown sliding")):t.PTSKnown=!1,u.details=t,!this.startFragRequested){if(this.startPosition===-1){var T=t.startTimeOffset;Object(R.isFiniteNumber)(T)?(p.logger.log("start time offset found in playlist, adjust startPosition to "+T),this.startPosition=T):t.live?(this.startPosition=this.computeLivePosition(I,t),p.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===X.WAITING_TRACK&&(this.state=X.IDLE),this.tick()},o.onKeyLoaded=function(){this.state===X.KEY_LOADING&&(this.state=X.IDLE,this.tick())},o.onFragLoaded=function(e){var t=this.fragCurrent,s=e.frag;if(this.state===X.FRAG_LOADING&&t&&s.type==="audio"&&s.level===t.level&&s.sn===t.sn){var u=this.tracks[this.trackId],h=u.details,m=h.totalduration,I=t.level,T=t.sn,b=t.cc,N=this.config.defaultAudioCodec||u.audioCodec||"mp4a.40.2",W=this.stats=e.stats;if(T==="initSegment")this.state=X.IDLE,W.tparsed=W.tbuffered=Ka.now(),h.initSegment.data=e.payload,this.hls.trigger(c.default.FRAG_BUFFERED,{stats:W,frag:t,id:"audio"}),this.tick();else{this.state=X.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new Z(this.hls,"audio"));var ee=this.initPTS[b],oe=h.initSegment?h.initSegment.data:[];if(ee!==void 0){this.pendingBuffering=!0,p.logger.log("Demuxing "+T+" of ["+h.startSN+" ,"+h.endSN+"],track "+I);var he=!1;this.demuxer.push(e.payload,oe,N,null,t,m,he,ee)}else p.logger.log("Unknown video PTS for cc "+b+", waiting for video PTS before demuxing audio frag "+T+" of ["+h.startSN+" ,"+h.endSN+"],track "+I),this.waitingFragment=e,this.waitingVideoCC=this.videoTrackCC,this.state=X.WAITING_INIT_PTS}}this.fragLoadError=0},o.onFragParsingInitSegment=function(e){var t=this.fragCurrent,s=e.frag;if(t&&e.id==="audio"&&s.sn===t.sn&&s.level===t.level&&this.state===X.PARSING){var u=e.tracks,h;if(u.video&&delete u.video,h=u.audio,h){h.levelCodec=h.codec,h.id=e.id,this.hls.trigger(c.default.BUFFER_CODECS,u),p.logger.log("audio track:audio,container:"+h.container+",codecs[level/parsed]=["+h.levelCodec+"/"+h.codec+"]");var m=h.initSegment;if(m){var I={type:"audio",data:m,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[I]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(c.default.BUFFER_APPENDING,I))}this.tick()}}},o.onFragParsingData=function(e){var t=this,s=this.fragCurrent,u=e.frag;if(s&&e.id==="audio"&&e.type==="audio"&&u.sn===s.sn&&u.level===s.level&&this.state===X.PARSING){var h=this.trackId,m=this.tracks[h],I=this.hls;Object(R.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+s.duration,e.endDTS=e.startDTS+s.duration),s.addElementaryStream(z.AUDIO),p.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),re(m.details,s,e.startPTS,e.endPTS);var T=this.media,b=!1;if(this.audioSwitch)if(T&&T.readyState){var N=T.currentTime;p.logger.log("switching audio track : currentTime:"+N),N>=e.startPTS&&(p.logger.log("switching audio track : flushing all audio"),this.state=X.BUFFER_FLUSHING,I.trigger(c.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),b=!0,this.audioSwitch=!1,I.trigger(c.default.AUDIO_TRACK_SWITCHED,{id:h}))}else this.audioSwitch=!1,I.trigger(c.default.AUDIO_TRACK_SWITCHED,{id:h});var W=this.pendingData;if(!W){p.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),I.trigger(c.default.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});return}this.audioSwitch||([e.data1,e.data2].forEach(function(ee){ee&&ee.length&&W.push({type:e.type,data:ee,parent:"audio",content:"data"})}),!b&&W.length&&(W.forEach(function(ee){t.state===X.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(c.default.BUFFER_APPENDING,ee))}),this.pendingData=[],this.appended=!0)),this.tick()}},o.onFragParsed=function(e){var t=this.fragCurrent,s=e.frag;t&&e.id==="audio"&&s.sn===t.sn&&s.level===t.level&&this.state===X.PARSING&&(this.stats.tparsed=Ka.now(),this.state=X.PARSED,this._checkAppendedParsed())},o.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},o.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},o.onBufferAppended=function(e){if(e.parent==="audio"){var t=this.state;(t===X.PARSING||t===X.PARSED)&&(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},o._checkAppendedParsed=function(){if(this.state===X.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,s=this.hls;if(e){this.fragPrevious=e,t.tbuffered=Ka.now(),s.trigger(c.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var u=this.mediaBuffer?this.mediaBuffer:this.media;u&&p.logger.log("audio buffered : "+Pe.toString(u.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,s.trigger(c.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=X.IDLE}this.tick()}},o.onError=function(e){var t=e.frag;if(!(t&&t.type!=="audio"))switch(e.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:var s=e.frag;if(s&&s.type!=="audio")break;if(!e.fatal){var u=this.fragLoadError;u?u++:u=1;var h=this.config;if(u<=h.fragLoadingMaxRetry){this.fragLoadError=u;var m=Math.min(Math.pow(2,u-1)*h.fragLoadingRetryDelay,h.fragLoadingMaxRetryTimeout);p.logger.warn("AudioStreamController: frag loading failed, retry in "+m+" ms"),this.retryDate=Ka.now()+m,this.state=X.FRAG_LOADING_WAITING_RETRY}else p.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=X.ERROR}break;case x.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case x.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case x.ErrorDetails.KEY_LOAD_ERROR:case x.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==X.ERROR&&(this.state=e.fatal?X.ERROR:X.IDLE,p.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case x.ErrorDetails.BUFFER_FULL_ERROR:if(e.parent==="audio"&&(this.state===X.PARSING||this.state===X.PARSED)){var I=this.mediaBuffer,T=this.media.currentTime,b=I&&v.isBuffered(I,T)&&v.isBuffered(I,T+.5);if(b){var N=this.config;N.maxMaxBufferLength>=N.maxBufferLength&&(N.maxMaxBufferLength/=2,p.logger.warn("AudioStreamController: reduce max buffer length to "+N.maxMaxBufferLength+"s")),this.state=X.IDLE}else p.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=X.BUFFER_FLUSHING,this.hls.trigger(c.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}break;default:break}},o.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(p.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach(function(s){e.hls.trigger(c.default.BUFFER_APPENDING,s)}),this.appended=!0,this.pendingData=[],this.state=X.PARSED):(this.state=X.IDLE,this.fragPrevious=null,this.tick())},Iu(n,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,p.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),n}(la),Au=Eu,Gs=function(){if(typeof window<"u"&&window.VTTCue)return window.VTTCue;var d="auto",n={"":!0,lr:!0,rl:!0},o={start:!0,middle:!0,end:!0,left:!0,right:!0};function a(u){if(typeof u!="string")return!1;var h=n[u.toLowerCase()];return h?u.toLowerCase():!1}function e(u){if(typeof u!="string")return!1;var h=o[u.toLowerCase()];return h?u.toLowerCase():!1}function t(u){for(var h=1;h<arguments.length;h++){var m=arguments[h];for(var I in m)u[I]=m[I]}return u}function s(u,h,m){var I=this,T={};T.enumerable=!0,I.hasBeenReset=!1;var b="",N=!1,W=u,ee=h,oe=m,he=null,fe="",ye=!0,Ae="auto",Ke="start",ut=50,Kt="middle",_t=50,da="middle";Object.defineProperty(I,"id",t({},T,{get:function(){return b},set:function(Ue){b=""+Ue}})),Object.defineProperty(I,"pauseOnExit",t({},T,{get:function(){return N},set:function(Ue){N=!!Ue}})),Object.defineProperty(I,"startTime",t({},T,{get:function(){return W},set:function(Ue){if(typeof Ue!="number")throw new TypeError("Start time must be set to a number.");W=Ue,this.hasBeenReset=!0}})),Object.defineProperty(I,"endTime",t({},T,{get:function(){return ee},set:function(Ue){if(typeof Ue!="number")throw new TypeError("End time must be set to a number.");ee=Ue,this.hasBeenReset=!0}})),Object.defineProperty(I,"text",t({},T,{get:function(){return oe},set:function(Ue){oe=""+Ue,this.hasBeenReset=!0}})),Object.defineProperty(I,"region",t({},T,{get:function(){return he},set:function(Ue){he=Ue,this.hasBeenReset=!0}})),Object.defineProperty(I,"vertical",t({},T,{get:function(){return fe},set:function(Ue){var vt=a(Ue);if(vt===!1)throw new SyntaxError("An invalid or illegal string was specified.");fe=vt,this.hasBeenReset=!0}})),Object.defineProperty(I,"snapToLines",t({},T,{get:function(){return ye},set:function(Ue){ye=!!Ue,this.hasBeenReset=!0}})),Object.defineProperty(I,"line",t({},T,{get:function(){return Ae},set:function(Ue){if(typeof Ue!="number"&&Ue!==d)throw new SyntaxError("An invalid number or illegal string was specified.");Ae=Ue,this.hasBeenReset=!0}})),Object.defineProperty(I,"lineAlign",t({},T,{get:function(){return Ke},set:function(Ue){var vt=e(Ue);if(!vt)throw new SyntaxError("An invalid or illegal string was specified.");Ke=vt,this.hasBeenReset=!0}})),Object.defineProperty(I,"position",t({},T,{get:function(){return ut},set:function(Ue){if(Ue<0||Ue>100)throw new Error("Position must be between 0 and 100.");ut=Ue,this.hasBeenReset=!0}})),Object.defineProperty(I,"positionAlign",t({},T,{get:function(){return Kt},set:function(Ue){var vt=e(Ue);if(!vt)throw new SyntaxError("An invalid or illegal string was specified.");Kt=vt,this.hasBeenReset=!0}})),Object.defineProperty(I,"size",t({},T,{get:function(){return _t},set:function(Ue){if(Ue<0||Ue>100)throw new Error("Size must be between 0 and 100.");_t=Ue,this.hasBeenReset=!0}})),Object.defineProperty(I,"align",t({},T,{get:function(){return da},set:function(Ue){var vt=e(Ue);if(!vt)throw new SyntaxError("An invalid or illegal string was specified.");da=vt,this.hasBeenReset=!0}})),I.displayState=void 0}return s.prototype.getCueAsHTML=function(){var u=window.WebVTT;return u.convertCueToDOMTree(window,this.text)},s}(),Tu=function(){return{decode:function(o){if(!o)return"";if(typeof o!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(o))}}};function Vs(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Tu,this.regionList=[]}function bu(d){function n(a,e,t,s){return(a|0)*3600+(e|0)*60+(t|0)+(s|0)/1e3}var o=d.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return o?o[3]?n(o[1],o[2],o[3].replace(":",""),o[4]):o[1]>59?n(o[1],o[2],0,o[4]):n(0,o[1],o[2],o[4]):null}function qs(){this.values=Object.create(null)}qs.prototype={set:function(n,o){!this.get(n)&&o!==""&&(this.values[n]=o)},get:function(n,o,a){return a?this.has(n)?this.values[n]:o[a]:this.has(n)?this.values[n]:o},has:function(n){return n in this.values},alt:function(n,o,a){for(var e=0;e<a.length;++e)if(o===a[e]){this.set(n,o);break}},integer:function(n,o){/^-?\d+$/.test(o)&&this.set(n,parseInt(o,10))},percent:function(n,o){var a;return(a=o.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(o=parseFloat(o),o>=0&&o<=100)?(this.set(n,o),!0):!1}};function Hs(d,n,o,a){var e=a?d.split(a):[d];for(var t in e)if(typeof e[t]=="string"){var s=e[t].split(o);if(s.length===2){var u=s[0],h=s[1];n(u,h)}}}var _o=new Gs(0,0,0),Wr=_o.align==="middle"?"middle":"center";function wu(d,n,o){var a=d;function e(){var u=bu(d);if(u===null)throw new Error("Malformed timestamp: "+a);return d=d.replace(/^[^\sa-zA-Z-]+/,""),u}function t(u,h){var m=new qs;Hs(u,function(b,N){switch(b){case"region":for(var W=o.length-1;W>=0;W--)if(o[W].id===N){m.set(b,o[W].region);break}break;case"vertical":m.alt(b,N,["rl","lr"]);break;case"line":var ee=N.split(","),oe=ee[0];m.integer(b,oe),m.percent(b,oe)&&m.set("snapToLines",!1),m.alt(b,oe,["auto"]),ee.length===2&&m.alt("lineAlign",ee[1],["start",Wr,"end"]);break;case"position":ee=N.split(","),m.percent(b,ee[0]),ee.length===2&&m.alt("positionAlign",ee[1],["start",Wr,"end","line-left","line-right","auto"]);break;case"size":m.percent(b,N);break;case"align":m.alt(b,N,["start",Wr,"end","left","right"]);break}},/:/,/\s/),h.region=m.get("region",null),h.vertical=m.get("vertical","");var I=m.get("line","auto");I==="auto"&&_o.line===-1&&(I=-1),h.line=I,h.lineAlign=m.get("lineAlign","start"),h.snapToLines=m.get("snapToLines",!0),h.size=m.get("size",100),h.align=m.get("align",Wr);var T=m.get("position","auto");T==="auto"&&_o.position===50&&(T=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=T}function s(){d=d.replace(/^\s+/,"")}if(s(),n.startTime=e(),s(),d.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+a);d=d.substr(3),s(),n.endTime=e(),s(),t(d,n)}function Ks(d){return d.replace(/<br(?: \/)?>/gi,`
`)}Vs.prototype={parse:function(n){var o=this;n&&(o.buffer+=o.decoder.decode(n,{stream:!0}));function a(){var m=o.buffer,I=0;for(m=Ks(m);I<m.length&&m[I]!=="\r"&&m[I]!==`
`;)++I;var T=m.substr(0,I);return m[I]==="\r"&&++I,m[I]===`
`&&++I,o.buffer=m.substr(I),T}function e(m){Hs(m,function(I,T){switch(I){case"Region":break}},/:/)}try{var t;if(o.state==="INITIAL"){if(!/\r\n|\n/.test(o.buffer))return this;t=a();var s=t.match(/^()?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");o.state="HEADER"}for(var u=!1;o.buffer;){if(!/\r\n|\n/.test(o.buffer))return this;switch(u?u=!1:t=a(),o.state){case"HEADER":/:/.test(t)?e(t):t||(o.state="ID");continue;case"NOTE":t||(o.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){o.state="NOTE";break}if(!t)continue;if(o.cue=new Gs(0,0,""),o.state="CUE",t.indexOf("-->")===-1){o.cue.id=t;continue}case"CUE":try{wu(t,o.cue,o.regionList)}catch{o.cue=null,o.state="BADCUE";continue}o.state="CUETEXT";continue;case"CUETEXT":var h=t.indexOf("-->")!==-1;if(!t||h&&(u=!0)){o.oncue&&o.oncue(o.cue),o.cue=null,o.state="ID";continue}o.cue.text&&(o.cue.text+=`
`),o.cue.text+=t;continue;case"BADCUE":t||(o.state="ID");continue}}}catch{o.state==="CUETEXT"&&o.cue&&o.oncue&&o.oncue(o.cue),o.cue=null,o.state=o.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var n=this;try{if(n.buffer+=n.decoder.decode(),(n.cue||n.state==="HEADER")&&(n.buffer+=`

`,n.parse()),n.state==="INITIAL")throw new Error("Malformed WebVTT signature.")}catch(o){throw o}return n.onflush&&n.onflush(),this}};var _u=Vs;function Ru(d,n,o,a){for(var e=[],t,s,u,h,m,I=window.VTTCue||TextTrackCue,T=0;T<a.rows.length;T++)if(t=a.rows[T],u=!0,h=0,m="",!t.isEmpty()){for(var b=0;b<t.chars.length;b++)t.chars[b].uchar.match(/\s/)&&u?h++:(m+=t.chars[b].uchar,u=!1);t.cueStartTime=n,n===o&&(o+=1e-4),s=new I(n,o,Ks(m.trim())),h>=16?h--:h++,navigator.userAgent.match(/Firefox\//)?s.line=T+1:s.line=T>7?T-2:T+1,s.align="left",s.position=Math.max(0,Math.min(100,100*(h/32))),e.push(s),d&&d.addCue(s)}return e}var Ws={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},js=function(n){var o=n;return Ws.hasOwnProperty(n)&&(o=Ws[n]),String.fromCharCode(o)},Jt=15,ua=100,Du={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},ku={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Pu={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Fu={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Ou=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Ge;(function(d){d[d.ERROR=0]="ERROR",d[d.TEXT=1]="TEXT",d[d.WARNING=2]="WARNING",d[d.INFO=2]="INFO",d[d.DEBUG=3]="DEBUG",d[d.DATA=3]="DATA"})(Ge||(Ge={}));var Mu=function(){function d(){this.time=null,this.verboseLevel=Ge.ERROR}var n=d.prototype;return n.log=function(a,e){this.verboseLevel>=a&&p.logger.log(this.time+" ["+a+"] "+e)},d}(),Ia=function(n){for(var o=[],a=0;a<n.length;a++)o.push(n[a].toString(16));return o},zs=function(){function d(o,a,e,t,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=o||"white",this.underline=a||!1,this.italics=e||!1,this.background=t||"black",this.flash=s||!1}var n=d.prototype;return n.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},n.setStyles=function(a){for(var e=["foreground","underline","italics","background","flash"],t=0;t<e.length;t++){var s=e[t];a.hasOwnProperty(s)&&(this[s]=a[s])}},n.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},n.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},n.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},n.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},d}(),Bu=function(){function d(o,a,e,t,s,u){this.uchar=void 0,this.penState=void 0,this.uchar=o||" ",this.penState=new zs(a,e,t,s,u)}var n=d.prototype;return n.reset=function(){this.uchar=" ",this.penState.reset()},n.setChar=function(a,e){this.uchar=a,this.penState.copy(e)},n.setPenState=function(a){this.penState.copy(a)},n.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},n.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},n.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},d}(),Nu=function(){function d(o){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var a=0;a<ua;a++)this.chars.push(new Bu);this.logger=o,this.pos=0,this.currPenState=new zs}var n=d.prototype;return n.equals=function(a){for(var e=!0,t=0;t<ua;t++)if(!this.chars[t].equals(a.chars[t])){e=!1;break}return e},n.copy=function(a){for(var e=0;e<ua;e++)this.chars[e].copy(a.chars[e])},n.isEmpty=function(){for(var a=!0,e=0;e<ua;e++)if(!this.chars[e].isEmpty()){a=!1;break}return a},n.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(this.logger.log(Ge.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>ua&&(this.logger.log(Ge.DEBUG,"Too large cursor position "+this.pos),this.pos=ua)},n.moveCursor=function(a){var e=this.pos+a;if(a>1)for(var t=this.pos+1;t<e+1;t++)this.chars[t].setPenState(this.currPenState);this.setCursor(e)},n.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},n.insertChar=function(a){a>=144&&this.backSpace();var e=js(a);if(this.pos>=ua){this.logger.log(Ge.ERROR,"Cannot insert "+a.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)},n.clearFromPos=function(a){var e;for(e=a;e<ua;e++)this.chars[e].reset()},n.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},n.clearToEndOfRow=function(){this.clearFromPos(this.pos)},n.getTextString=function(){for(var a=[],e=!0,t=0;t<ua;t++){var s=this.chars[t].uchar;s!==" "&&(e=!1),a.push(s)}return e?"":a.join("")},n.setPenStyles=function(a){this.currPenState.setStyles(a);var e=this.chars[this.pos];e.setPenState(this.currPenState)},d}(),Ro=function(){function d(o){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var a=0;a<Jt;a++)this.rows.push(new Nu(o));this.logger=o,this.currRow=Jt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var n=d.prototype;return n.reset=function(){for(var a=0;a<Jt;a++)this.rows[a].clear();this.currRow=Jt-1},n.equals=function(a){for(var e=!0,t=0;t<Jt;t++)if(!this.rows[t].equals(a.rows[t])){e=!1;break}return e},n.copy=function(a){for(var e=0;e<Jt;e++)this.rows[e].copy(a.rows[e])},n.isEmpty=function(){for(var a=!0,e=0;e<Jt;e++)if(!this.rows[e].isEmpty()){a=!1;break}return a},n.backSpace=function(){var a=this.rows[this.currRow];a.backSpace()},n.clearToEndOfRow=function(){var a=this.rows[this.currRow];a.clearToEndOfRow()},n.insertChar=function(a){var e=this.rows[this.currRow];e.insertChar(a)},n.setPen=function(a){var e=this.rows[this.currRow];e.setPenStyles(a)},n.moveCursor=function(a){var e=this.rows[this.currRow];e.moveCursor(a)},n.setCursor=function(a){this.logger.log(Ge.INFO,"setCursor: "+a);var e=this.rows[this.currRow];e.setCursor(a)},n.setPAC=function(a){this.logger.log(Ge.INFO,"pacData = "+JSON.stringify(a));var e=a.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var t=0;t<Jt;t++)this.rows[t].clear();var s=this.currRow+1-this.nrRollUpRows,u=this.lastOutputScreen;if(u){var h=u.rows[s].cueStartTime,m=this.logger.time;if(h&&m!==null&&h<m)for(var I=0;I<this.nrRollUpRows;I++)this.rows[e-this.nrRollUpRows+I+1].copy(u.rows[s+I])}}this.currRow=e;var T=this.rows[this.currRow];if(a.indent!==null){var b=a.indent,N=Math.max(b-1,0);T.setCursor(a.indent),a.color=T.chars[N].penState.foreground}var W={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(W)},n.setBkgData=function(a){this.logger.log(Ge.INFO,"bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},n.setRollUpRows=function(a){this.nrRollUpRows=a},n.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(Ge.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(Ge.TEXT,this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(a,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(Ge.INFO,"Rolling up")},n.getDisplayText=function(a){a=a||!1;for(var e=[],t="",s=-1,u=0;u<Jt;u++){var h=this.rows[u].getTextString();h&&(s=u+1,a?e.push("Row "+s+": '"+h+"'"):e.push(h.trim()))}return e.length>0&&(a?t="["+e.join(" | ")+"]":t=e.join(`
`)),t},n.getTextAndFormat=function(){return this.rows},d}(),Xs=function(){function d(o,a,e){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=o,this.outputFilter=a,this.mode=null,this.verbose=0,this.displayedMemory=new Ro(e),this.nonDisplayedMemory=new Ro(e),this.lastOutputScreen=new Ro(e),this.currRollUpRow=this.displayedMemory.rows[Jt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=e}var n=d.prototype;return n.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Jt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},n.getHandler=function(){return this.outputFilter},n.setHandler=function(a){this.outputFilter=a},n.setPAC=function(a){this.writeScreen.setPAC(a)},n.setBkgData=function(a){this.writeScreen.setBkgData(a)},n.setMode=function(a){a!==this.mode&&(this.mode=a,this.logger.log(Ge.INFO,"MODE="+a),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},n.insertChars=function(a){for(var e=0;e<a.length;e++)this.writeScreen.insertChar(a[e]);var t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(Ge.INFO,t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(Ge.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},n.ccRCL=function(){this.logger.log(Ge.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},n.ccBS=function(){this.logger.log(Ge.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},n.ccAOF=function(){},n.ccAON=function(){},n.ccDER=function(){this.logger.log(Ge.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},n.ccRU=function(a){this.logger.log(Ge.INFO,"RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},n.ccFON=function(){this.logger.log(Ge.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},n.ccRDC=function(){this.logger.log(Ge.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},n.ccTR=function(){this.logger.log(Ge.INFO,"TR"),this.setMode("MODE_TEXT")},n.ccRTD=function(){this.logger.log(Ge.INFO,"RTD"),this.setMode("MODE_TEXT")},n.ccEDM=function(){this.logger.log(Ge.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},n.ccCR=function(){this.logger.log(Ge.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},n.ccENM=function(){this.logger.log(Ge.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},n.ccEOC=function(){if(this.logger.log(Ge.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,this.logger.log(Ge.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},n.ccTO=function(a){this.logger.log(Ge.INFO,"TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},n.ccMIDROW=function(a){var e={flash:!1};if(e.underline=a%2===1,e.italics=a>=46,e.italics)e.foreground="white";else{var t=Math.floor(a/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=s[t]}this.logger.log(Ge.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},n.outputDataUpdate=function(a){a===void 0&&(a=!1);var e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),a&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))},n.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},d}(),Uu=function(){function d(o,a,e){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var t=new Mu;this.channels=[null,new Xs(o,a,t),new Xs(o+1,e,t)],this.cmdHistory=$s(),this.logger=t}var n=d.prototype;return n.getHandler=function(a){return this.channels[a].getHandler()},n.setHandler=function(a,e){this.channels[a].setHandler(e)},n.addData=function(a,e){var t,s,u,h=!1;this.logger.time=a;for(var m=0;m<e.length;m+=2)if(s=e[m]&127,u=e[m+1]&127,!(s===0&&u===0)){if(this.logger.log(Ge.DATA,"["+Ia([e[m],e[m+1]])+"] -> ("+Ia([s,u])+")"),t=this.parseCmd(s,u),t||(t=this.parseMidrow(s,u)),t||(t=this.parsePAC(s,u)),t||(t=this.parseBackgroundAttributes(s,u)),!t&&(h=this.parseChars(s,u),h)){var I=this.currentChannel;if(I&&I>0){var T=this.channels[I];T.insertChars(h)}else this.logger.log(Ge.WARNING,"No channel found yet. TEXT-MODE?")}!t&&!h&&this.logger.log(Ge.WARNING,"Couldn't parse cleaned data "+Ia([s,u])+" orig: "+Ia([e[m],e[m+1]]))}},n.parseCmd=function(a,e){var t=this.cmdHistory,s=(a===20||a===28||a===21||a===29)&&e>=32&&e<=47,u=(a===23||a===31)&&e>=33&&e<=35;if(!(s||u))return!1;if(Ys(a,e,t))return _a(null,null,t),this.logger.log(Ge.DEBUG,"Repeated command ("+Ia([a,e])+") is dropped"),!0;var h=a===20||a===21||a===23?1:2,m=this.channels[h];return a===20||a===21||a===28||a===29?e===32?m.ccRCL():e===33?m.ccBS():e===34?m.ccAOF():e===35?m.ccAON():e===36?m.ccDER():e===37?m.ccRU(2):e===38?m.ccRU(3):e===39?m.ccRU(4):e===40?m.ccFON():e===41?m.ccRDC():e===42?m.ccTR():e===43?m.ccRTD():e===44?m.ccEDM():e===45?m.ccCR():e===46?m.ccENM():e===47&&m.ccEOC():m.ccTO(e-32),_a(a,e,t),this.currentChannel=h,!0},n.parseMidrow=function(a,e){var t=0;if((a===17||a===25)&&e>=32&&e<=47){if(a===17?t=1:t=2,t!==this.currentChannel)return this.logger.log(Ge.ERROR,"Mismatch channel in midrow parsing"),!1;var s=this.channels[t];return s?(s.ccMIDROW(e),this.logger.log(Ge.DEBUG,"MIDROW ("+Ia([a,e])+")"),!0):!1}return!1},n.parsePAC=function(a,e){var t,s=this.cmdHistory,u=(a>=17&&a<=23||a>=25&&a<=31)&&e>=64&&e<=127,h=(a===16||a===24)&&e>=64&&e<=95;if(!(u||h))return!1;if(Ys(a,e,s))return _a(null,null,s),!0;var m=a<=23?1:2;e>=64&&e<=95?t=m===1?Du[a]:Pu[a]:t=m===1?ku[a]:Fu[a];var I=this.channels[m];return I?(I.setPAC(this.interpretPAC(t,e)),_a(a,e,s),this.currentChannel=m,!0):!1},n.interpretPAC=function(a,e){var t=e,s={color:null,italics:!1,indent:null,underline:!1,row:a};return e>95?t=e-96:t=e-64,s.underline=(t&1)===1,t<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(t/2)]:t<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((t-16)/2)*4,s},n.parseChars=function(a,e){var t,s=null,u=null;if(a>=25?(t=2,u=a-8):(t=1,u=a),u>=17&&u<=19){var h=e;u===17?h=e+80:u===18?h=e+112:h=e+144,this.logger.log(Ge.INFO,"Special char '"+js(h)+"' in channel "+t),s=[h]}else a>=32&&a<=127&&(s=e===0?[a]:[a,e]);if(s){var m=Ia(s);this.logger.log(Ge.DEBUG,"Char codes =  "+m.join(",")),_a(a,e,this.cmdHistory)}return s},n.parseBackgroundAttributes=function(a,e){var t=(a===16||a===24)&&e>=32&&e<=47,s=(a===23||a===31)&&e>=45&&e<=47;if(!(t||s))return!1;var u,h={};a===16||a===24?(u=Math.floor((e-32)/2),h.background=Ou[u],e%2===1&&(h.background=h.background+"_semi")):e===45?h.background="transparent":(h.foreground="black",e===47&&(h.underline=!0));var m=a<=23?1:2,I=this.channels[m];return I.setBkgData(h),_a(a,e,this.cmdHistory),!0},n.reset=function(){for(var a=0;a<Object.keys(this.channels).length;a++){var e=this.channels[a];e&&e.reset()}this.cmdHistory=$s()},n.cueSplitAtTime=function(a){for(var e=0;e<this.channels.length;e++){var t=this.channels[e];t&&t.cueSplitAtTime(a)}},d}();function _a(d,n,o){o.a=d,o.b=n}function Ys(d,n,o){return o.a===d&&o.b===n}function $s(){return{a:null,b:null}}var Zs=Uu,jr=function(){function d(o,a){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=o,this.trackName=a}var n=d.prototype;return n.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},n.newCue=function(a,e,t){(this.startTime===null||this.startTime>a)&&(this.startTime=a),this.endTime=e,this.screen=t,this.timelineController.createCaptionsTrack(this.trackName)},n.reset=function(){this.cueRanges=[]},d}(),Do=function(n,o,a){return n.substr(a||0,o.length)===o},Gu=function(n){var o=parseInt(n.substr(-3)),a=parseInt(n.substr(-6,2)),e=parseInt(n.substr(-9,2)),t=n.length>9?parseInt(n.substr(0,n.indexOf(":"))):0;if(!Object(R.isFiniteNumber)(o)||!Object(R.isFiniteNumber)(a)||!Object(R.isFiniteNumber)(e)||!Object(R.isFiniteNumber)(t))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+n);return o+=1e3*a,o+=60*1e3*e,o+=60*60*1e3*t,o},ko=function(n){for(var o=5381,a=n.length;a;)o=o*33^n.charCodeAt(--a);return(o>>>0).toString()},Vu=function(n,o,a){var e=n[o],t=n[e.prevCC];if(!t||!t.new&&e.new){n.ccOffset=n.presentationOffset=e.start,e.new=!1;return}for(;t&&t.new;)n.ccOffset+=e.start-t.start,e.new=!1,e=t,t=n[e.prevCC];n.presentationOffset=a},qu={parse:function(n,o,a,e,t,s){var u=/\r\n|\n\r|\n|\r/g,h=Object(ha.utf8ArrayToStr)(new Uint8Array(n)).trim().replace(u,`
`).split(`
`),m="00:00.000",I=0,T=0,b=0,N=[],W,ee=!0,oe=!1,he=new _u;he.oncue=function(fe){var ye=a[e],Ae=a.ccOffset;ye&&ye.new&&(T!==void 0?Ae=a.ccOffset=ye.start:Vu(a,e,b)),b&&(Ae=b-a.presentationOffset),oe&&(fe.startTime+=Ae-T,fe.endTime+=Ae-T),fe.id=ko(fe.startTime.toString())+ko(fe.endTime.toString())+ko(fe.text),fe.text=decodeURIComponent(encodeURIComponent(fe.text)),fe.endTime>0&&N.push(fe)},he.onparsingerror=function(fe){W=fe},he.onflush=function(){if(W&&s){s(W);return}t(N)},h.forEach(function(fe){if(ee)if(Do(fe,"X-TIMESTAMP-MAP=")){ee=!1,oe=!0,fe.substr(16).split(",").forEach(function(ye){Do(ye,"LOCAL:")?m=ye.substr(6):Do(ye,"MPEGTS:")&&(I=parseInt(ye.substr(7)))});try{o+(a[e].start*9e4||0)<0&&(o+=8589934592),I-=o,T=Gu(m)/1e3,b=I/9e4}catch(ye){oe=!1,W=ye}return}else fe===""&&(ee=!1);he.parse(fe+`
`)}),he.flush()}},Hu=qu;function zr(d){if(d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d}function Ku(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var Wu=function(d){Ku(n,d);function n(a){var e;if(e=d.call(this,a,c.default.MEDIA_ATTACHING,c.default.MEDIA_DETACHING,c.default.FRAG_PARSING_USERDATA,c.default.FRAG_DECRYPTED,c.default.MANIFEST_LOADING,c.default.MANIFEST_LOADED,c.default.FRAG_LOADED,c.default.INIT_PTS_FOUND)||this,e.media=null,e.config=void 0,e.enabled=!0,e.Cues=void 0,e.textTracks=[],e.tracks=[],e.initPTS=[],e.unparsedVttFrags=[],e.captionsTracks={},e.nonNativeCaptionsTracks={},e.captionsProperties=void 0,e.cea608Parser1=void 0,e.cea608Parser2=void 0,e.lastSn=-1,e.prevCC=-1,e.vttCCs=Js(),e.hls=a,e.config=a.config,e.Cues=a.config.cueHandler,e.captionsProperties={textTrack1:{label:e.config.captionsTextTrack1Label,languageCode:e.config.captionsTextTrack1LanguageCode},textTrack2:{label:e.config.captionsTextTrack2Label,languageCode:e.config.captionsTextTrack2LanguageCode},textTrack3:{label:e.config.captionsTextTrack3Label,languageCode:e.config.captionsTextTrack3LanguageCode},textTrack4:{label:e.config.captionsTextTrack4Label,languageCode:e.config.captionsTextTrack4LanguageCode}},e.config.enableCEA708Captions){var t=new jr(zr(e),"textTrack1"),s=new jr(zr(e),"textTrack2"),u=new jr(zr(e),"textTrack3"),h=new jr(zr(e),"textTrack4");e.cea608Parser1=new Zs(1,t,s),e.cea608Parser2=new Zs(3,u,h)}return e}var o=n.prototype;return o.addCues=function(e,t,s,u,h){for(var m=!1,I=h.length;I--;){var T=h[I],b=zu(T[0],T[1],t,s);if(b>=0&&(T[0]=Math.min(T[0],t),T[1]=Math.max(T[1],s),m=!0,b/(s-t)>.5))return}if(m||h.push([t,s]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[e],t,s,u);else{var N=this.Cues.newCue(null,t,s,u);this.hls.trigger(c.default.CUES_PARSED,{type:"captions",cues:N,track:e})}},o.onInitPtsFound=function(e){var t=this,s=e.frag,u=e.id,h=e.initPTS,m=this.unparsedVttFrags;u==="main"&&(this.initPTS[s.cc]=h),m.length&&(this.unparsedVttFrags=[],m.forEach(function(I){t.onFragLoaded(I)}))},o.getExistingTrack=function(e){var t=this.media;if(t)for(var s=0;s<t.textTracks.length;s++){var u=t.textTracks[s];if(u[e])return u}return null},o.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},o.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,s=this.captionsTracks,u=this.media,h=t[e],m=h.label,I=h.languageCode,T=this.getExistingTrack(e);if(T)s[e]=T,ya(s[e]),Vr(s[e],u);else{var b=this.createTextTrack("captions",m,I);b&&(b[e]=!0,s[e]=b)}}},o.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var s=t.label,u={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=u,this.hls.trigger(c.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[u]})}}},o.createTextTrack=function(e,t,s){var u=this.media;if(u)return u.addTextTrack(e,t,s)},o.destroy=function(){d.prototype.destroy.call(this)},o.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},o.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){ya(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},o.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=Js(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},o._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var s=0;s<t.length;s++)ya(t[s])}},o.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT){var s=e.subtitles||[],u=this.tracks&&s&&this.tracks.length===s.length;if(this.tracks=e.subtitles||[],this.config.renderTextTracksNatively){var h=this.media?this.media.textTracks:[];this.tracks.forEach(function(I,T){var b;if(T<h.length){for(var N=null,W=0;W<h.length;W++)if(ju(h[W],I)){N=h[W];break}N&&(b=N)}b||(b=t.createTextTrack("subtitles",I.name,I.lang)),I.default?b.mode=t.hls.subtitleDisplay?"showing":"hidden":b.mode="disabled",t.textTracks.push(b)})}else if(!u&&this.tracks&&this.tracks.length){var m=this.tracks.map(function(I){return{label:I.name,kind:I.type.toLowerCase(),default:I.default,subtitleTrack:I}});this.hls.trigger(c.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:m})}}this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(I){var T=/(?:CC|SERVICE)([1-4])/.exec(I.instreamId);if(T){var b="textTrack"+T[1],N=t.captionsProperties[b];N&&(N.label=I.name,I.lang&&(N.languageCode=I.lang),N.media=I)}})},o.onFragLoaded=function(e){var t=e.frag,s=e.payload,u=this.cea608Parser1,h=this.cea608Parser2,m=this.initPTS,I=this.lastSn,T=this.unparsedVttFrags;if(t.type==="main"){var b=t.sn;t.sn!==I+1&&u&&h&&(u.reset(),h.reset()),this.lastSn=b}else if(t.type==="subtitle")if(s.byteLength){if(!Object(R.isFiniteNumber)(m[t.cc])){T.push(e),m.length&&this.hls.trigger(c.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t});return}var N=t.decryptdata;(N==null||N.key==null||N.method!=="AES-128")&&this._parseVTTs(t,s)}else this.hls.trigger(c.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},o._parseVTTs=function(e,t){var s=this,u=this.hls,h=this.prevCC,m=this.textTracks,I=this.vttCCs;I[e.cc]||(I[e.cc]={start:e.start,prevCC:h,new:!0},this.prevCC=e.cc),Hu.parse(t,this.initPTS[e.cc],I,e.cc,function(T){if(s.config.renderTextTracksNatively){var b=m[e.level];if(b.mode==="disabled"){u.trigger(c.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e});return}T.forEach(function(W){if(!b.cues.getCueById(W.id))try{if(b.addCue(W),!b.cues.getCueById(W.id))throw new Error("addCue is failed for: "+W)}catch(oe){p.logger.debug("Failed occurred on adding cues: "+oe);var ee=new window.TextTrackCue(W.startTime,W.endTime,W.text);ee.id=W.id,b.addCue(ee)}})}else{var N=s.tracks[e.level].default?"default":"subtitles"+e.level;u.trigger(c.default.CUES_PARSED,{type:"subtitles",cues:T,track:N})}u.trigger(c.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(T){p.logger.log("Failed to parse VTT cue: "+T),u.trigger(c.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},o.onFragDecrypted=function(e){var t=e.frag,s=e.payload;if(t.type==="subtitle"){if(!Object(R.isFiniteNumber)(this.initPTS[t.cc])){this.unparsedVttFrags.push(e);return}this._parseVTTs(t,s)}},o.onFragParsingUserdata=function(e){var t=this.cea608Parser1,s=this.cea608Parser2;if(!(!this.enabled||!(t&&s)))for(var u=0;u<e.samples.length;u++){var h=e.samples[u].bytes;if(h){var m=this.extractCea608Data(h);t.addData(e.samples[u].pts,m[0]),s.addData(e.samples[u].pts,m[1])}}},o.extractCea608Data=function(e){for(var t=e[0]&31,s=2,u=[[],[]],h=0;h<t;h++){var m=e[s++],I=127&e[s++],T=127&e[s++],b=(4&m)!==0,N=3&m;I===0&&T===0||b&&(N===0||N===1)&&(u[N].push(I),u[N].push(T))}return u},n}(E);function ju(d,n){return d&&d.label===n.name&&!(d.textTrack1||d.textTrack2)}function zu(d,n,o,a){return Math.min(n,a)-Math.max(d,o)}function Js(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}var Xu=Wu;function Qs(d,n){for(var o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function Yu(d,n,o){return n&&Qs(d.prototype,n),o&&Qs(d,o),d}function $u(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var Zu=function(d){$u(n,d);function n(a){var e;return e=d.call(this,a,c.default.MEDIA_ATTACHED,c.default.MEDIA_DETACHING,c.default.MANIFEST_LOADED,c.default.SUBTITLE_TRACK_LOADED)||this,e.tracks=[],e.trackId=-1,e.media=null,e.stopped=!0,e.subtitleDisplay=!0,e.queuedDefaultTrack=null,e}var o=n.prototype;return o.destroy=function(){E.prototype.destroy.call(this)},o.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(Object(R.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},o.onMediaDetaching=function(){if(this.media){this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(R.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack);var e=Po(this.media.textTracks);e.forEach(function(t){ya(t)}),this.subtitleTrack=-1,this.media=null}},o.onManifestLoaded=function(e){var t=this,s=e.subtitles||[];this.tracks=s,this.hls.trigger(c.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:s}),s.forEach(function(u){u.default&&(t.media?t.subtitleTrack=u.id:t.queuedDefaultTrack=u.id)})},o.onSubtitleTrackLoaded=function(e){var t=this,s=e.id,u=e.details,h=this.trackId,m=this.tracks,I=m[h];if(s>=m.length||s!==h||!I||this.stopped){this._clearReloadTimer();return}if(p.logger.log("subtitle track "+s+" loaded"),u.live){var T=be(I.details,u,e.stats.trequest);p.logger.log("Reloading live subtitle playlist in "+T+"ms"),this.timer=setTimeout(function(){t._loadCurrentTrack()},T)}else this._clearReloadTimer()},o.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},o.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},o._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},o._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,s=this.hls,u=t[e];e<0||!u||u.details&&!u.details.live||(p.logger.log("Loading subtitle track "+e),s.trigger(c.default.SUBTITLE_TRACK_LOADING,{url:u.url,id:e}))},o._toggleTrackModes=function(e){var t=this.media,s=this.subtitleDisplay,u=this.trackId;if(t){var h=Po(t.textTracks);if(e===-1)[].slice.call(h).forEach(function(T){T.mode="disabled"});else{var m=h[u];m&&(m.mode="disabled")}var I=h[e];I&&(I.mode=s?"showing":"hidden")}},o._setSubtitleTrackInternal=function(e){var t=this.hls,s=this.tracks;!Object(R.isFiniteNumber)(e)||e<-1||e>=s.length||(this.trackId=e,p.logger.log("Switching to subtitle track "+e),t.trigger(c.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},o._onTextTracksChanged=function(){if(!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,t=Po(this.media.textTracks),s=0;s<t.length;s++)if(t[s].mode==="hidden")e=s;else if(t[s].mode==="showing"){e=s;break}this.subtitleTrack=e}},Yu(n,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}]),n}(E);function Po(d){for(var n=[],o=0;o<d.length;o++){var a=d[o];a.kind==="subtitles"&&a.label&&n.push(d[o])}return n}var Ju=Zu,Qu=l("./src/crypt/decrypter.js");function ed(d){if(d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d}function td(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var ad=window,ei=ad.performance,Fo=500,rd=function(d){td(n,d);function n(a,e){var t;return t=d.call(this,a,c.default.MEDIA_ATTACHED,c.default.MEDIA_DETACHING,c.default.ERROR,c.default.KEY_LOADED,c.default.FRAG_LOADED,c.default.SUBTITLE_TRACKS_UPDATED,c.default.SUBTITLE_TRACK_SWITCH,c.default.SUBTITLE_TRACK_LOADED,c.default.SUBTITLE_FRAG_PROCESSED,c.default.LEVEL_UPDATED)||this,t.fragmentTracker=e,t.config=a.config,t.state=X.STOPPED,t.tracks=[],t.tracksBuffered=[],t.currentTrackId=-1,t.decrypter=new Qu.default(a,a.config),t.lastAVStart=0,t._onMediaSeeking=t.onMediaSeeking.bind(ed(t)),t}var o=n.prototype;return o.startLoad=function(){this.stopLoad(),this.state=X.IDLE;var e=this.tracks[this.currentTrackId];e&&e.details&&(this.setInterval(Fo),this.tick())},o.onSubtitleFragProcessed=function(e){var t=e.frag,s=e.success;if(this.fragPrevious=t,this.state=X.IDLE,!!s){var u=this.tracksBuffered[this.currentTrackId];if(u){for(var h,m=t.start,I=0;I<u.length;I++)if(m>=u[I].start&&m<=u[I].end){h=u[I];break}var T=t.start+t.duration;h?h.end=T:(h={start:m,end:T},u.push(h))}}},o.onMediaAttached=function(e){var t=e.media;this.media=t,t.addEventListener("seeking",this._onMediaSeeking),this.state=X.IDLE},o.onMediaDetaching=function(){var e=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach(function(t){e.tracksBuffered[t.id]=[]}),this.media=null,this.state=X.STOPPED)},o.onError=function(e){var t=e.frag;!t||t.type!=="subtitle"||(this.fragCurrent&&this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.state=X.IDLE)},o.onSubtitleTracksUpdated=function(e){var t=this;p.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach(function(s){t.tracksBuffered[s.id]=[]})},o.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,!this.tracks||!this.tracks.length||this.currentTrackId===-1){this.clearInterval();return}var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(Fo)},o.onSubtitleTrackLoaded=function(e){var t=e.id,s=e.details,u=this.currentTrackId,h=this.tracks,m=h[u];t>=h.length||t!==u||!m||(s.live&&te(m.details,s,this.lastAVStart),m.details=s,this.setInterval(Fo))},o.onKeyLoaded=function(){this.state===X.KEY_LOADING&&(this.state=X.IDLE)},o.onFragLoaded=function(e){var t=this.fragCurrent,s=e.frag.decryptdata,u=e.frag,h=this.hls;if(this.state===X.FRAG_LOADING&&t&&e.frag.type==="subtitle"&&t.sn===e.frag.sn&&e.payload.byteLength>0&&s&&s.key&&s.method==="AES-128"){var m=ei.now();this.decrypter.decrypt(e.payload,s.key.buffer,s.iv.buffer,function(I){var T=ei.now();h.trigger(c.default.FRAG_DECRYPTED,{frag:u,payload:I,stats:{tstart:m,tdecrypt:T}})})}},o.onLevelUpdated=function(e){var t=e.details,s=t.fragments;this.lastAVStart=s.length?s[0].start:0},o.doTick=function(){if(!this.media){this.state=X.IDLE;return}switch(this.state){case X.IDLE:{var e=this.config,t=this.currentTrackId,s=this.fragmentTracker,u=this.media,h=this.tracks;if(!h||!h[t]||!h[t].details)break;var m=e.maxBufferHole,I=e.maxFragLookUpTolerance,T=Math.min(e.maxBufferLength,e.maxMaxBufferLength),b=v.bufferedInfo(this._getBuffered(),u.currentTime,m),N=b.end,W=b.len,ee=h[t].details,oe=ee.fragments,he=oe.length,fe=oe[he-1].start+oe[he-1].duration;if(W>T)return;var ye,Ae=this.fragPrevious;N<fe?(Ae&&ee.hasProgramDateTime&&(ye=At(oe,Ae.endProgramDateTime,I)),ye||(ye=ht(Ae,oe,N,I))):ye=oe[he-1],ye&&ye.encrypted?(p.logger.log("Loading key for "+ye.sn),this.state=X.KEY_LOADING,this.hls.trigger(c.default.KEY_LOADING,{frag:ye})):ye&&s.getState(ye)===Re.NOT_LOADED&&(this.fragCurrent=ye,this.state=X.FRAG_LOADING,this.hls.trigger(c.default.FRAG_LOADING,{frag:ye}))}}},o.stopLoad=function(){this.lastAVStart=0,this.fragPrevious=null,d.prototype.stopLoad.call(this)},o._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},o.onMediaSeeking=function(){if(this.fragCurrent){var e=this.media?this.media.currentTime:0,t=this.config.maxFragLookUpTolerance,s=this.fragCurrent.start-t,u=this.fragCurrent.start+this.fragCurrent.duration+t;(e<s||e>u)&&(this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragmentTracker.removeFragment(this.fragCurrent),this.fragCurrent=null,this.fragPrevious=null,this.state=X.IDLE,this.tick())}},n}(la),Ra;(function(d){d.WIDEVINE="com.widevine.alpha",d.PLAYREADY="com.microsoft.playready"})(Ra||(Ra={}));var od=function(){return typeof window<"u"&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null}();function ti(d,n){for(var o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function sd(d,n,o){return n&&ti(d.prototype,n),o&&ti(d,o),d}function id(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var ai=3,nd=function(n,o,a){var e={audioCapabilities:[],videoCapabilities:[]};return n.forEach(function(t){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:a.audioRobustness||""})}),o.forEach(function(t){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:a.videoRobustness||""})}),[e]},ld=function(n,o,a,e){switch(n){case Ra.WIDEVINE:return nd(o,a,e);default:throw new Error("Unknown key-system: "+n)}},ud=function(d){id(n,d);function n(a){var e;return e=d.call(this,a,c.default.MEDIA_ATTACHED,c.default.MEDIA_DETACHED,c.default.MANIFEST_PARSED)||this,e._widevineLicenseUrl=void 0,e._licenseXhrSetup=void 0,e._emeEnabled=void 0,e._requestMediaKeySystemAccess=void 0,e._drmSystemOptions=void 0,e._config=void 0,e._mediaKeysList=[],e._media=null,e._hasSetMediaKeys=!1,e._requestLicenseFailureCount=0,e.mediaKeysPromise=null,e._onMediaEncrypted=function(t){if(p.logger.log('Media is encrypted using "'+t.initDataType+'" init data type'),!e.mediaKeysPromise){p.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),e.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.KEY_SYSTEM_ERROR,details:x.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var s=function(h){e._media&&(e._attemptSetMediaKeys(h),e._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};e.mediaKeysPromise.then(s).catch(s)},e._config=a.config,e._widevineLicenseUrl=e._config.widevineLicenseUrl,e._licenseXhrSetup=e._config.licenseXhrSetup,e._emeEnabled=e._config.emeEnabled,e._requestMediaKeySystemAccess=e._config.requestMediaKeySystemAccessFunc,e._drmSystemOptions=a.config.drmSystemOptions,e}var o=n.prototype;return o.getLicenseServerUrl=function(e){switch(e){case Ra.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},o._attemptKeySystemAccess=function(e,t,s){var u=this,h=ld(e,t,s,this._drmSystemOptions);p.logger.log("Requesting encrypted media key-system access");var m=this.requestMediaKeySystemAccess(e,h);this.mediaKeysPromise=m.then(function(I){return u._onMediaKeySystemAccessObtained(e,I)}),m.catch(function(I){p.logger.error('Failed to obtain key-system "'+e+'" access:',I)})},o._onMediaKeySystemAccessObtained=function(e,t){var s=this;p.logger.log('Access for key-system "'+e+'" obtained');var u={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(u);var h=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(m){return u.mediaKeys=m,p.logger.log('Media-keys created for key-system "'+e+'"'),s._onMediaKeysCreated(),m});return h.catch(function(m){p.logger.error("Failed to create media-keys:",m)}),h},o._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},o._onNewMediaKeySession=function(e){var t=this;p.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",function(s){t._onKeySessionMessage(e,s.message)},!1)},o._onKeySessionMessage=function(e,t){p.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(s){p.logger.log("Received license data (length: "+(s&&s.byteLength)+"), updating key-session"),e.update(s)})},o._attemptSetMediaKeys=function(e){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys){p.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.KEY_SYSTEM_ERROR,details:x.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}p.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},o._generateRequestWithPreferredKeySession=function(e,t){var s=this,u=this._mediaKeysList[0];if(!u){p.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.KEY_SYSTEM_ERROR,details:x.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(u.mediaKeysSessionInitialized){p.logger.warn("Key-Session already initialized but requested again");return}var h=u.mediaKeysSession;if(!h){p.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.KEY_SYSTEM_ERROR,details:x.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!t){p.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.KEY_SYSTEM_ERROR,details:x.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}p.logger.log('Generating key-session request for "'+e+'" init data type'),u.mediaKeysSessionInitialized=!0,h.generateRequest(e,t).then(function(){p.logger.debug("Key-session generation succeeded")}).catch(function(m){p.logger.error("Error generating key-session request:",m),s.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.KEY_SYSTEM_ERROR,details:x.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},o._createLicenseXhr=function(e,t,s){var u=new XMLHttpRequest,h=this._licenseXhrSetup;try{if(h)try{h(u,e)}catch{u.open("POST",e,!0),h(u,e)}u.readyState||u.open("POST",e,!0)}catch(m){throw new Error("issue setting up KeySystem license XHR "+m)}return u.responseType="arraybuffer",u.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,u,e,t,s),u},o._onLicenseRequestReadyStageChange=function(e,t,s,u){switch(e.readyState){case 4:if(e.status===200)this._requestLicenseFailureCount=0,p.logger.log("License request succeeded"),e.responseType!=="arraybuffer"&&p.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),u(e.response);else{if(p.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>ai){this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.KEY_SYSTEM_ERROR,details:x.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var h=ai-this._requestLicenseFailureCount+1;p.logger.warn("Retrying license request, "+h+" attempts left"),this._requestLicense(s,u)}break}},o._generateLicenseRequestChallenge=function(e,t){switch(e.mediaKeySystemDomain){case Ra.WIDEVINE:return t}throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},o._requestLicense=function(e,t){p.logger.log("Requesting content license for key-system");var s=this._mediaKeysList[0];if(!s){p.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.KEY_SYSTEM_ERROR,details:x.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var u=this.getLicenseServerUrl(s.mediaKeySystemDomain),h=this._createLicenseXhr(u,e,t);p.logger.log("Sending license request to URL: "+u);var m=this._generateLicenseRequestChallenge(s,e);h.send(m)}catch(I){p.logger.error("Failure requesting DRM license: "+I),this.hls.trigger(c.default.ERROR,{type:x.ErrorTypes.KEY_SYSTEM_ERROR,details:x.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},o.onMediaAttached=function(e){if(this._emeEnabled){var t=e.media;this._media=t,t.addEventListener("encrypted",this._onMediaEncrypted)}},o.onMediaDetached=function(){var e=this._media,t=this._mediaKeysList;e&&(e.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map(function(s){if(s.mediaKeysSession)return s.mediaKeysSession.close().catch(function(){})})).then(function(){return e.setMediaKeys(null)}).catch(function(){}))},o.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map(function(u){return u.audioCodec}),s=e.levels.map(function(u){return u.videoCodec});this._attemptKeySystemAccess(Ra.WIDEVINE,t,s)}},sd(n,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),n}(E),dd=ud;function ri(d,n){var o=Object.keys(d);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(d);n&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})),o.push.apply(o,a)}return o}function oi(d){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?ri(Object(o),!0).forEach(function(a){fd(d,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(o)):ri(Object(o)).forEach(function(a){Object.defineProperty(d,a,Object.getOwnPropertyDescriptor(o,a))})}return d}function fd(d,n,o){return n in d?Object.defineProperty(d,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):d[n]=o,d}var cd=oi(oi({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:gu,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:au,bufferController:su,capLevelController:uu,fpsController:hu,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:od,testBandwidth:!0},pd()),{},{subtitleStreamController:rd,subtitleTrackController:Ju,timelineController:Xu,audioStreamController:Au,audioTrackController:yu,emeController:dd});function pd(){return{cueHandler:g,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function si(d,n){var o=Object.keys(d);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(d);n&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(d,e).enumerable})),o.push.apply(o,a)}return o}function ii(d){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?si(Object(o),!0).forEach(function(a){hd(d,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(o)):si(Object(o)).forEach(function(a){Object.defineProperty(d,a,Object.getOwnPropertyDescriptor(o,a))})}return d}function hd(d,n,o){return n in d?Object.defineProperty(d,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):d[n]=o,d}function Tt(d){if(d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d}function ni(d,n){for(var o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function li(d,n,o){return n&&ni(d.prototype,n),o&&ni(d,o),d}function md(d,n){d.prototype=Object.create(n.prototype),d.prototype.constructor=d,d.__proto__=n}var ui=function(d){md(n,d),n.isSupported=function(){return Ha()},li(n,null,[{key:"version",get:function(){return"0.14.17"}},{key:"Events",get:function(){return c.default}},{key:"ErrorTypes",get:function(){return x.ErrorTypes}},{key:"ErrorDetails",get:function(){return x.ErrorDetails}},{key:"DefaultConfig",get:function(){return n.defaultConfig?n.defaultConfig:cd},set:function(e){n.defaultConfig=e}}]);function n(a){var e;a===void 0&&(a={}),e=d.call(this)||this,e.config=void 0,e._autoLevelCapping=void 0,e.abrController=void 0,e.capLevelController=void 0,e.levelController=void 0,e.streamController=void 0,e.networkControllers=void 0,e.audioTrackController=void 0,e.subtitleTrackController=void 0,e.emeController=void 0,e.coreComponents=void 0,e.media=null,e.url=null;var t=n.DefaultConfig;if((a.liveSyncDurationCount||a.liveMaxLatencyDurationCount)&&(a.liveSyncDuration||a.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");e.config=ii(ii({},t),a);var s=Tt(e),u=s.config;if(u.liveMaxLatencyDurationCount!==void 0&&u.liveMaxLatencyDurationCount<=u.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(u.liveMaxLatencyDuration!==void 0&&(u.liveSyncDuration===void 0||u.liveMaxLatencyDuration<=u.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(p.enableLogs)(u.debug),e._autoLevelCapping=-1;var h=e.abrController=new u.abrController(Tt(e)),m=new u.bufferController(Tt(e)),I=e.capLevelController=new u.capLevelController(Tt(e)),T=new u.fpsController(Tt(e)),b=new nt(Tt(e)),N=new Qe(Tt(e)),W=new ve(Tt(e)),ee=new wa(Tt(e)),oe=e.levelController=new Gr(Tt(e)),he=new ct(Tt(e)),fe=e.streamController=new Va(Tt(e),he),ye=[oe,fe],Ae=u.audioStreamController;Ae&&ye.push(new Ae(Tt(e),he)),e.networkControllers=ye;var Ke=[b,N,W,h,m,I,T,ee,he];if(Ae=u.audioTrackController,Ae){var ut=new Ae(Tt(e));e.audioTrackController=ut,Ke.push(ut)}if(Ae=u.subtitleTrackController,Ae){var Kt=new Ae(Tt(e));e.subtitleTrackController=Kt,ye.push(Kt)}if(Ae=u.emeController,Ae){var _t=new Ae(Tt(e));e.emeController=_t,Ke.push(_t)}return Ae=u.subtitleStreamController,Ae&&ye.push(new Ae(Tt(e),he)),Ae=u.timelineController,Ae&&Ke.push(new Ae(Tt(e))),e.coreComponents=Ke,e}var o=n.prototype;return o.destroy=function(){p.logger.log("destroy"),this.trigger(c.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},o.attachMedia=function(e){p.logger.log("attachMedia"),this.media=e,this.trigger(c.default.MEDIA_ATTACHING,{media:e})},o.detachMedia=function(){p.logger.log("detachMedia"),this.trigger(c.default.MEDIA_DETACHING),this.media=null},o.loadSource=function(e){e=L.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),p.logger.log("loadSource:"+e),this.url=e,this.trigger(c.default.MANIFEST_LOADING,{url:e})},o.startLoad=function(e){e===void 0&&(e=-1),p.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},o.stopLoad=function(){p.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},o.swapAudioCodec=function(){p.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},o.recoverMediaError=function(){p.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),e&&this.attachMedia(e)},o.removeLevel=function(e,t){t===void 0&&(t=0),this.levelController.removeLevel(e,t)},li(n,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){p.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){p.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){p.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){p.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){p.logger.log("set startLevel:"+e),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){p.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"bandwidthEstimate",get:function(){var e=this.abrController._bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,s=e?e.length:0,u=0;u<s;u++){var h=e[u].realBitrate?Math.max(e[u].realBitrate,e[u].bitrate):e[u].bitrate;if(h>t)return u}return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping,s;return t===-1&&e&&e.length?s=e.length-1:s=t,s}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return e?e.subtitleDisplay:!1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),n}(P);ui.defaultConfig=void 0},"./src/polyfills/number.js":function(r,i,l){"use strict";l.r(i),l.d(i,"isFiniteNumber",function(){return g}),l.d(i,"MAX_SAFE_INTEGER",function(){return L});var g=Number.isFinite||function(x){return typeof x=="number"&&isFinite(x)},L=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":function(r,i,l){"use strict";l.r(i),l.d(i,"getSelfScope",function(){return g});function g(){return typeof window>"u"?self:window}},"./src/utils/logger.js":function(r,i,l){"use strict";l.r(i),l.d(i,"enableLogs",function(){return E}),l.d(i,"logger",function(){return M});var g=l("./src/utils/get-self-scope.js");function L(){}var x={trace:L,debug:L,log:L,warn:L,info:L,error:L},R=x;function c(D,F){return F="["+D+"] > "+F,F}var p=Object(g.getSelfScope)();function O(D){var F=p.console[D];return F?function(){for(var q=arguments.length,G=new Array(q),B=0;B<q;B++)G[B]=arguments[B];G[0]&&(G[0]=c(D,G[0])),F.apply(p.console,G)}:L}function A(D){for(var F=arguments.length,q=new Array(F>1?F-1:0),G=1;G<F;G++)q[G-1]=arguments[G];q.forEach(function(B){R[B]=D[B]?D[B].bind(D):O(B)})}var E=function(F){if(p.console&&F===!0||typeof F=="object"){A(F,"debug","log","info","warn","error");try{R.log()}catch{R=x}}else R=x},M=R}}).default})});var gn=Nt((qh,Ma)=>{"use strict";var Mf=typeof Buffer<"u",cn=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,pn=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function hn(r,i,l){l==null&&i!==null&&typeof i=="object"&&(l=i,i=void 0),Mf&&Buffer.isBuffer(r)&&(r=r.toString()),r&&r.charCodeAt(0)===65279&&(r=r.slice(1));let g=JSON.parse(r,i);if(g===null||typeof g!="object")return g;let L=l&&l.protoAction||"error",x=l&&l.constructorAction||"error";if(L==="ignore"&&x==="ignore")return g;if(L!=="ignore"&&x!=="ignore"){if(cn.test(r)===!1&&pn.test(r)===!1)return g}else if(L!=="ignore"&&x==="ignore"){if(cn.test(r)===!1)return g}else if(pn.test(r)===!1)return g;return mn(g,{protoAction:L,constructorAction:x,safe:l&&l.safe})}function mn(r,{protoAction:i="error",constructorAction:l="error",safe:g}={}){let L=[r];for(;L.length;){let x=L;L=[];for(let R of x){if(i!=="ignore"&&Object.prototype.hasOwnProperty.call(R,"__proto__")){if(g===!0)return null;if(i==="error")throw new SyntaxError("Object contains forbidden prototype property");delete R.__proto__}if(l!=="ignore"&&Object.prototype.hasOwnProperty.call(R,"constructor")&&Object.prototype.hasOwnProperty.call(R.constructor,"prototype")){if(g===!0)return null;if(l==="error")throw new SyntaxError("Object contains forbidden prototype property");delete R.constructor}for(let c in R){let p=R[c];p&&typeof p=="object"&&L.push(p)}}}return r}function $o(r,i,l){let g=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return hn(r,i,l)}finally{Error.stackTraceLimit=g}}function Bf(r,i){let l=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return hn(r,i,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=l}}Ma.exports=$o;Ma.exports.default=$o;Ma.exports.parse=$o;Ma.exports.safeParse=Bf;Ma.exports.scan=mn});var yn=Nt(Ln=>{"use strict";var Ba=ze();function lc(r,i){return r===i&&(r!==0||1/r===1/i)||r!==r&&i!==i}var uc=typeof Object.is=="function"?Object.is:lc,dc=Ba.useState,fc=Ba.useEffect,cc=Ba.useLayoutEffect,pc=Ba.useDebugValue;function hc(r,i){var l=i(),g=dc({inst:{value:l,getSnapshot:i}}),L=g[0].inst,x=g[1];return cc(function(){L.value=l,L.getSnapshot=i,es(L)&&x({inst:L})},[r,l,i]),fc(function(){return es(L)&&x({inst:L}),r(function(){es(L)&&x({inst:L})})},[r]),pc(l),l}function es(r){var i=r.getSnapshot;r=r.value;try{var l=i();return!uc(r,l)}catch{return!0}}function mc(r,i){return i()}var gc=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?mc:hc;Ln.useSyncExternalStore=Ba.useSyncExternalStore!==void 0?Ba.useSyncExternalStore:gc});var Sn=Nt((f0,In)=>{"use strict";In.exports=yn()});var Gn=Nt((v0,Un)=>{function Bc(r,i){if(typeof r!="function")throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof r}\`.`);let l,g=0;return function(...x){clearTimeout(l);let R=Date.now(),c=R-g,p=i-c;p<=0?(g=R,r.apply(this,x)):l=setTimeout(()=>{g=Date.now(),r.apply(this,x)},p)}}Un.exports=Bc});var Xn=Nt(fo=>{"use strict";var qc=ze(),Hc=Symbol.for("react.element"),Kc=Symbol.for("react.fragment"),Wc=Object.prototype.hasOwnProperty,jc=qc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,zc={key:!0,ref:!0,__self:!0,__source:!0};function zn(r,i,l){var g,L={},x=null,R=null;l!==void 0&&(x=""+l),i.key!==void 0&&(x=""+i.key),i.ref!==void 0&&(R=i.ref);for(g in i)Wc.call(i,g)&&!zc.hasOwnProperty(g)&&(L[g]=i[g]);if(r&&r.defaultProps)for(g in i=r.defaultProps,i)L[g]===void 0&&(L[g]=i[g]);return{$$typeof:Hc,type:r,key:x,ref:R,props:L,_owner:jc.current}}fo.Fragment=Kc;fo.jsx=zn;fo.jsxs=zn});var Dr=Nt((Z0,Yn)=>{"use strict";Yn.exports=Xn()});var go=Nt(ys=>{"use strict";ys._=ys._interop_require_default=Yc;function Yc(r){return r&&r.__esModule?r:{default:r}}});var ul=Nt(Is=>{"use client";"use strict";Object.defineProperty(Is,"__esModule",{value:!0});Object.defineProperty(Is,"LoadableContext",{enumerable:!0,get:function(){return Jc}});var $c=go(),Zc=$c._(ze()),Jc=Zc.default.createContext(null)});var pl=Nt(Es=>{"use strict";Object.defineProperty(Es,"__esModule",{value:!0});Object.defineProperty(Es,"default",{enumerable:!0,get:function(){return op}});var Qc=go(),Aa=Qc._(ze()),ep=ul();function tp(r){return r&&r.default?r.default:r}var dl=[],fl=[],cl=!1;function ap(r){let i=r(),l={loading:!0,loaded:null,error:null};return l.promise=i.then(g=>(l.loading=!1,l.loaded=g,g)).catch(g=>{throw l.loading=!1,l.error=g,g}),l}function rp(r,i){let l=Object.assign({loader:null,loading:null,delay:200,timeout:null,webpack:null,modules:null},i),g=null;function L(){if(!g){let c=new Ss(r,l);g={getCurrentValue:c.getCurrentValue.bind(c),subscribe:c.subscribe.bind(c),retry:c.retry.bind(c),promise:c.promise.bind(c)}}return g.promise()}if(typeof window>"u"&&dl.push(L),!cl&&typeof window<"u"){let c=l.webpack&&typeof fi.resolveWeak=="function"?l.webpack():l.modules;c&&fl.push(p=>{for(let O of c)if(p.includes(O))return L()})}function x(){L();let c=Aa.default.useContext(ep.LoadableContext);c&&Array.isArray(l.modules)&&l.modules.forEach(p=>{c(p)})}function R(c,p){x();let O=Aa.default.useSyncExternalStore(g.subscribe,g.getCurrentValue,g.getCurrentValue);return Aa.default.useImperativeHandle(p,()=>({retry:g.retry}),[]),Aa.default.useMemo(()=>O.loading||O.error?Aa.default.createElement(l.loading,{isLoading:O.loading,pastDelay:O.pastDelay,timedOut:O.timedOut,error:O.error,retry:g.retry}):O.loaded?Aa.default.createElement(tp(O.loaded),c):null,[c,O])}return R.preload=()=>L(),R.displayName="LoadableComponent",Aa.default.forwardRef(R)}var Ss=class{promise(){return this._res.promise}retry(){this._clearTimeouts(),this._res=this._loadFn(this._opts.loader),this._state={pastDelay:!1,timedOut:!1};let{_res:i,_opts:l}=this;i.loading&&(typeof l.delay=="number"&&(l.delay===0?this._state.pastDelay=!0:this._delay=setTimeout(()=>{this._update({pastDelay:!0})},l.delay)),typeof l.timeout=="number"&&(this._timeout=setTimeout(()=>{this._update({timedOut:!0})},l.timeout))),this._res.promise.then(()=>{this._update({}),this._clearTimeouts()}).catch(g=>{this._update({}),this._clearTimeouts()}),this._update({})}_update(i){this._state={...this._state,error:this._res.error,loaded:this._res.loaded,loading:this._res.loading,...i},this._callbacks.forEach(l=>l())}_clearTimeouts(){clearTimeout(this._delay),clearTimeout(this._timeout)}getCurrentValue(){return this._state}subscribe(i){return this._callbacks.add(i),()=>{this._callbacks.delete(i)}}constructor(i,l){this._loadFn=i,this._opts=l,this._callbacks=new Set,this._delay=null,this._timeout=null,this.retry()}};function xo(r){return rp(ap,r)}function Cs(r,i){let l=[];for(;r.length;){let g=r.pop();l.push(g(i))}return Promise.all(l).then(()=>{if(r.length)return Cs(r,i)})}xo.preloadAll=()=>new Promise((r,i)=>{Cs(dl).then(r,i)});xo.preloadReady=r=>(r===void 0&&(r=[]),new Promise(i=>{let l=()=>(cl=!0,i());Cs(fl,r).then(l,l)}));typeof window<"u"&&(window.__NEXT_PRELOADREADY=xo.preloadReady);var op=xo});var vl=Nt((Qt,xl)=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});function sp(r,i){for(var l in i)Object.defineProperty(r,l,{enumerable:!0,get:i[l]})}sp(Qt,{noSSR:function(){return gl},default:function(){return up}});var ml=go(),ip=Dr(),bv=ml._(ze()),np=ml._(pl()),lp=typeof window>"u";function hl(r){return{default:r?.default||r}}function gl(r,i){if(delete i.webpack,delete i.modules,!lp)return r(i);let l=i.loading;return()=>(0,ip.jsx)(l,{error:null,isLoading:!0,pastDelay:!1,timedOut:!1})}function up(r,i){let l=np.default,g={loading:R=>{let{error:c,isLoading:p,pastDelay:O}=R;return null}};r instanceof Promise?g.loader=()=>r:typeof r=="function"?g.loader=r:typeof r=="object"&&(g={...g,...r}),g={...g,...i};let L=g.loader,x=()=>L!=null?L().then(hl):Promise.resolve(hl(()=>null));return g.loadableGenerated&&(g={...g,...g.loadableGenerated},delete g.loadableGenerated),typeof g.ssr=="boolean"&&!g.ssr?(delete g.webpack,delete g.modules,gl(l,g)):l({...g,loader:x})}(typeof Qt.default=="function"||typeof Qt.default=="object"&&Qt.default!==null)&&typeof Qt.default.__esModule>"u"&&(Object.defineProperty(Qt.default,"__esModule",{value:!0}),Object.assign(Qt.default,Qt),xl.exports=Qt.default)});var yl=Nt((wv,Ll)=>{Ll.exports=vl()});var Sl={};Mo(Sl,{default:()=>Il});function Il({programs:r,onSelect:i}){return tt.default.createElement("div",{className:"space-y-4 w-full max-w-3xl"},tt.default.createElement("h3",{className:"text-lg font-semibold mb-4"},"Recommended Programs"),tt.default.createElement("div",{className:"grid gap-4"},r.map(l=>tt.default.createElement("div",{key:l.id,className:"bg-white rounded-lg shadow-sm border p-4 hover:shadow-md transition-shadow"},tt.default.createElement("div",{className:"flex items-start justify-between"},tt.default.createElement("div",{className:"space-y-2"},tt.default.createElement("h4",{className:"font-semibold text-lg"},l.title),tt.default.createElement("p",{className:"text-gray-600"},l.university),tt.default.createElement("div",{className:"grid grid-cols-2 gap-2 text-sm text-gray-500"},tt.default.createElement("div",{className:"flex items-center gap-1"},tt.default.createElement(tr,{className:"w-4 h-4"}),tt.default.createElement("span",null,l.location)),tt.default.createElement("div",{className:"flex items-center gap-1"},tt.default.createElement(Za,{className:"w-4 h-4"}),tt.default.createElement("span",null,l.duration)),tt.default.createElement("div",{className:"flex items-center gap-1"},tt.default.createElement(Sa,{className:"w-4 h-4"}),tt.default.createElement("span",null,l.tuition)),tt.default.createElement("div",{className:"flex items-center gap-1"},tt.default.createElement(Ja,{className:"w-4 h-4"}),tt.default.createElement("span",null,l.matchScore,"% Match"))),tt.default.createElement("p",{className:"text-sm text-gray-600 mt-2"},l.details)),tt.default.createElement("div",{className:"flex flex-col items-end gap-2"},tt.default.createElement("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs",style:{backgroundColor:`rgba(52, 211, 153, ${l.matchScore/100})`,color:l.matchScore>70?"white":"black"}},l.matchScore,"% Match"),tt.default.createElement("button",{onClick:()=>i(l.id),className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-blue-600 hover:text-blue-800"},"Learn More \u2192")))))))}var tt,Cl=dt(()=>{"use strict";tt=We(ze());nr()});function Xt(r){let i,l=Array.isArray(r);if(r instanceof Date)i=new Date(r);else if(r instanceof Set)i=new Set(r);else if(!(_s&&(r instanceof Blob||r instanceof FileList))&&(l||gt(r)))if(i=l?[]:{},!l&&!pp(r))i=r;else for(let g in r)r.hasOwnProperty(g)&&(i[g]=Xt(r[g]));else return r;return i}function gp(r){let i=Wt.default.useRef(r);i.current=r,Wt.default.useEffect(()=>{let l=!r.disabled&&i.current.subject&&i.current.subject.subscribe({next:i.current.next});return()=>{l&&l.unsubscribe()}},[r.disabled])}function Rl(r,i,l="validate"){if(Lo(r)||Array.isArray(r)&&r.every(Lo)||oa(r)&&!r)return{type:l,message:Lo(r)?r:"",ref:i}}function yp(r,i){let l=i.slice(0,-1).length,g=0;for(;g<l;)r=mt(r)?g++:r[i[g++]];return r}function Ip(r){for(let i in r)if(r.hasOwnProperty(i)&&!mt(r[i]))return!1;return!0}function St(r,i){let l=Array.isArray(i)?i:Rs(i)?[i]:Ol(i),g=l.length===1?r:yp(r,l),L=l.length-1,x=l[L];return g&&delete g[x],L!==0&&(gt(g)&&Vt(g)||Array.isArray(g)&&Ip(g))&&St(r,l.slice(0,-1)),r}function ga(r,i){if(ws(r)||ws(i))return r===i;if(Ta(r)&&Ta(i))return r.getTime()===i.getTime();let l=Object.keys(r),g=Object.keys(i);if(l.length!==g.length)return!1;for(let L of l){let x=r[L];if(!g.includes(L))return!1;if(L!=="ref"){let R=i[L];if(Ta(x)&&Ta(R)||gt(x)&&gt(R)||Array.isArray(x)&&Array.isArray(R)?!ga(x,R):x!==R)return!1}}return!0}function So(r,i={}){let l=Array.isArray(r);if(gt(r)||l)for(let g in r)Array.isArray(r[g])||gt(r[g])&&!Ul(r[g])?(i[g]=Array.isArray(r[g])?[]:{},So(r[g],i[g])):Mt(r[g])||(i[g]=!0);return i}function Gl(r,i,l){let g=Array.isArray(r);if(gt(r)||g)for(let L in r)Array.isArray(r[L])||gt(r[L])&&!Ul(r[L])?mt(i)||ws(l[L])?l[L]=Array.isArray(r[L])?So(r[L],[]):{...So(r[L])}:Gl(r[L],Mt(i)?{}:i[L],l[L]):l[L]=!ga(r[L],i[L]);return l}function bs(r){let i=r.ref;if(!(r.refs?r.refs.every(l=>l.disabled):i.disabled))return Ds(i)?i.files:ks(i)?Bl(r.refs).value:Nl(i)?[...i.selectedOptions].map(({value:l})=>l):Br(i)?Ml(r.refs).value:Vl(mt(i.value)?r.ref.value:i.value,r)}function Pl(r,i,l){let g=me(r,l);if(g||Rs(l))return{error:g,name:l};let L=l.split(".");for(;L.length;){let x=L.join("."),R=me(i,x),c=me(r,x);if(R&&!Array.isArray(R)&&l!==x)return{name:l};if(c&&c.type)return{name:x,error:c};L.pop()}return{name:l}}function _p(r={}){let i={...wp,...r},l={submitCount:0,isDirty:!1,isLoading:sa(i.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:i.errors||{},disabled:i.disabled||!1},g={},L=gt(i.defaultValues)||gt(i.values)?Xt(i.defaultValues||i.values)||{}:{},x=i.shouldUnregister?{}:Xt(L),R={action:!1,mount:!1,watch:!1},c={mount:new Set,unMount:new Set,array:new Set,watch:new Set},p,O=0,A={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},E={values:As(),array:As(),state:As()},M=Al(i.mode),D=Al(i.reValidateMode),F=i.criteriaMode===ea.all,q=k=>H=>{clearTimeout(O),O=setTimeout(k,H)},G=async k=>{if(!i.disabled&&(A.isValid||k)){let H=i.resolver?Vt((await ne()).errors):await ce(g,!0);H!==l.isValid&&E.state.next({isValid:H})}},B=(k,H)=>{!i.disabled&&(A.isValidating||A.validatingFields)&&((k||Array.from(c.mount)).forEach(v=>{v&&(H?at(l.validatingFields,v,H):St(l.validatingFields,v))}),E.state.next({validatingFields:l.validatingFields,isValidating:!Vt(l.validatingFields)}))},U=(k,H=[],v,w,S=!0,f=!0)=>{if(w&&v&&!i.disabled){if(R.action=!0,f&&Array.isArray(me(g,k))){let y=v(me(g,k),w.argA,w.argB);S&&at(g,k,y)}if(f&&Array.isArray(me(l.errors,k))){let y=v(me(l.errors,k),w.argA,w.argB);S&&at(l.errors,k,y),bp(l.errors,k)}if(A.touchedFields&&f&&Array.isArray(me(l.touchedFields,k))){let y=v(me(l.touchedFields,k),w.argA,w.argB);S&&at(l.touchedFields,k,y)}A.dirtyFields&&(l.dirtyFields=Fr(L,x)),E.state.next({name:k,isDirty:de(k,H),dirtyFields:l.dirtyFields,errors:l.errors,isValid:l.isValid})}else at(x,k,H)},K=(k,H)=>{at(l.errors,k,H),E.state.next({errors:l.errors})},z=k=>{l.errors=k,E.state.next({errors:l.errors,isValid:!1})},$=(k,H,v,w)=>{let S=me(g,k);if(S){let f=me(x,k,mt(v)?me(L,k):v);mt(f)||w&&w.defaultChecked||H?at(x,k,H?f:bs(S._f)):Ie(k,f),R.mount&&G()}},ae=(k,H,v,w,S)=>{let f=!1,y=!1,C={name:k};if(!i.disabled){let _=!!(me(g,k)&&me(g,k)._f&&me(g,k)._f.disabled);if(!v||w){A.isDirty&&(y=l.isDirty,l.isDirty=C.isDirty=de(),f=y!==C.isDirty);let P=_||ga(me(L,k),H);y=!!(!_&&me(l.dirtyFields,k)),P||_?St(l.dirtyFields,k):at(l.dirtyFields,k,!0),C.dirtyFields=l.dirtyFields,f=f||A.dirtyFields&&y!==!P}if(v){let P=me(l.touchedFields,k);P||(at(l.touchedFields,k,v),C.touchedFields=l.touchedFields,f=f||A.touchedFields&&P!==v)}f&&S&&E.state.next(C)}return f?C:{}},ie=(k,H,v,w)=>{let S=me(l.errors,k),f=A.isValid&&oa(H)&&l.isValid!==H;if(r.delayError&&v?(p=q(()=>K(k,v)),p(r.delayError)):(clearTimeout(O),p=null,v?at(l.errors,k,v):St(l.errors,k)),(v?!ga(S,v):S)||!Vt(w)||f){let y={...w,...f&&oa(H)?{isValid:H}:{},errors:l.errors,name:k};l={...l,...y},E.state.next(y)}},ne=async k=>{B(k,!0);let H=await i.resolver(x,i.context,Cp(k||c.mount,g,i.criteriaMode,i.shouldUseNativeValidation));return B(k),H},le=async k=>{let{errors:H}=await ne(k);if(k)for(let v of k){let w=me(H,v);w?at(l.errors,v,w):St(l.errors,v)}else l.errors=H;return H},ce=async(k,H,v={valid:!0})=>{for(let w in k){let S=k[w];if(S){let{_f:f,...y}=S;if(f){let C=c.array.has(f.name),_=S._f&&Ep(S._f);_&&A.validatingFields&&B([w],!0);let P=await Dl(S,x,F,i.shouldUseNativeValidation&&!H,C);if(_&&A.validatingFields&&B([w]),P[f.name]&&(v.valid=!1,H))break;!H&&(me(P,f.name)?C?Lp(l.errors,P,f.name):at(l.errors,f.name,P[f.name]):St(l.errors,f.name))}!Vt(y)&&await ce(y,H,v)}}return v.valid},Oe=()=>{for(let k of c.unMount){let H=me(g,k);H&&(H._f.refs?H._f.refs.every(v=>!Ts(v)):!Ts(H._f.ref))&&De(k)}c.unMount=new Set},de=(k,H)=>!i.disabled&&(k&&H&&at(x,k,H),!ga(Ce(),L)),ue=(k,H,v)=>xp(k,c,{...R.mount?x:mt(H)?L:ia(k)?{[k]:H}:H},v,H),Te=k=>Co(me(R.mount?x:L,k,r.shouldUnregister?me(L,k,[]):[])),Ie=(k,H,v={})=>{let w=me(g,k),S=H;if(w){let f=w._f;f&&(!f.disabled&&at(x,k,Vl(H,f)),S=yo(f.ref)&&Mt(H)?"":H,Nl(f.ref)?[...f.ref.options].forEach(y=>y.selected=S.includes(y.value)):f.refs?Br(f.ref)?f.refs.length>1?f.refs.forEach(y=>(!y.defaultChecked||!y.disabled)&&(y.checked=Array.isArray(S)?!!S.find(C=>C===y.value):S===y.value)):f.refs[0]&&(f.refs[0].checked=!!S):f.refs.forEach(y=>y.checked=y.value===S):Ds(f.ref)?f.ref.value="":(f.ref.value=S,f.ref.type||E.values.next({name:k,values:{...x}})))}(v.shouldDirty||v.shouldTouch)&&ae(k,S,v.shouldTouch,v.shouldDirty,!0),v.shouldValidate&&qe(k)},Me=(k,H,v)=>{for(let w in H){let S=H[w],f=`${k}.${w}`,y=me(g,f);(c.array.has(k)||gt(S)||y&&!y._f)&&!Ta(S)?Me(f,S,v):Ie(f,S,v)}},ke=(k,H,v={})=>{let w=me(g,k),S=c.array.has(k),f=Xt(H);at(x,k,f),S?(E.array.next({name:k,values:{...x}}),(A.isDirty||A.dirtyFields)&&v.shouldDirty&&E.state.next({name:k,dirtyFields:Fr(L,x),isDirty:de(k,f)})):w&&!w._f&&!Mt(f)?Me(k,f,v):Ie(k,f,v),Tl(k,c)&&E.state.next({...l}),E.values.next({name:R.mount?k:void 0,values:{...x}})},Be=async k=>{R.mount=!0;let H=k.target,v=H.name,w=!0,S=me(g,v),f=()=>H.type?bs(S._f):dp(k),y=C=>{w=Number.isNaN(C)||Ta(C)&&isNaN(C.getTime())||ga(C,me(x,v,C))};if(S){let C,_,P=f(),V=k.type===El.BLUR||k.type===El.FOCUS_OUT,j=!Ap(S._f)&&!i.resolver&&!me(l.errors,v)&&!S._f.deps||Tp(V,me(l.touchedFields,v),l.isSubmitted,D,M),Y=Tl(v,c,V);at(x,v,P),V?(S._f.onBlur&&S._f.onBlur(k),p&&p(0)):S._f.onChange&&S._f.onChange(k);let Z=ae(v,P,V,!1),Q=!Vt(Z)||Y;if(!V&&E.values.next({name:v,type:k.type,values:{...x}}),j)return A.isValid&&(r.mode==="onBlur"?V&&G():G()),Q&&E.state.next({name:v,...Y?{}:Z});if(!V&&Y&&E.state.next({...l}),i.resolver){let{errors:J}=await ne([v]);if(y(P),w){let re=Pl(l.errors,g,v),se=Pl(J,g,re.name||v);C=se.error,v=se.name,_=Vt(J)}}else B([v],!0),C=(await Dl(S,x,F,i.shouldUseNativeValidation))[v],B([v]),y(P),w&&(C?_=!1:A.isValid&&(_=await ce(g,!0)));w&&(S._f.deps&&qe(S._f.deps),ie(v,_,C,Z))}},Fe=(k,H)=>{if(me(l.errors,H)&&k.focus)return k.focus(),1},qe=async(k,H={})=>{let v,w,S=vo(k);if(i.resolver){let f=await le(mt(k)?k:S);v=Vt(f),w=k?!S.some(y=>me(f,y)):v}else k?(w=(await Promise.all(S.map(async f=>{let y=me(g,f);return await ce(y&&y._f?{[f]:y}:y)}))).every(Boolean),!(!w&&!l.isValid)&&G()):w=v=await ce(g);return E.state.next({...!ia(k)||A.isValid&&v!==l.isValid?{}:{name:k},...i.resolver||!k?{isValid:v}:{},errors:l.errors}),H.shouldFocus&&!w&&Mr(g,Fe,k?S:c.mount),w},Ce=k=>{let H={...R.mount?x:L};return mt(k)?H:ia(k)?me(H,k):k.map(v=>me(H,v))},Je=(k,H)=>({invalid:!!me((H||l).errors,k),isDirty:!!me((H||l).dirtyFields,k),error:me((H||l).errors,k),isValidating:!!me(l.validatingFields,k),isTouched:!!me((H||l).touchedFields,k)}),je=k=>{k&&vo(k).forEach(H=>St(l.errors,H)),E.state.next({errors:k?l.errors:{}})},Pt=(k,H,v)=>{let w=(me(g,k,{_f:{}})._f||{}).ref,S=me(l.errors,k)||{},{ref:f,message:y,type:C,..._}=S;at(l.errors,k,{..._,...H,ref:w}),E.state.next({name:k,errors:l.errors,isValid:!1}),v&&v.shouldFocus&&w&&w.focus&&w.focus()},rt=(k,H)=>sa(k)?E.values.subscribe({next:v=>k(ue(void 0,H),v)}):ue(k,H,!0),De=(k,H={})=>{for(let v of k?vo(k):c.mount)c.mount.delete(v),c.array.delete(v),H.keepValue||(St(g,v),St(x,v)),!H.keepError&&St(l.errors,v),!H.keepDirty&&St(l.dirtyFields,v),!H.keepTouched&&St(l.touchedFields,v),!H.keepIsValidating&&St(l.validatingFields,v),!i.shouldUnregister&&!H.keepDefaultValue&&St(L,v);E.values.next({values:{...x}}),E.state.next({...l,...H.keepDirty?{isDirty:de()}:{}}),!H.keepIsValid&&G()},ot=({disabled:k,name:H,field:v,fields:w,value:S})=>{if(oa(k)&&R.mount||k){let f=k?void 0:mt(S)?bs(v?v._f:me(w,H)._f):S;at(x,H,f),ae(H,f,!1,!1,!0)}},nt=(k,H={})=>{let v=me(g,k),w=oa(H.disabled)||oa(i.disabled);return at(g,k,{...v||{},_f:{...v&&v._f?v._f:{ref:{name:k}},name:k,mount:!0,...H}}),c.mount.add(k),v?ot({field:v,disabled:oa(H.disabled)?H.disabled:i.disabled,name:k,value:H.value}):$(k,!0,H.value),{...w?{disabled:H.disabled||i.disabled}:{},...i.progressive?{required:!!H.required,min:Or(H.min),max:Or(H.max),minLength:Or(H.minLength),maxLength:Or(H.maxLength),pattern:Or(H.pattern)}:{},name:k,onChange:Be,onBlur:Be,ref:S=>{if(S){nt(k,H),v=me(g,k);let f=mt(S.value)&&S.querySelectorAll&&S.querySelectorAll("input,select,textarea")[0]||S,y=Sp(f),C=v._f.refs||[];if(y?C.find(_=>_===f):f===v._f.ref)return;at(g,k,{_f:{...v._f,...y?{refs:[...C.filter(Ts),f,...Array.isArray(me(L,k))?[{}]:[]],ref:{type:f.type,name:k}}:{ref:f}}}),$(k,!1,void 0,f)}else v=me(g,k,{}),v._f&&(v._f.mount=!1),(i.shouldUnregister||H.shouldUnregister)&&!(cp(c.array,k)&&R.action)&&c.unMount.add(k)}}},xt=()=>i.shouldFocusError&&Mr(g,Fe,c.mount),_e=k=>{oa(k)&&(E.state.next({disabled:k}),Mr(g,(H,v)=>{let w=me(g,v);w&&(H.disabled=w._f.disabled||k,Array.isArray(w._f.refs)&&w._f.refs.forEach(S=>{S.disabled=w._f.disabled||k}))},0,!1))},Qe=(k,H)=>async v=>{let w;if(v&&(v.preventDefault&&v.preventDefault(),v.persist&&v.persist()),i.disabled){H&&await H({...l.errors},v);return}let S=Xt(x);if(E.state.next({isSubmitting:!0}),i.resolver){let{errors:f,values:y}=await ne();l.errors=f,S=y}else await ce(g);if(St(l.errors,"root"),Vt(l.errors)){E.state.next({errors:{}});try{await k(S,v)}catch(f){w=f}}else H&&await H({...l.errors},v),xt(),setTimeout(xt);if(E.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Vt(l.errors)&&!w,submitCount:l.submitCount+1,errors:l.errors}),w)throw w},ge=(k,H={})=>{me(g,k)&&(mt(H.defaultValue)?ke(k,Xt(me(L,k))):(ke(k,H.defaultValue),at(L,k,Xt(H.defaultValue))),H.keepTouched||St(l.touchedFields,k),H.keepDirty||(St(l.dirtyFields,k),l.isDirty=H.defaultValue?de(k,Xt(me(L,k))):de()),H.keepError||(St(l.errors,k),A.isValid&&G()),E.state.next({...l}))},Se=(k,H={})=>{let v=k?Xt(k):L,w=Xt(v),S=Vt(k),f=S?L:w;if(H.keepDefaultValues||(L=v),!H.keepValues){if(H.keepDirtyValues){let y=new Set([...c.mount,...Object.keys(Fr(L,x))]);for(let C of Array.from(y))me(l.dirtyFields,C)?at(f,C,me(x,C)):ke(C,me(f,C))}else{if(_s&&mt(k))for(let y of c.mount){let C=me(g,y);if(C&&C._f){let _=Array.isArray(C._f.refs)?C._f.refs[0]:C._f.ref;if(yo(_)){let P=_.closest("form");if(P){P.reset();break}}}}g={}}x=r.shouldUnregister?H.keepDefaultValues?Xt(L):{}:Xt(f),E.array.next({values:{...f}}),E.values.next({values:{...f}})}c={mount:H.keepDirtyValues?c.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},R.mount=!A.isValid||!!H.keepIsValid||!!H.keepDirtyValues,R.watch=!!r.shouldUnregister,E.state.next({submitCount:H.keepSubmitCount?l.submitCount:0,isDirty:S?!1:H.keepDirty?l.isDirty:!!(H.keepDefaultValues&&!ga(k,L)),isSubmitted:H.keepIsSubmitted?l.isSubmitted:!1,dirtyFields:S?{}:H.keepDirtyValues?H.keepDefaultValues&&x?Fr(L,x):l.dirtyFields:H.keepDefaultValues&&k?Fr(L,k):H.keepDirty?l.dirtyFields:{},touchedFields:H.keepTouched?l.touchedFields:{},errors:H.keepErrors?l.errors:{},isSubmitSuccessful:H.keepIsSubmitSuccessful?l.isSubmitSuccessful:!1,isSubmitting:!1})},ve=(k,H)=>Se(sa(k)?k(x):k,H);return{control:{register:nt,unregister:De,getFieldState:Je,handleSubmit:Qe,setError:Pt,_executeSchema:ne,_getWatch:ue,_getDirty:de,_updateValid:G,_removeUnmounted:Oe,_updateFieldArray:U,_updateDisabledField:ot,_getFieldArray:Te,_reset:Se,_resetDefaultValues:()=>sa(i.defaultValues)&&i.defaultValues().then(k=>{ve(k,i.resetOptions),E.state.next({isLoading:!1})}),_updateFormState:k=>{l={...l,...k}},_disableForm:_e,_subjects:E,_proxyFormState:A,_setErrors:z,get _fields(){return g},get _formValues(){return x},get _state(){return R},set _state(k){R=k},get _defaultValues(){return L},get _names(){return c},set _names(k){c=k},get _formState(){return l},set _formState(k){l=k},get _options(){return i},set _options(k){i={...i,...k}}},trigger:qe,register:nt,handleSubmit:Qe,watch:rt,setValue:ke,getValues:Ce,reset:ve,resetField:ge,clearErrors:je,unregister:De,setError:Pt,setFocus:(k,H={})=>{let v=me(g,k),w=v&&v._f;if(w){let S=w.refs?w.refs[0]:w.ref;S.focus&&(S.focus(),H.shouldSelect&&sa(S.select)&&S.select())}},getFieldState:Je}}function Eo(r={}){let i=Wt.default.useRef(),l=Wt.default.useRef(),[g,L]=Wt.default.useState({isDirty:!1,isValidating:!1,isLoading:sa(r.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:r.errors||{},disabled:r.disabled||!1,defaultValues:sa(r.defaultValues)?void 0:r.defaultValues});i.current||(i.current={..._p(r),formState:g});let x=i.current.control;return x._options=r,gp({subject:x._subjects.state,next:R=>{mp(R,x._proxyFormState,x._updateFormState,!0)&&L({...x._formState})}}),Wt.default.useEffect(()=>x._disableForm(r.disabled),[x,r.disabled]),Wt.default.useEffect(()=>{if(x._proxyFormState.isDirty){let R=x._getDirty();R!==g.isDirty&&x._subjects.state.next({isDirty:R})}},[x,g.isDirty]),Wt.default.useEffect(()=>{r.values&&!ga(r.values,l.current)?(x._reset(r.values,x._options.resetOptions),l.current=r.values,L(R=>({...R}))):x._resetDefaultValues()},[r.values,x]),Wt.default.useEffect(()=>{r.errors&&x._setErrors(r.errors)},[r.errors,x]),Wt.default.useEffect(()=>{x._state.mount||(x._updateValid(),x._state.mount=!0),x._state.watch&&(x._state.watch=!1,x._subjects.state.next({...x._formState})),x._removeUnmounted()}),Wt.default.useEffect(()=>{r.shouldUnregister&&x._subjects.values.next({values:x._getWatch()})},[r.shouldUnregister,x]),i.current.formState=hp(g,x),i.current}var Wt,Br,Ta,Mt,Fl,gt,dp,fp,cp,pp,_s,Co,mt,me,oa,Rs,Ol,at,El,ea,pa,Rv,hp,Vt,mp,vo,ia,xp,vp,Al,Tl,Mr,Lp,Ds,sa,yo,Lo,ks,Io,bl,wl,Ml,_l,Bl,Ga,Dl,As,ws,Nl,Sp,Ts,Ul,Fr,Vl,Cp,Or,kl,Ep,Ap,Tp,bp,wp,Ps=dt(()=>{Wt=We(ze(),1),Br=r=>r.type==="checkbox",Ta=r=>r instanceof Date,Mt=r=>r==null,Fl=r=>typeof r=="object",gt=r=>!Mt(r)&&!Array.isArray(r)&&Fl(r)&&!Ta(r),dp=r=>gt(r)&&r.target?Br(r.target)?r.target.checked:r.target.value:r,fp=r=>r.substring(0,r.search(/\.\d+(\.|$)/))||r,cp=(r,i)=>r.has(fp(i)),pp=r=>{let i=r.constructor&&r.constructor.prototype;return gt(i)&&i.hasOwnProperty("isPrototypeOf")},_s=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";Co=r=>Array.isArray(r)?r.filter(Boolean):[],mt=r=>r===void 0,me=(r,i,l)=>{if(!i||!gt(r))return l;let g=Co(i.split(/[,[\].]+?/)).reduce((L,x)=>Mt(L)?L:L[x],r);return mt(g)||g===r?mt(r[i])?l:r[i]:g},oa=r=>typeof r=="boolean",Rs=r=>/^\w*$/.test(r),Ol=r=>Co(r.replace(/["|']|\]/g,"").split(/\.|\[/)),at=(r,i,l)=>{let g=-1,L=Rs(i)?[i]:Ol(i),x=L.length,R=x-1;for(;++g<x;){let c=L[g],p=l;if(g!==R){let O=r[c];p=gt(O)||Array.isArray(O)?O:isNaN(+L[g+1])?{}:[]}if(c==="__proto__")return;r[c]=p,r=r[c]}return r},El={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},ea={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},pa={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},Rv=Wt.default.createContext(null),hp=(r,i,l,g=!0)=>{let L={defaultValues:i._defaultValues};for(let x in r)Object.defineProperty(L,x,{get:()=>{let R=x;return i._proxyFormState[R]!==ea.all&&(i._proxyFormState[R]=!g||ea.all),l&&(l[R]=!0),r[R]}});return L},Vt=r=>gt(r)&&!Object.keys(r).length,mp=(r,i,l,g)=>{l(r);let{name:L,...x}=r;return Vt(x)||Object.keys(x).length>=Object.keys(i).length||Object.keys(x).find(R=>i[R]===(!g||ea.all))},vo=r=>Array.isArray(r)?r:[r];ia=r=>typeof r=="string",xp=(r,i,l,g,L)=>ia(r)?(g&&i.watch.add(r),me(l,r,L)):Array.isArray(r)?r.map(x=>(g&&i.watch.add(x),me(l,x))):(g&&(i.watchAll=!0),l),vp=(r,i,l,g,L)=>i?{...l[r],types:{...l[r]&&l[r].types?l[r].types:{},[g]:L||!0}}:{},Al=r=>({isOnSubmit:!r||r===ea.onSubmit,isOnBlur:r===ea.onBlur,isOnChange:r===ea.onChange,isOnAll:r===ea.all,isOnTouch:r===ea.onTouched}),Tl=(r,i,l)=>!l&&(i.watchAll||i.watch.has(r)||[...i.watch].some(g=>r.startsWith(g)&&/^\.\w+/.test(r.slice(g.length)))),Mr=(r,i,l,g)=>{for(let L of l||Object.keys(r)){let x=me(r,L);if(x){let{_f:R,...c}=x;if(R){if(R.refs&&R.refs[0]&&i(R.refs[0],L)&&!g)return!0;if(R.ref&&i(R.ref,R.name)&&!g)return!0;if(Mr(c,i))break}else if(gt(c)&&Mr(c,i))break}}},Lp=(r,i,l)=>{let g=vo(me(r,l));return at(g,"root",i[l]),at(r,l,g),r},Ds=r=>r.type==="file",sa=r=>typeof r=="function",yo=r=>{if(!_s)return!1;let i=r?r.ownerDocument:0;return r instanceof(i&&i.defaultView?i.defaultView.HTMLElement:HTMLElement)},Lo=r=>ia(r),ks=r=>r.type==="radio",Io=r=>r instanceof RegExp,bl={value:!1,isValid:!1},wl={value:!0,isValid:!0},Ml=r=>{if(Array.isArray(r)){if(r.length>1){let i=r.filter(l=>l&&l.checked&&!l.disabled).map(l=>l.value);return{value:i,isValid:!!i.length}}return r[0].checked&&!r[0].disabled?r[0].attributes&&!mt(r[0].attributes.value)?mt(r[0].value)||r[0].value===""?wl:{value:r[0].value,isValid:!0}:wl:bl}return bl},_l={isValid:!1,value:null},Bl=r=>Array.isArray(r)?r.reduce((i,l)=>l&&l.checked&&!l.disabled?{isValid:!0,value:l.value}:i,_l):_l;Ga=r=>gt(r)&&!Io(r)?r:{value:r,message:""},Dl=async(r,i,l,g,L)=>{let{ref:x,refs:R,required:c,maxLength:p,minLength:O,min:A,max:E,pattern:M,validate:D,name:F,valueAsNumber:q,mount:G,disabled:B}=r._f,U=me(i,F);if(!G||B)return{};let K=R?R[0]:x,z=de=>{g&&K.reportValidity&&(K.setCustomValidity(oa(de)?"":de||""),K.reportValidity())},$={},ae=ks(x),ie=Br(x),ne=ae||ie,le=(q||Ds(x))&&mt(x.value)&&mt(U)||yo(x)&&x.value===""||U===""||Array.isArray(U)&&!U.length,ce=vp.bind(null,F,l,$),Oe=(de,ue,Te,Ie=pa.maxLength,Me=pa.minLength)=>{let ke=de?ue:Te;$[F]={type:de?Ie:Me,message:ke,ref:x,...ce(de?Ie:Me,ke)}};if(L?!Array.isArray(U)||!U.length:c&&(!ne&&(le||Mt(U))||oa(U)&&!U||ie&&!Ml(R).isValid||ae&&!Bl(R).isValid)){let{value:de,message:ue}=Lo(c)?{value:!!c,message:c}:Ga(c);if(de&&($[F]={type:pa.required,message:ue,ref:K,...ce(pa.required,ue)},!l))return z(ue),$}if(!le&&(!Mt(A)||!Mt(E))){let de,ue,Te=Ga(E),Ie=Ga(A);if(!Mt(U)&&!isNaN(U)){let Me=x.valueAsNumber||U&&+U;Mt(Te.value)||(de=Me>Te.value),Mt(Ie.value)||(ue=Me<Ie.value)}else{let Me=x.valueAsDate||new Date(U),ke=qe=>new Date(new Date().toDateString()+" "+qe),Be=x.type=="time",Fe=x.type=="week";ia(Te.value)&&U&&(de=Be?ke(U)>ke(Te.value):Fe?U>Te.value:Me>new Date(Te.value)),ia(Ie.value)&&U&&(ue=Be?ke(U)<ke(Ie.value):Fe?U<Ie.value:Me<new Date(Ie.value))}if((de||ue)&&(Oe(!!de,Te.message,Ie.message,pa.max,pa.min),!l))return z($[F].message),$}if((p||O)&&!le&&(ia(U)||L&&Array.isArray(U))){let de=Ga(p),ue=Ga(O),Te=!Mt(de.value)&&U.length>+de.value,Ie=!Mt(ue.value)&&U.length<+ue.value;if((Te||Ie)&&(Oe(Te,de.message,ue.message),!l))return z($[F].message),$}if(M&&!le&&ia(U)){let{value:de,message:ue}=Ga(M);if(Io(de)&&!U.match(de)&&($[F]={type:pa.pattern,message:ue,ref:x,...ce(pa.pattern,ue)},!l))return z(ue),$}if(D){if(sa(D)){let de=await D(U,i),ue=Rl(de,K);if(ue&&($[F]={...ue,...ce(pa.validate,ue.message)},!l))return z(ue.message),$}else if(gt(D)){let de={};for(let ue in D){if(!Vt(de)&&!l)break;let Te=Rl(await D[ue](U,i),K,ue);Te&&(de={...Te,...ce(ue,Te.message)},z(Te.message),l&&($[F]=de))}if(!Vt(de)&&($[F]={ref:K,...de},!l))return $}}return z(!0),$};As=()=>{let r=[];return{get observers(){return r},next:L=>{for(let x of r)x.next&&x.next(L)},subscribe:L=>(r.push(L),{unsubscribe:()=>{r=r.filter(x=>x!==L)}}),unsubscribe:()=>{r=[]}}},ws=r=>Mt(r)||!Fl(r);Nl=r=>r.type==="select-multiple",Sp=r=>ks(r)||Br(r),Ts=r=>yo(r)&&r.isConnected,Ul=r=>{for(let i in r)if(sa(r[i]))return!0;return!1};Fr=(r,i)=>Gl(r,i,So(i)),Vl=(r,{valueAsNumber:i,valueAsDate:l,setValueAs:g})=>mt(r)?r:i?r===""?NaN:r&&+r:l&&ia(r)?new Date(r):g?g(r):r;Cp=(r,i,l,g)=>{let L={};for(let x of r){let R=me(i,x);R&&at(L,x,R._f)}return{criteriaMode:l,names:[...r],fields:L,shouldUseNativeValidation:g}},Or=r=>mt(r)?r:Io(r)?r.source:gt(r)?Io(r.value)?r.value.source:r.value:r,kl="AsyncFunction",Ep=r=>(!r||!r.validate)&&!!(sa(r.validate)&&r.validate.constructor.name===kl||gt(r.validate)&&Object.values(r.validate).find(i=>i.constructor.name===kl)),Ap=r=>r.mount&&(r.required||r.min||r.max||r.maxLength||r.minLength||r.pattern||r.validate);Tp=(r,i,l,g,L)=>L.isOnAll?!1:!l&&L.isOnTouch?!(i||r):(l?g.isOnBlur:L.isOnBlur)?!r:(l?g.isOnChange:L.isOnChange)?r:!0,bp=(r,i)=>!Co(me(r,i)).length&&St(r,i),wp={mode:ea.onSubmit,reValidateMode:ea.onChange,shouldFocusError:!0}});var Hl={};Mo(Hl,{default:()=>ql});function ql({fields:r,onSubmit:i}){let{register:l,handleSubmit:g,formState:{errors:L,isSubmitting:x}}=Eo(),R=c=>{switch(c){case"text":return Dt.default.createElement(sr,{className:"w-5 h-5 text-gray-500"});case"email":return Dt.default.createElement(er,{className:"w-5 h-5 text-gray-500"});case"tel":return Dt.default.createElement(or,{className:"w-5 h-5 text-gray-500"});case"date":return Dt.default.createElement($a,{className:"w-5 h-5 text-gray-500"});default:return null}};return Dt.default.createElement("div",{className:"w-full max-w-md p-6 bg-white rounded-lg shadow-sm border"},Dt.default.createElement("h3",{className:"text-lg font-semibold mb-4"},"Contact Information"),Dt.default.createElement("p",{className:"text-sm text-gray-600 mb-6"},"Please provide your contact details and we'll have a counselor reach out to you shortly."),Dt.default.createElement("form",{onSubmit:g(i),className:"space-y-4"},r.map(c=>Dt.default.createElement("div",{key:c.id},Dt.default.createElement("label",{htmlFor:c.id,className:"block text-sm font-medium text-gray-700 mb-1"},c.label),Dt.default.createElement("div",{className:"relative"},Dt.default.createElement("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},R(c.type)),Dt.default.createElement("input",{...l(c.id,{required:c.required}),type:c.type,id:c.id,className:`block w-full pl-10 pr-3 py-2 rounded-md border ${L[c.id]?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`,placeholder:`Enter your ${c.label.toLowerCase()}`})),L[c.id]&&Dt.default.createElement("p",{className:"mt-1 text-sm text-red-600"},c.label," is required"))),Dt.default.createElement("div",{className:"flex justify-end"},Dt.default.createElement("button",{type:"submit",disabled:x,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},x?"Submitting...":"Request Callback"))))}var Dt,Kl=dt(()=>{"use strict";Dt=We(ze());Ps();nr()});var jl={};Mo(jl,{default:()=>Wl});function Wl({fields:r,onSubmit:i}){let{register:l,handleSubmit:g,formState:{errors:L,isSubmitting:x}}=Eo(),R=p=>{switch(p){case"education":return Ct.default.createElement(Ya,{className:"w-5 h-5 text-gray-500"});case"countries":return Ct.default.createElement(Qa,{className:"w-5 h-5 text-gray-500"});case"budget":return Ct.default.createElement(Sa,{className:"w-5 h-5 text-gray-500"});default:return null}},c=p=>{switch(p.type){case"multiselect":return Ct.default.createElement("select",{multiple:!0,...l(p.id),className:"block w-full pl-10 pr-3 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"},p.options?.map(O=>Ct.default.createElement("option",{key:O,value:O},O)));case"number":return Ct.default.createElement("input",{type:"number",...l(p.id,{required:p.required}),className:"block w-full pl-10 pr-3 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Enter your ${p.label.toLowerCase()}`});default:return Ct.default.createElement("input",{type:p.type,...l(p.id,{required:p.required}),className:"block w-full pl-10 pr-3 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Enter your ${p.label.toLowerCase()}`})}};return Ct.default.createElement("div",{className:"w-full max-w-md p-6 bg-white rounded-lg shadow-sm border"},Ct.default.createElement("h3",{className:"text-lg font-semibold mb-4"},"Your Study Preferences"),Ct.default.createElement("p",{className:"text-sm text-gray-600 mb-6"},"Help us understand your preferences to recommend the best programs for you."),Ct.default.createElement("form",{onSubmit:g(i),className:"space-y-4"},r.map(p=>Ct.default.createElement("div",{key:p.id},Ct.default.createElement("label",{htmlFor:p.id,className:"block text-sm font-medium text-gray-700 mb-1"},p.label),Ct.default.createElement("div",{className:"relative"},Ct.default.createElement("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},R(p.id)),c(p)),L[p.id]&&Ct.default.createElement("p",{className:"mt-1 text-sm text-red-600"},p.label," is required"))),Ct.default.createElement("div",{className:"flex justify-end"},Ct.default.createElement("button",{type:"submit",disabled:x,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},x?"Submitting...":"Get Recommendations"))))}var Ct,zl=dt(()=>{"use strict";Ct=We(ze());Ps();nr()});var Ee=We(ze());nr();var Gt=We(ze());function Hi({messages:r,onFinish:i,input:l,isLoading:g,handleInputChange:L,handleSubmit:x}){return Gt.default.createElement("div",{className:"flex flex-col h-full"},Gt.default.createElement("div",{className:"flex-1 overflow-y-auto p-4 space-y-4"},r.map(R=>Gt.default.createElement("div",{key:R.id,className:"message-container"},Gt.default.createElement("div",{className:`flex ${R.role==="user"?"justify-end":"justify-start"}`},Gt.default.createElement("div",{className:"space-y-2"},Gt.default.createElement("div",{className:`max-w-[80%] rounded-lg p-3 ${R.role==="user"?"bg-blue-500 text-white":"bg-gray-100"}`},R.content))))),g&&Gt.default.createElement("div",{className:"flex justify-start"},Gt.default.createElement("div",{className:"bg-gray-100 rounded-lg p-3"},Gt.default.createElement("div",{className:"animate-pulse"},"Processing...")))),Gt.default.createElement("div",{className:"border-t p-4"},Gt.default.createElement("form",{onSubmit:x,className:"flex space-x-4"},Gt.default.createElement("input",{value:l,onChange:L,placeholder:"Type your message...",className:"flex-1 rounded-lg border p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"}),Gt.default.createElement("button",{type:"submit",disabled:g,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50"},"Send"))))}var Wo=We(ze());var Fa=We(ze()),fa=We(Ki()),ur=function(){return ur=Object.assign||function(r){for(var i,l=1,g=arguments.length;l<g;l++){i=arguments[l];for(var L in i)Object.prototype.hasOwnProperty.call(i,L)&&(r[L]=i[L])}return r},ur.apply(this,arguments)},Vd=function(r,i){var l={};for(var g in r)Object.prototype.hasOwnProperty.call(r,g)&&i.indexOf(g)<0&&(l[g]=r[g]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,g=Object.getOwnPropertySymbols(r);L<g.length;L++)i.indexOf(g[L])<0&&Object.prototype.propertyIsEnumerable.call(r,g[L])&&(l[g[L]]=r[g[L]]);return l};function qd(r){var i=r.hlsConfig,l=r.playerRef,g=l===void 0?Fa.default.createRef():l,L=r.src,x=r.autoPlay,R=Vd(r,["hlsConfig","playerRef","src","autoPlay"]);return(0,Fa.useEffect)(function(){var c;function p(){c?.destroy();var O=new fa.default(ur({enableWorker:!1},i));g.current!=null&&O.attachMedia(g.current),O.on(fa.default.Events.MEDIA_ATTACHED,function(){O.loadSource(L),O.on(fa.default.Events.MANIFEST_PARSED,function(){var A;x&&((A=g?.current)===null||A===void 0||A.play().catch(function(){return console.log("Unable to autoplay prior to user interaction with the dom.")}))})}),O.on(fa.default.Events.ERROR,function(A,E){if(E.fatal)switch(E.type){case fa.default.ErrorTypes.NETWORK_ERROR:O.startLoad();break;case fa.default.ErrorTypes.MEDIA_ERROR:O.recoverMediaError();break;default:p();break}}),c=O}return fa.default.isSupported()&&p(),function(){c?.destroy()}},[x,i,g,L]),fa.default.isSupported()?Fa.default.createElement("video",ur({ref:g},R)):Fa.default.createElement("video",ur({ref:g,src:L,autoPlay:x},R))}var Wi=qd;function ji({hlsUrl:r,mp4Url:i}){let l=Wo.default.useRef(null);return Wo.default.createElement(Wi,{src:r,playerRef:l,autoPlay:!1,controls:!0,width:"100%",height:"auto",className:"w-full rounded-lg",style:{maxWidth:"320px"}})}var zo=class{constructor(i,l="http://localhost:3000"){Bo(this,"apiKey");Bo(this,"baseUrl");this.apiKey=i,this.baseUrl=l}async request(i,l={}){try{let g=await fetch(`${this.baseUrl}${i}`,{...l,headers:{"Content-Type":"application/json","X-API-Key":this.apiKey,...l.headers}}),L=await g.json();if(!g.ok)throw{code:L.error?.code||"UNKNOWN_ERROR",message:L.error?.message||"An unknown error occurred"};return{data:L}}catch(g){return console.error("API Request Error:",g),{error:{code:g.code||"REQUEST_FAILED",message:g.message||"Failed to complete the request"}}}}async initializeChat(i={}){return this.request("/api/v1/sdk/chat/init",{method:"POST",body:JSON.stringify({programId:i.programId,metadata:i.metadata,domain:window.location.hostname})})}async sendMessage(i,l,g){let L=await this.request("/api/v1/sdk/chat/message",{method:"POST",body:JSON.stringify({sessionId:i,message:l,metadata:g})});if(L.error)throw new Error(L.error.message);if(!L.data)throw new Error("No data received from server");return L.data}async endSession(i){return this.request(`/api/v1/sdk/chat/${i}/end`,{method:"POST"})}async saveSessionState(i){return this.request(`/api/v1/sdk/chat/${i}/state`,{method:"POST",body:JSON.stringify({sessionId:i,lastActive:new Date().toISOString()})})}async validateSession(i){return this.request(`/api/v1/sdk/chat/${i}/validate`,{method:"GET"})}async getSessionHistory(i,l=50,g){let L=new URLSearchParams({limit:l.toString(),...g&&{before:g}});return this.request(`/api/v1/sdk/chat/${i}/history?${L}`,{method:"GET"})}async getOrgSettings(i){return this.request("/api/v1/sdk/org-settings",{method:"GET",headers:{"X-API-Key":i}})}async*streamChat(i,l,g,L){try{let x=await fetch(`${this.baseUrl}/api/v1/sdk/chat/stream`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.apiKey},body:JSON.stringify({message:i,sessionId:l,previousMessages:g,metadata:L})});if(!x.ok)throw new Error("Stream request failed");let R=x.body?.getReader();if(!R)throw new Error("No reader available");let c=new TextDecoder,p="";for(;;){let{done:O,value:A}=await R.read();if(O)break;p+=c.decode(A,{stream:!0});let E=p.split(`
`);p=E.pop()||"";for(let M of E)if(M.trim())try{yield JSON.parse(M)}catch(D){console.error("Error parsing SSE data:",D)}}}catch(x){throw console.error("Stream error:",x),x}}},jo=null,zi=(r,i)=>(jo||(jo=new zo(r,i)),jo);var Xi=We(ze()),Yi=({streamingData:r,setUIComponent:i,setVideoComponent:l})=>((0,Xi.useEffect)(()=>{if(!r?.length)return;let g=r[r.length-1];console.log("lastData",g),typeof g=="object"&&g!==null&&"type"in g&&"content"in g&&(g.type==="ui"?i({type:g.content.type,data:g.content,messageId:g.messageId,isVisible:!0}):g.type==="videoUrls"&&l({type:"videoUrls",data:g.content,messageId:g.messageId,isVisible:!0}))},[r,i]),null);var $i="vercel.ai.error",Hd=Symbol.for($i),Zi,Kd=class Ji extends Error{constructor({name:i,message:l,cause:g}){super(l),this[Zi]=!0,this.name=i,this.cause=g}static isInstance(i){return Ji.hasMarker(i,$i)}static hasMarker(i,l){let g=Symbol.for(l);return i!=null&&typeof i=="object"&&g in i&&typeof i[g]=="boolean"&&i[g]===!0}};Zi=Hd;var Oa=Kd,Wd="AI_APICallError",jd=`vercel.ai.error.${Wd}`,zd=Symbol.for(jd),Xd;Xd=zd;var Yd="AI_EmptyResponseBodyError",$d=`vercel.ai.error.${Yd}`,Zd=Symbol.for($d),Jd;Jd=Zd;function Qi(r){return r==null?"unknown error":typeof r=="string"?r:r instanceof Error?r.message:JSON.stringify(r)}var en="AI_InvalidArgumentError",tn=`vercel.ai.error.${en}`,Qd=Symbol.for(tn),an,rn=class extends Oa{constructor({message:r,cause:i,argument:l}){super({name:en,message:r,cause:i}),this[an]=!0,this.argument=l}static isInstance(r){return Oa.hasMarker(r,tn)}};an=Qd;var ef="AI_InvalidPromptError",tf=`vercel.ai.error.${ef}`,af=Symbol.for(tf),rf;rf=af;var of="AI_InvalidResponseDataError",sf=`vercel.ai.error.${of}`,nf=Symbol.for(sf),lf;lf=nf;var on="AI_JSONParseError",sn=`vercel.ai.error.${on}`,uf=Symbol.for(sn),nn,Yo=class extends Oa{constructor({text:r,cause:i}){super({name:on,message:`JSON parsing failed: Text: ${r}.
Error message: ${Qi(i)}`,cause:i}),this[nn]=!0,this.text=r}static isInstance(r){return Oa.hasMarker(r,sn)}};nn=uf;var df="AI_LoadAPIKeyError",ff=`vercel.ai.error.${df}`,cf=Symbol.for(ff),pf;pf=cf;var hf="AI_LoadSettingError",mf=`vercel.ai.error.${hf}`,gf=Symbol.for(mf),xf;xf=gf;var vf="AI_NoContentGeneratedError",Lf=`vercel.ai.error.${vf}`,yf=Symbol.for(Lf),If;If=yf;var Sf="AI_NoSuchModelError",Cf=`vercel.ai.error.${Sf}`,Ef=Symbol.for(Cf),Af;Af=Ef;var Tf="AI_TooManyEmbeddingValuesForCallError",bf=`vercel.ai.error.${Tf}`,wf=Symbol.for(bf),_f;_f=wf;var ln="AI_TypeValidationError",un=`vercel.ai.error.${ln}`,Rf=Symbol.for(un),dn,Df=class Xo extends Oa{constructor({value:i,cause:l}){super({name:ln,message:`Type validation failed: Value: ${JSON.stringify(i)}.
Error message: ${Qi(l)}`,cause:l}),this[dn]=!0,this.value=i}static isInstance(i){return Oa.hasMarker(i,un)}static wrap({value:i,cause:l}){return Xo.isInstance(l)&&l.value===i?l:new Xo({value:i,cause:l})}};dn=Rf;var to=Df,kf="AI_UnsupportedFunctionalityError",Pf=`vercel.ai.error.${kf}`,Ff=Symbol.for(Pf),Of;Of=Ff;var fn=(r,i=21)=>(l=i)=>{let g="",L=l|0;for(;L--;)g+=r[Math.random()*r.length|0];return g};var xn=We(gn(),1);var Nf=({prefix:r,size:i=16,alphabet:l="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:g="-"}={})=>{let L=fn(l,i);if(r==null)return L;if(l.includes(g))throw new rn({argument:"separator",message:`The separator "${g}" must not be part of the alphabet "${l}".`});return x=>`${r}${g}${L(x)}`},dr=Nf();var Zo=Symbol.for("vercel.ai.validator");function Uf(r){return{[Zo]:!0,validate:r}}function Gf(r){return typeof r=="object"&&r!==null&&Zo in r&&r[Zo]===!0&&"validate"in r}function Vf(r){return Gf(r)?r:qf(r)}function qf(r){return Uf(i=>{let l=r.safeParse(i);return l.success?{success:!0,value:l.data}:{success:!1,error:l.error}})}function Hf({value:r,schema:i}){let l=Vf(i);try{if(l.validate==null)return{success:!0,value:r};let g=l.validate(r);return g.success?g:{success:!1,error:to.wrap({value:r,cause:g.error})}}catch(g){return{success:!1,error:to.wrap({value:r,cause:g})}}}function Jo({text:r,schema:i}){try{let l=xn.default.parse(r);return i==null?{success:!0,value:l}:Hf({value:l,schema:i})}catch(l){return{success:!1,error:Yo.isInstance(l)?l:new Yo({text:r,cause:l})}}}var{btoa:zh,atob:Xh}=globalThis;var Kf=Symbol("Let zodToJsonSchema decide on which parser to use");var cr={code:"0",name:"text",parse:r=>{if(typeof r!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:r}}},pr={code:"3",name:"error",parse:r=>{if(typeof r!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:r}}},hr={code:"4",name:"assistant_message",parse:r=>{if(r==null||typeof r!="object"||!("id"in r)||!("role"in r)||!("content"in r)||typeof r.id!="string"||typeof r.role!="string"||r.role!=="assistant"||!Array.isArray(r.content)||!r.content.every(i=>i!=null&&typeof i=="object"&&"type"in i&&i.type==="text"&&"text"in i&&i.text!=null&&typeof i.text=="object"&&"value"in i.text&&typeof i.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:r}}},mr={code:"5",name:"assistant_control_data",parse:r=>{if(r==null||typeof r!="object"||!("threadId"in r)||!("messageId"in r)||typeof r.threadId!="string"||typeof r.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:r.threadId,messageId:r.messageId}}}},gr={code:"6",name:"data_message",parse:r=>{if(r==null||typeof r!="object"||!("role"in r)||!("data"in r)||typeof r.role!="string"||r.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:r}}},Xf=[cr,pr,hr,mr,gr],t0={[cr.code]:cr,[pr.code]:pr,[hr.code]:hr,[mr.code]:mr,[gr.code]:gr},a0={[cr.name]:cr.code,[pr.name]:pr.code,[hr.name]:hr.code,[mr.name]:mr.code,[gr.name]:gr.code},r0=Xf.map(r=>r.code);function Yf(r){let i=["ROOT"],l=-1,g=null;function L(p,O,A){switch(p){case'"':{l=O,i.pop(),i.push(A),i.push("INSIDE_STRING");break}case"f":case"t":case"n":{l=O,g=O,i.pop(),i.push(A),i.push("INSIDE_LITERAL");break}case"-":{i.pop(),i.push(A),i.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{l=O,i.pop(),i.push(A),i.push("INSIDE_NUMBER");break}case"{":{l=O,i.pop(),i.push(A),i.push("INSIDE_OBJECT_START");break}case"[":{l=O,i.pop(),i.push(A),i.push("INSIDE_ARRAY_START");break}}}function x(p,O){switch(p){case",":{i.pop(),i.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{l=O,i.pop();break}}}function R(p,O){switch(p){case",":{i.pop(),i.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{l=O,i.pop();break}}}for(let p=0;p<r.length;p++){let O=r[p];switch(i[i.length-1]){case"ROOT":L(O,p,"FINISH");break;case"INSIDE_OBJECT_START":{switch(O){case'"':{i.pop(),i.push("INSIDE_OBJECT_KEY");break}case"}":{l=p,i.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(O){case'"':{i.pop(),i.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(O){case'"':{i.pop(),i.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(O){case":":{i.pop(),i.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{L(O,p,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{x(O,p);break}case"INSIDE_STRING":{switch(O){case'"':{i.pop(),l=p;break}case"\\":{i.push("INSIDE_STRING_ESCAPE");break}default:l=p}break}case"INSIDE_ARRAY_START":{switch(O){case"]":{l=p,i.pop();break}default:{l=p,L(O,p,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(O){case",":{i.pop(),i.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{l=p,i.pop();break}default:{l=p;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{L(O,p,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{i.pop(),l=p;break}case"INSIDE_NUMBER":{switch(O){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{l=p;break}case"e":case"E":case"-":case".":break;case",":{i.pop(),i[i.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&R(O,p),i[i.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&x(O,p);break}case"}":{i.pop(),i[i.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&x(O,p);break}case"]":{i.pop(),i[i.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&R(O,p);break}default:{i.pop();break}}break}case"INSIDE_LITERAL":{let E=r.substring(g,p+1);!"false".startsWith(E)&&!"true".startsWith(E)&&!"null".startsWith(E)?(i.pop(),i[i.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?x(O,p):i[i.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&R(O,p)):l=p;break}}}let c=r.slice(0,l+1);for(let p=i.length-1;p>=0;p--)switch(i[p]){case"INSIDE_STRING":{c+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{c+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{c+="]";break}case"INSIDE_LITERAL":{let A=r.substring(g,r.length);"true".startsWith(A)?c+="true".slice(A.length):"false".startsWith(A)?c+="false".slice(A.length):"null".startsWith(A)&&(c+="null".slice(A.length))}}return c}function $f(r){if(r===void 0)return{value:void 0,state:"undefined-input"};let i=Jo({text:r});return i.success?{value:i.value,state:"successful-parse"}:(i=Jo({text:Yf(r)}),i.success?{value:i.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var xr={code:"0",name:"text",parse:r=>{if(typeof r!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:r}}},vr={code:"2",name:"data",parse:r=>{if(!Array.isArray(r))throw new Error('"data" parts expect an array value.');return{type:"data",value:r}}},Lr={code:"3",name:"error",parse:r=>{if(typeof r!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:r}}},yr={code:"8",name:"message_annotations",parse:r=>{if(!Array.isArray(r))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:r}}},Ir={code:"9",name:"tool_call",parse:r=>{if(r==null||typeof r!="object"||!("toolCallId"in r)||typeof r.toolCallId!="string"||!("toolName"in r)||typeof r.toolName!="string"||!("args"in r)||typeof r.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:r}}},Sr={code:"a",name:"tool_result",parse:r=>{if(r==null||typeof r!="object"||!("toolCallId"in r)||typeof r.toolCallId!="string"||!("result"in r))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:r}}},Cr={code:"b",name:"tool_call_streaming_start",parse:r=>{if(r==null||typeof r!="object"||!("toolCallId"in r)||typeof r.toolCallId!="string"||!("toolName"in r)||typeof r.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:r}}},Er={code:"c",name:"tool_call_delta",parse:r=>{if(r==null||typeof r!="object"||!("toolCallId"in r)||typeof r.toolCallId!="string"||!("argsTextDelta"in r)||typeof r.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:r}}},Ar={code:"d",name:"finish_message",parse:r=>{if(r==null||typeof r!="object"||!("finishReason"in r)||typeof r.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');let i={finishReason:r.finishReason};return"usage"in r&&r.usage!=null&&typeof r.usage=="object"&&"promptTokens"in r.usage&&"completionTokens"in r.usage&&(i.usage={promptTokens:typeof r.usage.promptTokens=="number"?r.usage.promptTokens:Number.NaN,completionTokens:typeof r.usage.completionTokens=="number"?r.usage.completionTokens:Number.NaN}),{type:"finish_message",value:i}}},Tr={code:"e",name:"finish_step",parse:r=>{if(r==null||typeof r!="object"||!("finishReason"in r)||typeof r.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');let i={finishReason:r.finishReason,isContinued:!1};return"usage"in r&&r.usage!=null&&typeof r.usage=="object"&&"promptTokens"in r.usage&&"completionTokens"in r.usage&&(i.usage={promptTokens:typeof r.usage.promptTokens=="number"?r.usage.promptTokens:Number.NaN,completionTokens:typeof r.usage.completionTokens=="number"?r.usage.completionTokens:Number.NaN}),"isContinued"in r&&typeof r.isContinued=="boolean"&&(i.isContinued=r.isContinued),{type:"finish_step",value:i}}},Zf=[xr,vr,Lr,yr,Ir,Sr,Cr,Er,Ar,Tr],Jf={[xr.code]:xr,[vr.code]:vr,[Lr.code]:Lr,[yr.code]:yr,[Ir.code]:Ir,[Sr.code]:Sr,[Cr.code]:Cr,[Er.code]:Er,[Ar.code]:Ar,[Tr.code]:Tr},i0={[xr.name]:xr.code,[vr.name]:vr.code,[Lr.name]:Lr.code,[yr.name]:yr.code,[Ir.name]:Ir.code,[Sr.name]:Sr.code,[Cr.name]:Cr.code,[Er.name]:Er.code,[Ar.name]:Ar.code,[Tr.name]:Tr.code},Qf=Zf.map(r=>r.code),ec=r=>{let i=r.indexOf(":");if(i===-1)throw new Error("Failed to parse stream string. No separator found.");let l=r.slice(0,i);if(!Qf.includes(l))throw new Error(`Failed to parse stream string. Invalid code ${l}.`);let g=l,L=r.slice(i+1),x=JSON.parse(L);return Jf[g].parse(x)};var tc=10;function ac(r,i){let l=new Uint8Array(i),g=0;for(let L of r)l.set(L,g),g+=L.length;return r.length=0,l}async function rc({stream:r,onTextPart:i,onDataPart:l,onErrorPart:g,onToolCallStreamingStartPart:L,onToolCallDeltaPart:x,onToolCallPart:R,onToolResultPart:c,onMessageAnnotationsPart:p,onFinishMessagePart:O,onFinishStepPart:A}){let E=r.getReader(),M=new TextDecoder,D=[],F=0;for(;;){let{value:q}=await E.read();if(q&&(D.push(q),F+=q.length,q[q.length-1]!==tc))continue;if(D.length===0)break;let G=ac(D,F);F=0;let B=M.decode(G,{stream:!0}).split(`
`).filter(U=>U!=="").map(ec);for(let{type:U,value:K}of B)switch(U){case"text":await i?.(K);break;case"data":await l?.(K);break;case"error":await g?.(K);break;case"message_annotations":await p?.(K);break;case"tool_call_streaming_start":await L?.(K);break;case"tool_call_delta":await x?.(K);break;case"tool_call":await R?.(K);break;case"tool_result":await c?.(K);break;case"finish_message":await O?.(K);break;case"finish_step":await A?.(K);break;default:{let z=U;throw new Error(`Unknown stream part type: ${z}`)}}}}function oc({promptTokens:r,completionTokens:i}){return{promptTokens:r,completionTokens:i,totalTokens:r+i}}async function sc({stream:r,update:i,onToolCall:l,onFinish:g,generateId:L=dr,getCurrentDate:x=()=>new Date}){let R=x(),c,p=!0,O=[],A=[],E,M={},D={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},F="unknown";function q(){let B=[...A];if(c==null){i(O,B);return}E?.length&&(c.annotations=E);let U={...JSON.parse(JSON.stringify(c)),revisionId:L(),createdAt:c.createdAt};i([...O,U],B)}function G(){return(p||c==null)&&(c!=null&&O.push(c),p=!1,c={id:L(),role:"assistant",content:"",createdAt:R}),c}await rc({stream:r,onTextPart(B){let U=G();c={...U,content:U.content+B},q()},onToolCallStreamingStartPart(B){let U=G();U.toolInvocations==null&&(U.toolInvocations=[]),M[B.toolCallId]={text:"",toolName:B.toolName,index:U.toolInvocations.length},U.toolInvocations.push({state:"partial-call",toolCallId:B.toolCallId,toolName:B.toolName,args:void 0}),q()},onToolCallDeltaPart(B){let U=G(),K=M[B.toolCallId];K.text+=B.argsTextDelta;let{value:z}=$f(K.text);U.toolInvocations[K.index]={state:"partial-call",toolCallId:B.toolCallId,toolName:K.toolName,args:z},q()},async onToolCallPart(B){let U=G();if(M[B.toolCallId]!=null?U.toolInvocations[M[B.toolCallId].index]={state:"call",...B}:(U.toolInvocations==null&&(U.toolInvocations=[]),U.toolInvocations.push({state:"call",...B})),l){let K=await l({toolCall:B});K!=null&&(U.toolInvocations[U.toolInvocations.length-1]={state:"result",...B,result:K})}q()},onToolResultPart(B){let K=G().toolInvocations;if(K==null)throw new Error("tool_result must be preceded by a tool_call");let z=K.findIndex($=>$.toolCallId===B.toolCallId);if(z===-1)throw new Error("tool_result must be preceded by a tool_call with the same toolCallId");K[z]={...K[z],state:"result",...B},q()},onDataPart(B){A.push(...B),q()},onMessageAnnotationsPart(B){E==null?E=[...B]:E.push(...B),q()},onFinishStepPart(B){p=!B.isContinued},onFinishMessagePart(B){F=B.finishReason,B.usage!=null&&(D=oc(B.usage))},onErrorPart(B){throw new Error(B)}}),g?.({message:c,finishReason:F,usage:D})}async function ic({stream:r,onTextPart:i}){let l=r.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:g,value:L}=await l.read();if(g)break;await i(L)}}var nc=()=>fetch;async function vn({api:r,body:i,streamProtocol:l="data",credentials:g,headers:L,abortController:x,restoreMessagesOnFailure:R,onResponse:c,onUpdate:p,onFinish:O,onToolCall:A,generateId:E,fetch:M=nc()}){var D,F;let q=await M(r,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json",...L},signal:(D=x?.())==null?void 0:D.signal,credentials:g}).catch(G=>{throw R(),G});if(c)try{await c(q)}catch(G){throw G}if(!q.ok)throw R(),new Error((F=await q.text())!=null?F:"Failed to fetch the chat response.");if(!q.body)throw new Error("The response body is empty.");switch(l){case"text":{let G={id:E(),createdAt:new Date,role:"assistant",content:""};await ic({stream:q.body,onTextPart:B=>{G.content+=B,p([{...G}],[])}}),O?.(G,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"});return}case"data":{await sc({stream:q.body,update:p,onToolCall:A,onFinish({message:G,finishReason:B,usage:U}){O&&G!=null&&O(G,{usage:U,finishReason:B})},generateId:E});return}default:{let G=l;throw new Error(`Unknown stream protocol: ${G}`)}}}async function Qo(r){if(!r)return[];if(r instanceof FileList)return Promise.all(Array.from(r).map(async i=>{let{name:l,type:g}=i,L=await new Promise((x,R)=>{let c=new FileReader;c.onload=p=>{var O;x((O=p.target)==null?void 0:O.result)},c.onerror=p=>R(p),c.readAsDataURL(i)});return{name:l,contentType:g,url:L}}));if(Array.isArray(r))return r;throw new Error("Invalid attachments type")}var l0=Symbol.for("vercel.ai.schema");var ms=We(ze(),1);var ft=We(ze(),1);var bt=We(ze(),1),Nn=We(Sn(),1);var It=We(ze(),1),ma=()=>{},kt=ma(),br=Object,Ze=r=>r===kt,zt=r=>typeof r=="function",aa=(r,i)=>({...r,...i}),xc=r=>zt(r.then),ao=new WeakMap,vc=0,wr=r=>{let i=typeof r,l=r&&r.constructor,g=l==Date,L,x;if(br(r)===r&&!g&&l!=RegExp){if(L=ao.get(r),L)return L;if(L=++vc+"~",ao.set(r,L),l==Array){for(L="@",x=0;x<r.length;x++)L+=wr(r[x])+",";ao.set(r,L)}if(l==br){L="#";let R=br.keys(r).sort();for(;!Ze(x=R.pop());)Ze(r[x])||(L+=x+":"+wr(r[x])+",");ao.set(r,L)}}else L=g?r.toJSON():i=="symbol"?r.toString():i=="string"?JSON.stringify(r):""+r;return L},ta=new WeakMap,ts={},ro={},ls="undefined",so=typeof window!=ls,rs=typeof document!=ls,Lc=()=>so&&typeof window.requestAnimationFrame!=ls,us=(r,i)=>{let l=ta.get(r);return[()=>!Ze(i)&&r.get(i)||ts,g=>{if(!Ze(i)){let L=r.get(i);i in ro||(ro[i]=L),l[5](i,aa(L,g),L||ts)}},l[6],()=>!Ze(i)&&i in ro?ro[i]:!Ze(i)&&r.get(i)||ts]},os=!0,yc=()=>os,[ss,is]=so&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[ma,ma],Ic=()=>{let r=rs&&document.visibilityState;return Ze(r)||r!=="hidden"},Sc=r=>(rs&&document.addEventListener("visibilitychange",r),ss("focus",r),()=>{rs&&document.removeEventListener("visibilitychange",r),is("focus",r)}),Cc=r=>{let i=()=>{os=!0,r()},l=()=>{os=!1};return ss("online",i),ss("offline",l),()=>{is("online",i),is("offline",l)}},Ec={isOnline:yc,isVisible:Ic},Ac={initFocus:Sc,initReconnect:Cc},ds=!It.default.useId,Na=!so||"Deno"in window,An=r=>Lc()?window.requestAnimationFrame(r):setTimeout(r,1),_r=Na?It.useEffect:It.useLayoutEffect,as=typeof navigator<"u"&&navigator.connection,Cn=!Na&&as&&(["slow-2g","2g"].includes(as.effectiveType)||as.saveData),io=r=>{if(zt(r))try{r=r()}catch{r=""}let i=r;return r=typeof r=="string"?r:(Array.isArray(r)?r.length:r)?wr(r):"",[r,i]},Tc=0,oo=()=>++Tc,Tn=0,bn=1,wn=2,bc=3,Ua={__proto__:null,ERROR_REVALIDATE_EVENT:bc,FOCUS_EVENT:Tn,MUTATE_EVENT:wn,RECONNECT_EVENT:bn};async function fs(...r){let[i,l,g,L]=r,x=aa({populateCache:!0,throwOnError:!0},typeof L=="boolean"?{revalidate:L}:L||{}),R=x.populateCache,c=x.rollbackOnError,p=x.optimisticData,O=M=>typeof c=="function"?c(M):c!==!1,A=x.throwOnError;if(zt(l)){let M=l,D=[],F=i.keys();for(let q of F)!/^\$(inf|sub)\$/.test(q)&&M(i.get(q)._k)&&D.push(q);return Promise.all(D.map(E))}return E(l);async function E(M){let[D]=io(M);if(!D)return;let[F,q]=us(i,D),[G,B,U,K]=ta.get(i),z=()=>{let ue=G[D];return(zt(x.revalidate)?x.revalidate(F().data,M):x.revalidate!==!1)&&(delete U[D],delete K[D],ue&&ue[0])?ue[0](wn).then(()=>F().data):F().data};if(r.length<3)return z();let $=g,ae,ie=oo();B[D]=[ie,0];let ne=!Ze(p),le=F(),ce=le.data,Oe=le._c,de=Ze(Oe)?ce:Oe;if(ne&&(p=zt(p)?p(de,ce):p,q({data:p,_c:de})),zt($))try{$=$(de)}catch(ue){ae=ue}if($&&xc($))if($=await $.catch(ue=>{ae=ue}),ie!==B[D][0]){if(ae)throw ae;return $}else ae&&ne&&O(ae)&&(R=!0,q({data:de,_c:kt}));if(R&&!ae)if(zt(R)){let ue=R($,de);q({data:ue,error:kt,_c:kt})}else q({data:$,error:kt,_c:kt});if(B[D][1]=oo(),Promise.resolve(z()).then(()=>{q({_c:kt})}),ae){if(A)throw ae;return}return $}}var En=(r,i)=>{for(let l in r)r[l][0]&&r[l][0](i)},_n=(r,i)=>{if(!ta.has(r)){let l=aa(Ac,i),g={},L=fs.bind(kt,r),x=ma,R={},c=(A,E)=>{let M=R[A]||[];return R[A]=M,M.push(E),()=>M.splice(M.indexOf(E),1)},p=(A,E,M)=>{r.set(A,E);let D=R[A];if(D)for(let F of D)F(E,M)},O=()=>{if(!ta.has(r)&&(ta.set(r,[g,{},{},{},L,p,c]),!Na)){let A=l.initFocus(setTimeout.bind(kt,En.bind(kt,g,Tn))),E=l.initReconnect(setTimeout.bind(kt,En.bind(kt,g,bn)));x=()=>{A&&A(),E&&E(),ta.delete(r)}}};return O(),[r,L,O,x]}return[r,ta.get(r)[4]]},wc=(r,i,l,g,L)=>{let x=l.errorRetryCount,R=L.retryCount,c=~~((Math.random()+.5)*(1<<(R<8?R:8)))*l.errorRetryInterval;!Ze(x)&&R>x||setTimeout(g,c,L)},_c=(r,i)=>wr(r)==wr(i),[cs,Rn]=_n(new Map),ps=aa({onLoadingSlow:ma,onSuccess:ma,onError:ma,onErrorRetry:wc,onDiscarded:ma,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Cn?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Cn?5e3:3e3,compare:_c,isPaused:()=>!1,cache:cs,mutate:Rn,fallback:{}},Ec),Dn=(r,i)=>{let l=aa(r,i);if(i){let{use:g,fallback:L}=r,{use:x,fallback:R}=i;g&&x&&(l.use=g.concat(x)),L&&R&&(l.fallback=aa(L,R))}return l},ns=(0,It.createContext)({}),kn=r=>{let{value:i}=r,l=(0,It.useContext)(ns),g=zt(i),L=(0,It.useMemo)(()=>g?i(l):i,[g,l,i]),x=(0,It.useMemo)(()=>g?L:Dn(l,L),[g,l,L]),R=L&&L.provider,c=(0,It.useRef)(kt);R&&!c.current&&(c.current=_n(R(x.cache||cs),L));let p=c.current;return p&&(x.cache=p[0],x.mutate=p[1]),_r(()=>{if(p)return p[2]&&p[2](),p[3]},[]),(0,It.createElement)(ns.Provider,aa(r,{value:x}))},Rc="$inf$",Pn=so&&window.__SWR_DEVTOOLS_USE__,Dc=Pn?window.__SWR_DEVTOOLS_USE__:[],kc=()=>{Pn&&(window.__SWR_DEVTOOLS_REACT__=It.default)},Pc=r=>zt(r[1])?[r[0],r[1],r[2]||{}]:[r[0],null,(r[1]===null?r[2]:r[1])||{}],Fn=()=>aa(ps,(0,It.useContext)(ns));var Fc=r=>(i,l,g)=>r(i,l&&((...x)=>{let[R]=io(i),[,,,c]=ta.get(cs);if(R.startsWith(Rc))return l(...x);let p=c[R];return Ze(p)?l(...x):(delete c[R],p)}),g),Oc=Dc.concat(Fc),On=r=>function(...l){let g=Fn(),[L,x,R]=Pc(l),c=Dn(g,R),p=r,{use:O}=c,A=(O||[]).concat(Oc);for(let E=A.length;E--;)p=A[E](p);return p(L,x||c.fetcher||null,c)},Mn=(r,i,l)=>{let g=i[r]||(i[r]=[]);return g.push(l),()=>{let L=g.indexOf(l);L>=0&&(g[L]=g[g.length-1],g.pop())}};kc();var Bn=bt.default.use||(r=>{if(r.status==="pending")throw r;if(r.status==="fulfilled")return r.value;throw r.status==="rejected"?r.reason:(r.status="pending",r.then(i=>{r.status="fulfilled",r.value=i},i=>{r.status="rejected",r.reason=i}),r)}),hs={dedupe:!0},Mc=(r,i,l)=>{let{cache:g,compare:L,suspense:x,fallbackData:R,revalidateOnMount:c,revalidateIfStale:p,refreshInterval:O,refreshWhenHidden:A,refreshWhenOffline:E,keepPreviousData:M}=l,[D,F,q,G]=ta.get(g),[B,U]=io(r),K=(0,bt.useRef)(!1),z=(0,bt.useRef)(!1),$=(0,bt.useRef)(B),ae=(0,bt.useRef)(i),ie=(0,bt.useRef)(l),ne=()=>ie.current,le=()=>ne().isVisible()&&ne().isOnline(),[ce,Oe,de,ue]=us(g,B),Te=(0,bt.useRef)({}).current,Ie=Ze(R)?l.fallback[B]:R,Me=(ge,Se)=>{for(let ve in Te){let He=ve;if(He==="data"){if(!L(ge[He],Se[He])&&(!Ze(ge[He])||!L(rt,Se[He])))return!1}else if(Se[He]!==ge[He])return!1}return!0},ke=(0,bt.useMemo)(()=>{let ge=!B||!i?!1:Ze(c)?ne().isPaused()||x?!1:Ze(p)?!0:p:c,Se=H=>{let v=aa(H);return delete v._k,ge?{isValidating:!0,isLoading:!0,...v}:v},ve=ce(),He=ue(),Re=Se(ve),ct=ve===He?Re:Se(He),k=Re;return[()=>{let H=Se(ce());return Me(H,k)?(k.data=H.data,k.isLoading=H.isLoading,k.isValidating=H.isValidating,k.error=H.error,k):(k=H,H)},()=>ct]},[g,B]),Be=(0,Nn.useSyncExternalStore)((0,bt.useCallback)(ge=>de(B,(Se,ve)=>{Me(ve,Se)||ge()}),[g,B]),ke[0],ke[1]),Fe=!K.current,qe=D[B]&&D[B].length>0,Ce=Be.data,Je=Ze(Ce)?Ie:Ce,je=Be.error,Pt=(0,bt.useRef)(Je),rt=M?Ze(Ce)?Pt.current:Ce:Je,De=qe&&!Ze(je)?!1:Fe&&!Ze(c)?c:ne().isPaused()?!1:x?Ze(Je)?!1:p:Ze(Je)||p,ot=!!(B&&i&&Fe&&De),nt=Ze(Be.isValidating)?ot:Be.isValidating,xt=Ze(Be.isLoading)?ot:Be.isLoading,_e=(0,bt.useCallback)(async ge=>{let Se=ae.current;if(!B||!Se||z.current||ne().isPaused())return!1;let ve,He,Re=!0,ct=ge||{},k=!q[B]||!ct.dedupe,H=()=>ds?!z.current&&B===$.current&&K.current:B===$.current,v={isValidating:!1,isLoading:!1},w=()=>{Oe(v)},S=()=>{let y=q[B];y&&y[1]===He&&delete q[B]},f={isValidating:!0};Ze(ce().data)&&(f.isLoading=!0);try{if(k&&(Oe(f),l.loadingTimeout&&Ze(ce().data)&&setTimeout(()=>{Re&&H()&&ne().onLoadingSlow(B,l)},l.loadingTimeout),q[B]=[Se(U),oo()]),[ve,He]=q[B],ve=await ve,k&&setTimeout(S,l.dedupingInterval),!q[B]||q[B][1]!==He)return k&&H()&&ne().onDiscarded(B),!1;v.error=kt;let y=F[B];if(!Ze(y)&&(He<=y[0]||He<=y[1]||y[1]===0))return w(),k&&H()&&ne().onDiscarded(B),!1;let C=ce().data;v.data=L(C,ve)?C:ve,k&&H()&&ne().onSuccess(ve,B,l)}catch(y){S();let C=ne(),{shouldRetryOnError:_}=C;C.isPaused()||(v.error=y,k&&H()&&(C.onError(y,B,C),(_===!0||zt(_)&&_(y))&&(!ne().revalidateOnFocus||!ne().revalidateOnReconnect||le())&&C.onErrorRetry(y,B,C,P=>{let V=D[B];V&&V[0]&&V[0](Ua.ERROR_REVALIDATE_EVENT,P)},{retryCount:(ct.retryCount||0)+1,dedupe:!0})))}return Re=!1,w(),!0},[B,g]),Qe=(0,bt.useCallback)((...ge)=>fs(g,$.current,...ge),[]);if(_r(()=>{ae.current=i,ie.current=l,Ze(Ce)||(Pt.current=Ce)}),_r(()=>{if(!B)return;let ge=_e.bind(kt,hs),Se=0,He=Mn(B,D,(Re,ct={})=>{if(Re==Ua.FOCUS_EVENT){let k=Date.now();ne().revalidateOnFocus&&k>Se&&le()&&(Se=k+ne().focusThrottleInterval,ge())}else if(Re==Ua.RECONNECT_EVENT)ne().revalidateOnReconnect&&le()&&ge();else{if(Re==Ua.MUTATE_EVENT)return _e();if(Re==Ua.ERROR_REVALIDATE_EVENT)return _e(ct)}});return z.current=!1,$.current=B,K.current=!0,Oe({_k:U}),De&&(Ze(Je)||Na?ge():An(ge)),()=>{z.current=!0,He()}},[B]),_r(()=>{let ge;function Se(){let He=zt(O)?O(ce().data):O;He&&ge!==-1&&(ge=setTimeout(ve,He))}function ve(){!ce().error&&(A||ne().isVisible())&&(E||ne().isOnline())?_e(hs).then(Se):Se()}return Se(),()=>{ge&&(clearTimeout(ge),ge=-1)}},[O,A,E,B]),(0,bt.useDebugValue)(rt),x&&Ze(Je)&&B){if(!ds&&Na)throw new Error("Fallback data is required when using suspense in SSR.");ae.current=i,ie.current=l,z.current=!1;let ge=G[B];if(!Ze(ge)){let Se=Qe(ge);Bn(Se)}if(Ze(je)){let Se=_e(hs);Ze(rt)||(Se.status="fulfilled",Se.value=!0),Bn(Se)}else throw je}return{mutate:Qe,get data(){return Te.data=!0,rt},get error(){return Te.error=!0,je},get isValidating(){return Te.isValidating=!0,nt},get isLoading(){return Te.isLoading=!0,xt}}},m0=br.defineProperty(kn,"defaultValue",{value:ps}),Ca=On(Mc);var Hn=We(Gn(),1);var Rr=We(ze(),1);var no=We(ze(),1);function Vn(r,i){return i!=null?(0,Hn.default)(r,i):r}var Nc=async(r,i,l,g,L,x,R,c,p,O,A,E,M,D,F,q,G)=>{var B;let U=R.current;l(i.messages,!1);let K=D?i.messages:i.messages.map(({role:$,content:ae,experimental_attachments:ie,data:ne,annotations:le,toolInvocations:ce})=>({role:$,content:ae,...ie!==void 0&&{experimental_attachments:ie},...ne!==void 0&&{data:ne},...le!==void 0&&{annotations:le},...ce!==void 0&&{toolInvocations:ce}})),z=L.current;return await vn({api:r,body:(B=F?.({messages:i.messages,requestData:i.data,requestBody:i.body}))!=null?B:{messages:K,data:i.data,...x.current.body,...i.body},streamProtocol:O,credentials:x.current.credentials,headers:{...x.current.headers,...i.headers},abortController:()=>c.current,restoreMessagesOnFailure(){G||l(U,!1)},onResponse:E,onUpdate($,ae){l([...i.messages,...$],!1),ae?.length&&g([...z??[],...ae],!1)},onToolCall:M,onFinish:A,generateId:p,fetch:q})};function Kn({api:r="/api/chat",id:i,initialMessages:l,initialInput:g="",sendExtraMessageFields:L,onToolCall:x,experimental_prepareRequestBody:R,maxSteps:c=1,streamProtocol:p="data",onResponse:O,onFinish:A,onError:E,credentials:M,headers:D,body:F,generateId:q=dr,fetch:G,keepLastMessageOnError:B=!0,experimental_throttle:U}={}){let K=(0,ft.useId)(),z=i??K,$=typeof r=="string"?[r,z]:z,[ae]=(0,ft.useState)([]),{data:ie,mutate:ne}=Ca([$,"messages"],null,{fallbackData:l??ae}),le=(0,ft.useRef)(ie||[]);(0,ft.useEffect)(()=>{le.current=ie||[]},[ie]);let{data:ce,mutate:Oe}=Ca([$,"streamData"],null),de=(0,ft.useRef)(ce);(0,ft.useEffect)(()=>{de.current=ce},[ce]);let{data:ue=!1,mutate:Te}=Ca([$,"loading"],null),{data:Ie=void 0,mutate:Me}=Ca([$,"error"],null),ke=(0,ft.useRef)(null),Be=(0,ft.useRef)({credentials:M,headers:D,body:F});(0,ft.useEffect)(()=>{Be.current={credentials:M,headers:D,body:F}},[M,D,F]);let Fe=(0,ft.useCallback)(async _e=>{let Qe=le.current.length;try{Te(!0),Me(void 0);let ve=new AbortController;ke.current=ve,await Nc(r,_e,Vn(ne,U),Vn(Oe,U),de,Be,le,ke,q,p,A,O,x,L,R,G,B),ke.current=null}catch(ve){if(ve.name==="AbortError")return ke.current=null,null;E&&ve instanceof Error&&E(ve),Me(ve)}finally{Te(!1)}let ge=le.current,Se=ge[ge.length-1];ge.length>Qe&&Se!=null&&c>1&&qn(Se)&&Uc(ge)<c&&await Fe({messages:ge})},[ne,Te,r,Be,O,A,E,Me,Oe,de,p,L,R,x,c,le,ke,q,G,B,U]),qe=(0,ft.useCallback)(async(_e,{data:Qe,headers:ge,body:Se,experimental_attachments:ve}={})=>{var He,Re;let ct=await Qo(ve),k=le.current.concat({..._e,id:(He=_e.id)!=null?He:q(),createdAt:(Re=_e.createdAt)!=null?Re:new Date,experimental_attachments:ct.length>0?ct:void 0});return Fe({messages:k,headers:ge,body:Se,data:Qe})},[Fe,q]),Ce=(0,ft.useCallback)(async({data:_e,headers:Qe,body:ge}={})=>{let Se=le.current;if(Se.length===0)return null;let ve=Se[Se.length-1];return Fe({messages:ve.role==="assistant"?Se.slice(0,-1):Se,headers:Qe,body:ge,data:_e})},[Fe]),Je=(0,ft.useCallback)(()=>{ke.current&&(ke.current.abort(),ke.current=null)},[]),je=(0,ft.useCallback)(_e=>{typeof _e=="function"&&(_e=_e(le.current)),ne(_e,!1),le.current=_e},[ne]),Pt=(0,ft.useCallback)(_e=>{typeof _e=="function"&&(_e=_e(de.current)),Oe(_e,!1),de.current=_e},[Oe]),[rt,De]=(0,ft.useState)(g),ot=(0,ft.useCallback)(async(_e,Qe={},ge)=>{var Se;if((Se=_e?.preventDefault)==null||Se.call(_e),!rt&&!Qe.allowEmptySubmit)return;ge&&(Be.current={...Be.current,...ge});let ve=await Qo(Qe.experimental_attachments),Re={messages:!rt&&!ve.length&&Qe.allowEmptySubmit?le.current:le.current.concat({id:q(),createdAt:new Date,role:"user",content:rt,experimental_attachments:ve.length>0?ve:void 0}),headers:Qe.headers,body:Qe.body,data:Qe.data};Fe(Re),De("")},[rt,q,Fe]);return{messages:ie||[],setMessages:je,data:ce,setData:Pt,error:Ie,append:qe,reload:Ce,stop:Je,input:rt,setInput:De,handleInputChange:_e=>{De(_e.target.value)},handleSubmit:ot,isLoading:ue,addToolResult:({toolCallId:_e,result:Qe})=>{let ge=le.current.map((ve,He,Re)=>He===Re.length-1&&ve.role==="assistant"&&ve.toolInvocations?{...ve,toolInvocations:ve.toolInvocations.map(ct=>ct.toolCallId===_e?{...ct,result:Qe,state:"result"}:ct)}:ve);ne(ge,!1);let Se=ge[ge.length-1];qn(Se)&&Fe({messages:ge})}}}function qn(r){return r.role==="assistant"&&r.toolInvocations&&r.toolInvocations.length>0&&r.toolInvocations.every(i=>"result"in i)}function Uc(r){let i=0;for(let l=r.length-1;l>=0&&r[l].role==="assistant";l--)i++;return i}var Wn=Kn;var lo=r=>r;var uo=lo;var $n=We(ze(),1),Zn=(0,$n.createContext)(null);var Jn=We(ze(),1),Qn=(0,Jn.createContext)({});var el=We(ze(),1),tl=(0,el.createContext)({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});var co=We(ze(),1);var al=typeof window<"u";var rl=al?co.useLayoutEffect:co.useEffect;var ol=We(ze(),1);function po(r){let i=(0,ol.useRef)(null);return i.current===null&&(i.current=r()),i.current}var Pr=We(Dr(),1),ra=We(ze(),1);var xs=We(Dr(),1),nl=We(ze(),1),Ea=We(ze(),1);var sl=We(Dr(),1),ho=We(ze(),1),ca=We(ze(),1);var gs=class extends ho.Component{getSnapshotBeforeUpdate(i){let l=this.props.childRef.current;if(l&&i.isPresent&&!this.props.isPresent){let g=this.props.sizeRef.current;g.height=l.offsetHeight||0,g.width=l.offsetWidth||0,g.top=l.offsetTop,g.left=l.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}};function il({children:r,isPresent:i}){let l=(0,ca.useId)(),g=(0,ca.useRef)(null),L=(0,ca.useRef)({width:0,height:0,top:0,left:0}),{nonce:x}=(0,ca.useContext)(tl);return(0,ca.useInsertionEffect)(()=>{let{width:R,height:c,top:p,left:O}=L.current;if(i||!g.current||!R||!c)return;g.current.dataset.motionPopId=l;let A=document.createElement("style");return x&&(A.nonce=x),document.head.appendChild(A),A.sheet&&A.sheet.insertRule(`
          [data-motion-pop-id="${l}"] {
            position: absolute !important;
            width: ${R}px !important;
            height: ${c}px !important;
            top: ${p}px !important;
            left: ${O}px !important;
          }
        `),()=>{document.head.removeChild(A)}},[i]),(0,sl.jsx)(gs,{isPresent:i,childRef:g,sizeRef:L,children:ho.cloneElement(r,{ref:g})})}var ll=({children:r,initial:i,isPresent:l,onExitComplete:g,custom:L,presenceAffectsLayout:x,mode:R})=>{let c=po(Xc),p=(0,Ea.useId)(),O=(0,Ea.useCallback)(E=>{c.set(E,!0);for(let M of c.values())if(!M)return;g&&g()},[c,g]),A=(0,Ea.useMemo)(()=>({id:p,initial:i,isPresent:l,custom:L,onExitComplete:O,register:E=>(c.set(E,!1),()=>c.delete(E))}),x?[Math.random(),O]:[l,O]);return(0,Ea.useMemo)(()=>{c.forEach((E,M)=>c.set(M,!1))},[l]),nl.useEffect(()=>{!l&&!c.size&&g&&g()},[l]),R==="popLayout"&&(r=(0,xs.jsx)(il,{isPresent:l,children:r})),(0,xs.jsx)(Zn.Provider,{value:A,children:r})};function Xc(){return new Map}var mo=We(ze(),1),kr=r=>r.key||"";function vs(r){let i=[];return mo.Children.forEach(r,l=>{(0,mo.isValidElement)(l)&&i.push(l)}),i}var Ls=({children:r,exitBeforeEnter:i,custom:l,initial:g=!0,onExitComplete:L,presenceAffectsLayout:x=!0,mode:R="sync"})=>{uo(!i,"Replace exitBeforeEnter with mode='wait'");let c=(0,ra.useMemo)(()=>vs(r),[r]),p=c.map(kr),O=(0,ra.useRef)(!0),A=(0,ra.useRef)(c),E=po(()=>new Map),[M,D]=(0,ra.useState)(c),[F,q]=(0,ra.useState)(c);rl(()=>{O.current=!1,A.current=c;for(let U=0;U<F.length;U++){let K=kr(F[U]);p.includes(K)?E.delete(K):E.get(K)!==!0&&E.set(K,!1)}},[F,p.length,p.join("-")]);let G=[];if(c!==M){let U=[...c];for(let K=0;K<F.length;K++){let z=F[K],$=kr(z);p.includes($)||(U.splice(K,0,z),G.push(z))}R==="wait"&&G.length&&(U=G),q(vs(U)),D(c);return}let{forceRender:B}=(0,ra.useContext)(Qn);return(0,Pr.jsx)(Pr.Fragment,{children:F.map(U=>{let K=kr(U),z=c===F||p.includes(K),$=()=>{if(E.has(K))E.set(K,!0);else return;let ae=!0;E.forEach(ie=>{ie||(ae=!1)}),ae&&(B?.(),q(A.current),L&&L())};return(0,Pr.jsx)(ll,{isPresent:z,initial:!O.current||g?void 0:!1,custom:z?void 0:l,presenceAffectsLayout:x,mode:R,onExitComplete:z?void 0:$,children:U},K)})})};var Ao=We(yl()),Rp=(0,Ao.default)(()=>Promise.resolve().then(()=>(Cl(),Sl))),Dp=(0,Ao.default)(()=>Promise.resolve().then(()=>(Kl(),Hl))),kp=(0,Ao.default)(()=>Promise.resolve().then(()=>(zl(),jl)));function zv({apiKey:r,programId:i,mode:l,sessionId:g,metadata:L={},onClose:x,settings:R,theme:c}){let[p,O]=(0,Ee.useState)(!1),[A,E]=(0,Ee.useState)(!1),[M,D]=(0,Ee.useState)(g),[F,q]=(0,Ee.useState)(null),[G,B]=(0,Ee.useState)(null),{messages:U,input:K,handleInputChange:z,handleSubmit:$,append:ae,isLoading:ie,data:ne}=Wn({api:"/api/v1/sdk/chat/stream",initialMessages:R?.messages?.welcome?[{id:"1",role:"system",content:R.messages.welcome}]:[],onFinish:()=>{console.log("onFinish")}}),le=U.filter(ue=>ue.role==="user"||ue.role==="assistant"&&(!F||ue.id!==F.messageId)),ce=le[le.length-1],Oe=ue=>{switch(ue.type){case"programList":return Ee.default.createElement(Rp,{programs:ue.data.programs,onSelect:Te=>{let Ie={id:Date.now().toString(),role:"user",content:`I'm interested in program ${Te}. Can you tell me more about it?`};ae(Ie)}});case"form":switch(ue.data.formType){case"contact":return Ee.default.createElement(Dp,{fields:ue.data.fields,onSubmit:async Te=>{let Ie={id:Date.now().toString(),role:"user",content:"Here's my contact information: "+JSON.stringify(Te)};await ae(Ie)}});case"profile":return Ee.default.createElement(kp,{fields:ue.data.fields,onSubmit:async Te=>{let Ie={id:Date.now().toString(),role:"user",content:"Here's my profile information: "+JSON.stringify(Te)};await ae(Ie)}});default:return null}default:return null}};(0,Ee.useEffect)(()=>{zi(r)},[r,c]);let de=c?{"--edubot-primary":c.primaryColor,"--edubot-secondary":c.secondaryColor,"--edubot-accent":c.accentColor,"--edubot-font":c.fontFamily}:{};return Ee.default.createElement("div",{className:"h-full w-full",style:de},Ee.default.createElement("div",{className:"bg-white h-full w-full flex flex-col",style:{fontFamily:c?.fontFamily}},Ee.default.createElement("div",{className:"flex flex-col"},Ee.default.createElement("div",{className:"px-6 py-4 border-b",style:{backgroundColor:c?.primaryColor||"#4A7DFF",color:"#FFFFFF"}},Ee.default.createElement("h2",{className:"text-xl font-semibold"},"AI Counselor"),Ee.default.createElement("p",{className:"text-sm opacity-90"},"Educational Guidance Expert")),Ee.default.createElement("div",{className:"flex items-center justify-between px-6 py-3 border-b",style:{backgroundColor:c?.secondaryColor||"#F8FAFC"}},Ee.default.createElement("div",{className:"flex items-center space-x-4"},Ee.default.createElement("img",{src:"/counselor-avatar.jpg",alt:"AI Counselor",className:"w-12 h-12 rounded-full object-cover"}),Ee.default.createElement("span",{className:"font-medium"},"Educational Counselor")),Ee.default.createElement("div",{className:"flex items-center space-x-3"},Ee.default.createElement("button",{className:"p-2 rounded-full"},Ee.default.createElement("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},Ee.default.createElement("path",{d:"M23 7l-7 5 7 5V7z"}),Ee.default.createElement("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}))),Ee.default.createElement("button",{className:"p-2 rounded-full"},Ee.default.createElement("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},Ee.default.createElement("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),Ee.default.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),Ee.default.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),Ee.default.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"}))),Ee.default.createElement("button",{onClick:()=>E(!A),className:"p-2 rounded-full"},A?Ee.default.createElement(ar,{className:"w-5 h-5"}):Ee.default.createElement(rr,{className:"w-5 h-5"})),Ee.default.createElement("button",{onClick:()=>E(!0),className:"p-2 hover:bg-gray-100 rounded-full"},Ee.default.createElement(ir,{className:"w-5 h-5"})),Ee.default.createElement("button",{onClick:()=>{O(!1),x?.()},className:"p-2 rounded-full hover:bg-[#FEE2E2]",style:{color:"#EF4444"}},"End Chat")))),!A&&Ee.default.createElement("div",{className:"flex flex-1"},Ee.default.createElement("div",{className:"w-1/2 border-r flex flex-1 flex-col"},R?.features?.videoBot?Ee.default.createElement("div",{className:"aspect-video bg-gray-100 relative"},G&&G.data&&Ee.default.createElement(ji,{hlsUrl:G.data.hls_url,mp4Url:G.data.mp4_url})):Ee.default.createElement("div",{className:"aspect-video bg-gray-50 flex items-center justify-center"},Ee.default.createElement("img",{src:"/counselor-avatar.jpg",alt:"AI Counselor",className:"w-32 h-32 rounded-full object-cover"})),Ee.default.createElement("div",{className:"flex-1 overflow-auto p-4"},Ee.default.createElement(Ls,null,F?.isVisible&&Ee.default.createElement("div",{className:"my-4"},Oe(F))))),Ee.default.createElement("div",{className:"w-1/2 flex flex-col flex-1"},Ee.default.createElement(Hi,{messages:le,input:K,handleInputChange:z,handleSubmit:$,isLoading:ie})))),Ee.default.createElement(Yi,{streamingData:ne||[],setUIComponent:q,setVideoComponent:B}))}})();
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/shared/src/utils.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/defaultAttributes.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/Icon.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/createLucideIcon.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/icons/book-open.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/icons/calendar.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/icons/clock.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/icons/diamond-plus.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/icons/dollar-sign.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/icons/globe.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/icons/mail.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/icons/map-pin.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/icons/maximize-2.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/icons/minimize-2.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/icons/phone.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/icons/user.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/icons/x.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-react/dist/esm/lucide-react.js:
  (**
   * @license lucide-react v0.460.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim.production.js:
  (**
   * @license React
   * use-sync-external-store-shim.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
