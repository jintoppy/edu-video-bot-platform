"use strict";var EduBot=(()=>{var r=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var m=Object.prototype.hasOwnProperty;var f=(i,e,t)=>e in i?r(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var b=(i,e)=>{for(var t in e)r(i,t,{get:e[t],enumerable:!0})},v=(i,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of u(e))!m.call(i,n)&&n!==t&&r(i,n,{get:()=>e[n],enumerable:!(s=g(e,n))||s.enumerable});return i};var w=i=>v(r({},"__esModule",{value:!0}),i);var o=(i,e,t)=>f(i,typeof e!="symbol"?e+"":e,t);var y={};b(y,{EduBot:()=>a});var h="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var c=(i=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)e+=h[t[i]&63];return e};var l=class{constructor(e,t="http://localhost:3000"){o(this,"apiKey");o(this,"baseUrl");this.apiKey=e,this.baseUrl=t}async request(e,t={}){try{let s=await fetch(`${this.baseUrl}${e}`,{...t,headers:{"Content-Type":"application/json","X-API-Key":this.apiKey,...t.headers}}),n=await s.json();if(!s.ok)throw{code:n.error?.code||"UNKNOWN_ERROR",message:n.error?.message||"An unknown error occurred"};return{data:n}}catch(s){return console.error("API Request Error:",s),{error:{code:s.code||"REQUEST_FAILED",message:s.message||"Failed to complete the request"}}}}async initializeChat(e={}){return this.request("/api/v1/sdk/chat/init",{method:"POST",body:JSON.stringify({programId:e.programId,metadata:e.metadata,domain:window.location.hostname})})}async sendMessage(e,t,s){let n=await this.request("/api/v1/sdk/chat/message",{method:"POST",body:JSON.stringify({sessionId:e,message:t,metadata:s})});if(n.error)throw new Error(n.error.message);if(!n.data)throw new Error("No data received from server");return n.data}async endSession(e){return this.request(`/api/v1/sdk/chat/${e}/end`,{method:"POST"})}async saveSessionState(e){return this.request(`/api/v1/sdk/chat/${e}/state`,{method:"POST",body:JSON.stringify({sessionId:e,lastActive:new Date().toISOString()})})}async validateSession(e){return this.request(`/api/v1/sdk/chat/${e}/validate`,{method:"GET"})}async getSessionHistory(e,t=50,s){let n=new URLSearchParams({limit:t.toString(),...s&&{before:s}});return this.request(`/api/v1/sdk/chat/${e}/history?${n}`,{method:"GET"})}},d=null,p=(i,e)=>(d||(d=new l(i,e)),d);var a=class{constructor(e){o(this,"api");o(this,"container",null);o(this,"iframe",null);o(this,"initialized",!1);o(this,"sessionId",null);o(this,"widgetMode",!1);o(this,"options",{});o(this,"config");o(this,"widgetOptions",null);o(this,"eventListeners",{});this.config={baseUrl:"http://localhost:3000",...e},this.api=p(e.apiKey,e.baseUrl),this.initializeEventListeners()}initializeEventListeners(){window.addEventListener("message",this.handleIframeMessage.bind(this)),window.addEventListener("beforeunload",this.handleBeforeUnload.bind(this))}handleIframeMessage(e){if(this.iframe&&e.source===this.iframe.contentWindow){let t=e.data;switch(t.type){case"CHAT_INITIALIZED":this.sessionId=t.payload.data?.sessionId??c(),this.emit("chatInitialized",t.payload);break;case"MESSAGE_SENT":this.emit("messageSent",t.payload);break;case"MESSAGE_RECEIVED":this.emit("messageReceived",t.payload);break;case"SESSION_ENDED":this.sessionId=null,this.emit("sessionEnded",t.payload);break;case"ERROR":console.error("EduBot Error:",t.payload.message),this.emit("error",t.payload);break}}}handleBeforeUnload(){this.sessionId&&this.api.saveSessionState(this.sessionId).catch(console.error)}init(){if(this.initialized)return;this.container=document.createElement("div"),this.container.id="edubot-container",document.body.appendChild(this.container);let e=document.createElement("link");e.rel="stylesheet",e.href=`${this.config.baseUrl}/sdk/styles/embedded.css`,document.head.appendChild(e),this.initialized=!0}initWidget(e={}){let t={greeting:"\u{1F44B} Hi there! How can we help you today?",autoOpen:!1,delay:1e3,title:"Student Counseling",subtitle:"Typically replies within an hour",position:"bottom-right"};this.widgetOptions={...t,...e},this.widgetMode=!0,this.initialized||this.init(),this.container&&(this.container.classList.add("edubot-widget-mode"),this.container.classList.add(`edubot-widget-${this.widgetOptions.position}`),this.widgetOptions.theme&&(this.container.style.setProperty("--edubot-primary",this.widgetOptions.theme?.primaryColor??"#3B82F6"),this.container.style.setProperty("--edubot-font-family",this.widgetOptions.theme?.fontFamily??"Inter"))),this.createWidgetButton(),this.createGreetingBubble(),this.widgetOptions.autoOpen&&setTimeout(()=>{this.startChat()},this.widgetOptions.delay)}createWidgetButton(){let e=document.createElement("button");e.className="edubot-widget-button",e.innerHTML=`
      <div class="edubot-widget-button-closed">
        <div class="edubot-widget-icon">\u{1F4AC}</div>
      </div>
      <div class="edubot-widget-button-opened">
        <div class="edubot-widget-close">\xD7</div>
      </div>
    `,e.addEventListener("click",()=>{this.sessionId?this.toggleChat():this.startChat()}),this.container?.appendChild(e)}createGreetingBubble(){if(!this.widgetOptions?.greeting)return;let e=document.createElement("div");e.className="edubot-widget-greeting",e.innerHTML=`
      <div class="edubot-widget-greeting-text">${this.widgetOptions.greeting}</div>
      <div class="edubot-widget-greeting-close">\xD7</div>
    `,this.container?.appendChild(e),setTimeout(()=>{e.classList.add("edubot-widget-greeting-visible")},this.widgetOptions.delay),e.querySelector(".edubot-widget-greeting-close")?.addEventListener("click",s=>{s.stopPropagation(),e.remove()}),e.addEventListener("click",()=>{e.remove(),this.startChat()})}toggleChat(){if(this.iframe){let e=this.iframe.style.display!=="none";this.iframe.style.display=e?"none":"block",this.container?.querySelector(".edubot-widget-button")?.classList.toggle("edubot-widget-button-active",!e)}}async startChat(e={}){this.options={...this.options,...e},this.initialized||this.init();try{let t=await this.api.initializeChat(this.options);if(t.error)throw new Error(t.error.message);this.sessionId=t.data?.sessionId,this.container&&(this.iframe=document.createElement("iframe"),this.iframe.src=`${this.config.baseUrl}/sdk/embedded-chat`,this.iframe.className=this.widgetMode?"edubot-widget-iframe":"edubot-iframe",this.widgetMode&&this.container.querySelector(".edubot-widget-button")?.classList.add("edubot-widget-button-active"),this.container.appendChild(this.iframe),this.iframe.onload=()=>{this.iframe?.contentWindow?.postMessage({type:"CHAT_INITIALIZED",payload:{sessionId:this.sessionId,settings:this.widgetOptions,...this.options}},"*")})}catch(t){console.error("Failed to start chat:",t),this.emit("error",{message:"Failed to start chat",error:t})}}async endChat(){if(this.sessionId)try{await this.api.endSession(this.sessionId),this.sessionId=null,this.iframe&&(this.iframe.remove(),this.iframe=null),this.widgetMode&&this.container?.querySelector(".edubot-widget-button")?.classList.remove("edubot-widget-button-active"),this.emit("sessionEnded",{sessionId:this.sessionId})}catch(e){console.error("Failed to end chat:",e),this.emit("error",{message:"Failed to end chat",error:e})}}on(e,t){this.eventListeners[e]||(this.eventListeners[e]=[]),this.eventListeners[e].push(t)}off(e,t){this.eventListeners[e]&&(this.eventListeners[e]=this.eventListeners[e].filter(s=>s!==t))}emit(e,t){this.eventListeners[e]&&this.eventListeners[e].forEach(s=>s(t))}isActive(){return!!this.sessionId}getSessionId(){return this.sessionId}destroy(){this.sessionId&&this.endChat(),this.container&&(this.container.remove(),this.container=null),window.removeEventListener("message",this.handleIframeMessage),window.removeEventListener("beforeunload",this.handleBeforeUnload),this.initialized=!1,this.widgetMode=!1,this.eventListeners={}}};window.EduBot=a;return w(y);})();
window.EduBot = EduBot.EduBot;
